

js è¯­æ³•ï¼šhttps://zh.javascript.info/

# æ¦‚è¿°

@See https://zh-hans.react.dev/learn/adding-interactivity

ç•Œé¢ä¸Šçš„æ§ä»¶ä¼šéšç€ç”¨æˆ·è¾“å…¥è€Œå˜åŒ–ï¼Œä¾‹å¦‚ï¼Œç‚¹å‡»æŒ‰é’®åˆ‡æ¢è½®æ’­å›¾ã€‚åœ¨ React ä¸­ï¼Œè¿™ç§ **éšæ—¶é—´å˜åŒ–çš„æ•°æ®** ç§°ä¸º **çŠ¶æ€ï¼ˆstateï¼‰**ã€‚ä½ å¯ä»¥ä¸ºä»»ä½•ç»„ä»¶æ·»åŠ çŠ¶æ€ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ›´æ–°å®ƒã€‚

æœ¬ç« å°†å¸¦ä½ å­¦ä¹ å¦‚ä½•ç¼–å†™å¯äº¤äº’çš„ç»„ä»¶ï¼Œæ›´æ–°å®ƒä»¬çš„çŠ¶æ€ï¼Œå¹¶æ ¹æ®çŠ¶æ€å˜åŒ–åŠ¨æ€è°ƒæ•´ç•Œé¢æ•ˆæœã€‚

# å“åº”äº‹ä»¶

@See https://zh-hans.react.dev/learn/responding-to-events

åœ¨ React ä¸­ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ JSX ä¸­æ·»åŠ  **äº‹ä»¶å¤„ç†å‡½æ•°**ï¼Œç”¨äºå“åº”ç”¨æˆ·äº¤äº’ï¼ˆå¦‚ç‚¹å‡»ã€æ‚¬åœã€è¾“å…¥æ¡†èšç„¦ç­‰ï¼‰ã€‚

React äº‹ä»¶ä¸ä¼ ç»Ÿ DOM äº‹ä»¶ç±»ä¼¼ï¼Œä½†åœ¨è¯­æ³•ä¸Šç¨æœ‰ä¸åŒï¼š

- äº‹ä»¶åé‡‡ç”¨ **å°é©¼å³°å‘½åæ³•**ï¼ˆcamelCaseï¼‰ï¼Œå¦‚ onClick è€Œä¸æ˜¯ onclickã€‚
- äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯ä¸€ä¸ª**å‡½æ•°å¼•ç”¨**ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚

## äº‹ä»¶ç»‘å®šç¤ºä¾‹

åœ¨ä¼ ç»Ÿ HTML ä¸­ï¼Œäº‹ä»¶ç»‘å®šé€šå¸¸å¦‚ä¸‹ï¼š

```tsx
<button onclick="activateLasers()">
  Activate Lasers
</button>
```

è€Œåœ¨ React ä¸­ï¼Œå†™æ³•ç•¥æœ‰ä¸åŒï¼š

```html
<button onClick={activateLasers}>
  Activate Lasers
</button>
```

## æ·»åŠ äº‹ä»¶å‡½æ•°

è¦æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œéœ€è¦å…ˆåœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å°†å…¶ä½œä¸º onClick ç­‰äº‹ä»¶çš„å€¼ä¼ å…¥ JSX å…ƒç´ ï¼š

```tsx
function Button() {
  // 1. å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°
  const handleClick = () => {
    alert("ä½ ç‚¹å‡»äº†æˆ‘ï¼");
  };

  // 2. ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°
  return <button onClick={handleClick}>ç‚¹æˆ‘</button>;
}
```

äº‹ä»¶å¤„ç†å‡½æ•°çš„å‘½åé€šå¸¸éµå¾ªä»¥ä¸‹çº¦å®šï¼š

1. **åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰**ï¼Œç¡®ä¿å‡½æ•°å¯è®¿é—®ç»„ä»¶çš„çŠ¶æ€å’Œ propsã€‚
2. **å‘½åä»¥ handle å¼€å¤´**ï¼Œåè·Ÿå…·ä½“çš„äº‹ä»¶åï¼Œå¦‚ handleClickã€handleMouseEnterã€‚

> **æç¤º**ï¼šæŒ‰ç…§æƒ¯ä¾‹ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°é€šå¸¸ä»¥ handle å¼€å¤´ï¼Œå¦‚ handleClickï¼ŒhandleMouseEnter ç­‰ã€‚

## å†…è”äº‹ä»¶å¤„ç†å‡½æ•°

é™¤äº†åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ JSX ä¸­ä½¿ç”¨**å†…è”å‡½æ•°**ï¼š

```tsx
<button onClick={function handleClick() {
  alert('ä½ ç‚¹å‡»äº†æˆ‘ï¼');
}}>
```

æˆ–è€…ä½¿ç”¨æ›´ç®€æ´çš„ç®­å¤´å‡½æ•°ï¼š

```tsx
<button onClick={() => alert('ä½ ç‚¹å‡»äº†æˆ‘ï¼')}>
```

å½“å‡½æ•°é€»è¾‘è¾ƒç®€å•æ—¶ï¼Œå†…è”æ–¹å¼æ›´ä¸ºä¾¿æ·ã€‚

## åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è®¿é—® props

ç”±äºäº‹ä»¶å¤„ç†å‡½æ•°å®šä¹‰åœ¨ç»„ä»¶å†…éƒ¨ï¼Œå®ƒå¯ä»¥ç›´æ¥è®¿é—®ç»„ä»¶çš„ propsï¼š

```tsx
function AlertButton({ message, children }: { message: string; children: React.ReactNode }) {
  return <button onClick={() => alert(message)}>{children}</button>;
}

export default function Page() {
  return (
    <div>
      <AlertButton message="æ­£åœ¨æ’­æ”¾ï¼">æ’­æ”¾ç”µå½±</AlertButton>
      <AlertButton message="æ­£åœ¨ä¸Šä¼ ï¼">ä¸Šä¼ å›¾ç‰‡</AlertButton>
    </div>
  );
}
```

## äº‹ä»¶å¤„ç†å‡½æ•°ä½œä¸º props ä¼ é€’

åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä¼šåœ¨**çˆ¶ç»„ä»¶**ä¸­å®šä¹‰ï¼Œå¹¶é€šè¿‡ props ä¼ é€’ç»™**å­ç»„ä»¶**ï¼Œä»¥ä¾¿åœ¨çˆ¶ç»„ä»¶ä¸­å¤„ç†é€»è¾‘ï¼š

```tsx
function ConfirmModal({ content, onConfirm, onCancel }: { 
  content: string; 
  onConfirm: () => void; 
  onCancel: () => void 
}) {
  return (
    <div>
      <div>{content}</div>
      <div>
        <button onClick={onCancel}>å–æ¶ˆ</button>
        <button onClick={onConfirm}>ç¡®å®š</button>
      </div>
    </div>
  );
}

export default function Page() {
  return (
    <div>
      <ConfirmModal 
        content="æ‚¨ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ" 
        onConfirm={() => alert("ç‚¹å‡»ç¡®å®š")} 
        onCancel={() => alert("ç‚¹å‡»å–æ¶ˆ")} 
      />
    </div>
  );
}
```

> **å°æŠ€å·§**ï¼šå½“ä½ å°†äº‹ä»¶å¤„ç†å‡½æ•°ä½œä¸º props ä¼ é€’æ—¶ï¼Œæ¨èä»¥ **on** å¼€å¤´ï¼Œå¦‚ onConfirmã€onCancelï¼Œä»¥ä¿æŒä»£ç ä¸€è‡´æ€§å’Œå¯è¯»æ€§ã€‚

## äº‹ä»¶ä¼ æ’­

åœ¨ React ä¸­ï¼Œäº‹ä»¶ä¸ä»…ä¼šå½±å“è§¦å‘å®ƒçš„å…ƒç´ ï¼Œè¿˜ä¼š**æ²¿ç€ç»„ä»¶æ ‘å‘ä¸Šä¼ æ’­**ï¼Œå³**äº‹ä»¶å†’æ³¡**ï¼ˆEvent Bubblingï¼‰ã€‚äº‹ä»¶è§¦å‘åï¼Œä¼šä»ç›®æ ‡å…ƒç´ å¼€å§‹ï¼Œé€çº§å‘ä¸Šä¼ æ’­è‡³çˆ¶ç»„ä»¶ã€‚

> **æ³¨æ„**ï¼šReact ä¸­çš„æ‰€æœ‰äº‹ä»¶éƒ½ä¼šä¼ æ’­ï¼Œå”¯ä¸€çš„ä¾‹å¤–æ˜¯ onScrollï¼Œå®ƒ**ä»…é€‚ç”¨äºç»‘å®šè¯¥äº‹ä»¶çš„ JSX æ ‡ç­¾**ï¼Œä¸ä¼šå†’æ³¡ã€‚

> ğŸ“– **é˜»æ­¢äº‹ä»¶ä¼ æ’­**

å¦‚æœä½ ä¸å¸Œæœ›äº‹ä»¶ç»§ç»­å†’æ³¡åˆ°çˆ¶ç»„ä»¶ï¼Œå¯ä»¥è°ƒç”¨ **`e.stopPropagation()`** æ–¹æ³•ï¼š

```tsx
function Button() {
  return (
    <button
      className="bg-blue-300"
      onClick={(e) => {
        e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
        alert("æŒ‰é’®è¢«ç‚¹å‡»ï¼");
      }}
    >
      ç‚¹æˆ‘
    </button>
  );
}

function Container() {
  return (
    <div className="p-5 bg-gray-200" onClick={() => alert("å®¹å™¨è¢«ç‚¹å‡»ï¼")}>
      <Button />
    </div>
  );
}
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼š

- ç‚¹å‡» Button æ—¶ï¼Œ**ä¸ä¼š**è§¦å‘ Container çš„ onClickï¼Œå› ä¸º *e.stopPropagation()* é˜»æ­¢äº†äº‹ä»¶ä¼ æ’­ã€‚
- è‹¥ä¸è°ƒç”¨ *e.stopPropagation()*ï¼Œç‚¹å‡» Button æ—¶ä¼šåŒæ—¶è§¦å‘ Container çš„ onClickã€‚

> ğŸ“– **é˜»æ­¢é»˜è®¤è¡Œä¸º**

æŸäº›æµè§ˆå™¨äº‹ä»¶å…·æœ‰é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼š

- ç‚¹å‡» \<a> æ ‡ç­¾ä¼šè·³è½¬é¡µé¢ã€‚
- åœ¨ \<form> å†…ç‚¹å‡»æäº¤æŒ‰é’®ä¼šå¯¼è‡´é¡µé¢é‡æ–°åŠ è½½ã€‚

ä½ å¯ä»¥è°ƒç”¨ **`e.preventDefault()`** æ¥é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼š

```tsx
function Form() {
  return (
    <form
      onSubmit={(e) => {
        e.preventDefault(); // é˜»æ­¢è¡¨å•æäº¤
        alert("è¡¨å•æäº¤è¢«é˜»æ­¢ï¼");
      }}
    >
      <input type="text" placeholder="è¾“å…¥å†…å®¹" />
      <button type="submit">æäº¤</button>
    </form>
  );
}
```

## äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥åŒ…å«å‰¯ä½œç”¨å—ï¼Ÿ

å½“ç„¶å¯ä»¥ï¼**äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯æ‰§è¡Œå‰¯ä½œç”¨çš„æœ€ä½³ä½ç½®**ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨ç”¨æˆ·äº¤äº’æ—¶è§¦å‘çš„ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œçš„ã€‚

ä¸æ¸²æŸ“å‡½æ•°ä¸åŒï¼Œ**äº‹ä»¶å¤„ç†å‡½æ•°ä¸éœ€è¦æ˜¯çº¯å‡½æ•°**ï¼Œå› æ­¤å®ƒå¯ä»¥ç”¨äº**ä¿®æ”¹çŠ¶æ€ã€æ›´æ–°æ•°æ®æˆ–æ‰§è¡Œå…¶ä»–å‰¯ä½œç”¨**ã€‚ä¾‹å¦‚ï¼š

1. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡å­—æ—¶æ›´æ–°çŠ¶æ€
2. åœ¨æŒ‰é’®ç‚¹å‡»æ—¶ä¿®æ”¹åˆ—è¡¨æ•°æ®
3. è§¦å‘ç½‘ç»œè¯·æ±‚æˆ–æœ¬åœ°å­˜å‚¨æ“ä½œ

ç„¶è€Œï¼Œæ‰§è¡Œå‰¯ä½œç”¨çš„å‰ææ˜¯éœ€è¦æœ‰ä¸€ä¸ªåœ°æ–¹æ¥å­˜å‚¨è¿™äº›å˜åŒ–ã€‚åœ¨ React ä¸­ï¼Œè¿™é€šå¸¸é€šè¿‡ stateï¼ˆçŠ¶æ€ï¼‰æ¥å®ç°ï¼š

```tsx
import { useState } from "react";

function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>å½“å‰è®¡æ•°ï¼š{count}</p>
      <button onClick={() => setCount(count + 1)}>å¢åŠ </button>
    </div>
  );
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š

- `count` å­˜å‚¨äº†å½“å‰è®¡æ•°å€¼ã€‚
- `setCount(count + 1)` åœ¨æŒ‰é’®ç‚¹å‡»æ—¶**æ›´æ–°çŠ¶æ€**ï¼Œè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

**âœ… ä»€ä¹ˆæ—¶å€™ä½¿ç”¨äº‹ä»¶å¤„ç†å‡½æ•°ï¼Ÿ**

1. éœ€è¦åœ¨ç”¨æˆ·äº¤äº’æ—¶æ‰§è¡Œå‰¯ä½œç”¨
2. ä¿®æ”¹ React ç»„ä»¶çš„ state
3. æ“ä½œ DOM æˆ–è§¦å‘ç½‘ç»œè¯·æ±‚

**æ€»ç»“**ï¼šäº‹ä»¶å¤„ç†å‡½æ•°é€‚åˆæ‰§è¡Œå‰¯ä½œç”¨ï¼Œæ¯”å¦‚æ›´æ–°çŠ¶æ€ã€ä¿®æ”¹æ•°æ®æˆ–è§¦å‘ç½‘ç»œè¯·æ±‚ï¼Œè€Œæ¸²æŸ“å‡½æ•°åº”ä¿æŒçº¯å‡€ï¼Œé¿å…åœ¨æ¸²æŸ“æ—¶æ‰§è¡Œå‰¯ä½œç”¨ã€‚

# Stateï¼ˆçŠ¶æ€ï¼‰â€”â€” ç»„ä»¶çš„è®°å¿†

@See https://zh-hans.react.dev/learn/state-a-components-memory

åœ¨ React ä¸­ï¼Œstate æ˜¯ç»„ä»¶ **ç§æœ‰çš„**ï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†ç»„ä»¶å†…éƒ¨æ•°æ®ã€‚ä¸ props ä¸åŒï¼Œstate å¯ä»¥åœ¨ç»„ä»¶å†…åŠ¨æ€æ›´æ–°ï¼Œå¹¶è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

**âŒ ç›´æ¥ä¿®æ”¹å˜é‡ä¸ä¼šè§¦å‘æ›´æ–°**

æ¥çœ‹ä¸€ä¸ªé”™è¯¯ç¤ºä¾‹ï¼š

```tsx
export default function Pagination() {
  let current = 1;
  const handleClick = () => {
    current += 1;
  };

  return (
    <div>
      <p>å½“å‰é¡µç ï¼š{current}</p>
      <button onClick={handleClick}>ä¸‹ä¸€é¡µ</button>
    </div>
  );
}
```

è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼š

1. current åªæ˜¯ä¸€ä¸ª**å±€éƒ¨å˜é‡**ï¼ŒReact **ä¸ä¼šè®°ä½**å®ƒçš„å€¼ã€‚
2. **ä¿®æ”¹å±€éƒ¨å˜é‡ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“**ï¼Œå› æ­¤ UI ä¸ä¼šæ›´æ–°ã€‚

**âœ… ä½¿ç”¨ useState å­˜å‚¨çŠ¶æ€**

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ useState æ¥å­˜å‚¨ current å¹¶åœ¨æ›´æ–°æ—¶è§¦å‘æ¸²æŸ“ï¼š

```tsx
import { useState } from "react";

export default function Pagination() {
  const [current, setCurrent] = useState(1);

  const handleClick = () => {
    setCurrent(current + 1);
  };

  return (
    <div>
      <p>å½“å‰é¡µç ï¼š{current}</p>
      <button onClick={handleClick}>ä¸‹ä¸€é¡µ</button>
    </div>
  );
}
```

> ğŸ“– **useState çš„ä½œç”¨**

```tsx
const [current, setCurrent] = React.useState(1);
```

1. current â€”â€” **çŠ¶æ€å˜é‡**ï¼Œå­˜å‚¨å½“å‰é¡µç å€¼ã€‚
2. setCurrent â€”â€” **çŠ¶æ€æ›´æ–°å‡½æ•°**ï¼Œç”¨äºä¿®æ”¹ current å¹¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚
3. useState(1) â€”â€” **åˆå§‹å€¼**ï¼ŒReact ä¼šåœ¨åˆæ¬¡æ¸²æŸ“æ—¶ä½¿ç”¨ 1ã€‚

> ğŸ”¥ é‡è§ä½ çš„ç¬¬ä¸€ä¸ª Hook
>
> åœ¨ React ä¸­ï¼Œ`useState` ä»¥åŠä»»ä½•å…¶ä»–ä»¥ **`use`** å¼€å¤´çš„å‡½æ•°éƒ½è¢«ç§°ä¸º **Hook**ã€‚
>
> Hook æ˜¯ç‰¹æ®Šçš„å‡½æ•°ï¼Œåªåœ¨ React æ¸²æŸ“æ—¶æœ‰æ•ˆï¼ˆæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚è¯¦ç»†ä»‹ç»ï¼‰ã€‚å®ƒä»¬èƒ½è®©ä½  hook åˆ°ä¸åŒçš„ React ç‰¹æ€§ä¸­å»ã€‚
>
> State åªæ˜¯è¿™äº›ç‰¹æ€§ä¸­çš„ä¸€ä¸ªï¼Œä½ ä¹‹åè¿˜ä¼šé‡åˆ°å…¶ä»– Hookã€‚

> âš ï¸ æ³¨æ„ï¼šHook å‡½æ•°åªèƒ½åœ¨ç»„ä»¶æˆ–è‡ªå®šä¹‰ Hookçš„æœ€é¡¶å±‚è°ƒç”¨ã€‚** ä½ ä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥æˆ–å…¶ä»–åµŒå¥—å‡½æ•°å†…è°ƒç”¨ Hookã€‚

> ğŸ“– **çŠ¶æ€æ›´æ–°çš„è¿‡ç¨‹**

1. **åˆå§‹æ¸²æŸ“**ï¼šReact è¯»å– useState(1)ï¼Œè¿”å› [1, setCurrent]ï¼Œè®°ä½ 1 ä½œä¸º currentã€‚
2. **æ›´æ–°çŠ¶æ€**ï¼šç‚¹å‡»æŒ‰é’®ï¼Œè°ƒç”¨ setCurrent(current + 1)ï¼Œcurrent å˜ä¸º 2ï¼ŒReact **è§¦å‘é‡æ–°æ¸²æŸ“**ã€‚
3. **é‡æ–°æ¸²æŸ“**ï¼šReact çœ‹åˆ° useState(1)ï¼Œä½†ç”±äºå®ƒ**è®°ä½äº†** current = 2ï¼Œæ‰€ä»¥è¿”å› [2, setCurrent]ï¼ŒUI æ›´æ–°ã€‚

> ğŸ“– **state æ˜¯ç§æœ‰ä¸”éš”ç¦»çš„**

**çŠ¶æ€æ˜¯ç»„ä»¶ç§æœ‰çš„ï¼Œæ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½æœ‰ç‹¬ç«‹çš„ state**ï¼š

```tsx
function App() {
  return (
    <div>
      <Pagination />
      <Pagination />
    </div>
  );
}
```

å³ä½¿æ¸²æŸ“äº†ä¸¤ä¸ª Pagination ç»„ä»¶ï¼Œå®ƒä»¬çš„ state ä¹Ÿæ˜¯**å®Œå…¨ç‹¬ç«‹**çš„ï¼Œäº’ä¸å½±å“ã€‚

# æ¸²æŸ“å’Œæäº¤

@See https://zh-hans.react.dev/learn/render-and-commit

åœ¨ React åº”ç”¨ä¸­ï¼Œå±å¹•æ›´æ–°ä¼šç»è¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š

1. **è§¦å‘** æ¸²æŸ“
2. **æ¸²æŸ“** ç»„ä»¶
3. **æäº¤** åˆ°DOM

## æ­¥éª¤ 1ï¼šè§¦å‘æ¸²æŸ“

æ¸²æŸ“çš„è§¦å‘é€šå¸¸ç”±ä»¥ä¸‹ä¸¤ç§åŸå› å¼•èµ·ï¼š

1. **ç»„ä»¶çš„åˆæ¬¡æ¸²æŸ“**ï¼šå½“åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šè§¦å‘æ ¹ç»„ä»¶çš„åˆæ¬¡æ¸²æŸ“ã€‚
2. **ç»„ä»¶çš„çŠ¶æ€æ›´æ–°**ï¼šå½“ç»„ä»¶çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒReact ä¼šé‡æ–°æ¸²æŸ“è¯¥ç»„ä»¶æˆ–å…¶å­ç»„ä»¶ã€‚

**ğŸ”µ åˆæ¬¡æ¸²æŸ“**

å½“åº”ç”¨å¯åŠ¨æ—¶ï¼ŒReact ä¼šé€šè¿‡ createRoot æ–¹æ³•åœ¨ DOM ä¸Šåˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå¹¶å°†æ ¹ç»„ä»¶æ¸²æŸ“åˆ°è¯¥èŠ‚ç‚¹ä¸­ï¼š

```tsx
import App from './App.tsx';
import { createRoot } from 'react-dom/client';

const root = createRoot(document.getElementById('root'));
root.render(<App />);
```

**ğŸ”µ çŠ¶æ€æ›´æ–°æ—¶é‡æ–°æ¸²æŸ“**

å½“ç»„ä»¶çŠ¶æ€æ›´æ–°æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘è¯¥ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚ä½¿ç”¨ setState æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ä¼šå°†æ¸²æŸ“æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ›´æ–°ã€‚

## æ­¥éª¤ 2ï¼šReact æ¸²æŸ“ç»„ä»¶

å½“è§¦å‘æ¸²æŸ“æ—¶ï¼ŒReact ä¼šè°ƒç”¨ç»„ä»¶å‡½æ•°æ¥è®¡ç®—åº”è¯¥æ˜¾ç¤ºçš„å†…å®¹ã€‚

- **åˆæ¬¡æ¸²æŸ“**æ—¶ï¼ŒReact ä¼šè°ƒç”¨æ ¹ç»„ä»¶ã€‚
- **åç»­æ¸²æŸ“**æ—¶ï¼ŒReact ä¼šæ ¹æ®çŠ¶æ€æ›´æ–°è°ƒç”¨éœ€è¦é‡æ–°æ¸²æŸ“çš„ç»„ä»¶ã€‚

React çš„æ¸²æŸ“æ˜¯é€’å½’çš„ï¼šæ¯ä¸ªç»„ä»¶è¿”å›çš„ JSX å¯èƒ½è¿˜åŒ…å«å­ç»„ä»¶ï¼ŒReact ä¼šç»§ç»­æ¸²æŸ“è¿™äº›å­ç»„ä»¶ï¼Œç›´åˆ°æœ€ç»ˆæ¸²æŸ“å‡ºå®Œæ•´çš„ UIã€‚

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š

```tsx
function App() {
  return <Parent />;
}

function Parent() {
  return <Child />;
}

function Child() {
  return <GrandChild />;
}

function GrandChild() {
  return <div>æœ€ç»ˆæ˜¾ç¤ºçš„å†…å®¹</div>;
}
```

**æ¸²æŸ“è¿‡ç¨‹ï¼š**

1. React æ¸²æŸ“ Appï¼Œå‘ç°è¿”å›äº† Parentã€‚
2. React æ¸²æŸ“ Parentï¼Œå‘ç°è¿”å›äº† Childã€‚
3. React æ¸²æŸ“ Childï¼Œå‘ç°è¿”å›äº† GrandChildã€‚
4. React æ¸²æŸ“ GrandChildï¼Œæœ€ç»ˆè¿”å› \<div>ï¼Œå†…å®¹ä¸ºâ€œæœ€ç»ˆæ˜¾ç¤ºçš„å†…å®¹â€ã€‚

é€’å½’ç»“æŸåï¼ŒReact å°†æœ€ç»ˆçš„ DOM æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚

**æ€»ç»“ï¼š** æ¸²æŸ“æ˜¯ä¸€ä¸ªè‡ªé¡¶å‘ä¸‹çš„é€’å½’è¿‡ç¨‹ï¼ŒReact ä¼šæŒ‰ç…§ç»„ä»¶çš„åµŒå¥—å…³ç³»é€å±‚æ¸²æŸ“ï¼Œç›´åˆ°æœ€ç»ˆå½¢æˆå±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ã€‚

**æ³¨æ„ï¼š** æ¸²æŸ“å¿…é¡»æ˜¯çº¯è®¡ç®—çš„å‡½æ•°ã€‚å³ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œç»„ä»¶åº”å§‹ç»ˆè¿”å›ç›¸åŒçš„ JSXã€‚

## æ­¥éª¤ 3ï¼šReact æŠŠæ›´æ”¹æäº¤åˆ° DOM ä¸Š

å½“æ¸²æŸ“å®Œæˆåï¼ŒReact ä¼šå°†æ›´æ”¹æäº¤åˆ° DOMã€‚

- **åˆæ¬¡æ¸²æŸ“**æ—¶ï¼ŒReact ä¼šä½¿ç”¨ **`appendChild()`** å°†æ‰€æœ‰ DOM èŠ‚ç‚¹æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚
- **é‡æ¸²æŸ“**æ—¶ï¼ŒReact ä¼šä½¿ç”¨æœ€å°åŒ–çš„æ“ä½œæ¥æ›´æ–° DOMï¼Œä»…æ”¹å˜ä¸å½“å‰æ¸²æŸ“ç»“æœä¸åŒçš„éƒ¨åˆ†ã€‚

React åªä¼šåœ¨å®é™…æ¸²æŸ“ç»“æœå‘ç”Ÿå˜åŒ–æ—¶æ‰æ›´æ–° DOMã€‚

## æ­¥éª¤ 4ï¼šæµè§ˆå™¨ç»˜åˆ¶

åœ¨ React æ›´æ–° DOM åï¼Œæµè§ˆå™¨ä¼šé‡æ–°ç»˜åˆ¶é¡µé¢ã€‚è¿™ä¸€è¿‡ç¨‹è¢«ç§°ä¸º â€œ**ç»˜åˆ¶**â€ï¼ˆPaintingï¼‰ï¼Œå®ƒæ˜¯æµè§ˆå™¨æ ¹æ® React æä¾›çš„ DOM è¿›è¡Œçš„å¯è§†åŒ–æ›´æ–°ã€‚

# State å¦‚åŒä¸€å¼ å¿«ç…§

@See https://zh-hans.react.dev/learn/state-as-a-snapshot

åœ¨ React ä¸­ï¼Œstate è¢«æ¯”ä½œ**ä¸€å¼ å¿«ç…§**ï¼Œè¿™ä¸ªæ¯”å–»å¼ºè°ƒäº† React çŠ¶æ€çš„ä¸€äº›æ ¸å¿ƒç‰¹æ€§å’Œè¡Œä¸ºï¼š

1. **ä¸å¯å˜æ€§**
   - React çš„ state æ˜¯ä¸å¯ç›´æ¥ä¿®æ”¹çš„ï¼Œå¿…é¡»é€šè¿‡ setStateï¼ˆæˆ– useState çš„æ›´æ–°å‡½æ•°ï¼‰æ¥è§¦å‘æ›´æ–°ã€‚
   - **ç±»æ¯”å¿«ç…§**ï¼šåœ¨æŸä¸€æ—¶åˆ»ï¼Œstate å°±åƒæ˜¯åº”ç”¨å½“å‰çŠ¶æ€çš„å¿«ç…§ï¼Œä¸€æ—¦ç”Ÿæˆï¼Œå°±ä¸ä¼šç›´æ¥ä¿®æ”¹ï¼Œè€Œæ˜¯é€šè¿‡æ›¿æ¢æ—§å¿«ç…§æ¥æ›´æ–°çŠ¶æ€ã€‚
2. **ç‹¬ç«‹äºæœªæ¥å’Œè¿‡å»**
   - state ä»…ä»£è¡¨**æŸä¸€æ—¶åˆ»**çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯å†å²è®°å½•ã€‚
   - **ç±»æ¯”å¿«ç…§**ï¼šå®ƒæ˜¯ä¸€ä¸ªé™æ€è§†å›¾ï¼Œåæ˜ äº†å½“ä¸‹çš„åº”ç”¨çŠ¶æ€ï¼Œä¸åŒ…å«è¿‡å»æˆ–æœªæ¥çš„å˜åŒ–ã€‚
3. **åœ¨æ›´æ–°è¿‡ç¨‹ä¸­çš„ä¸€è‡´æ€§**
   - å³ä½¿åœ¨å¼‚æ­¥æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œstate ä»ç„¶ä¿æŒä¸€è‡´ï¼Œä¸ä¼šå› ä¸ºå¤šä¸ªæ›´æ–°æ“ä½œè€Œæ··ä¹±ã€‚
   - **ç±»æ¯”å¿«ç…§**ï¼šæ¯æ¬¡æ¸²æŸ“æ—¶ï¼ŒReact ä¼šåŸºäºæœ€æ–°çš„çŠ¶æ€å¿«ç…§é‡æ–°è®¡ç®— UIï¼Œä¸ä¼šå—åˆ°ä¹‹å‰å¿«ç…§çš„å½±å“ã€‚
4. **ä¸å¯ç›´æ¥è¯»å–å¼‚æ­¥æ›´æ–°ä¸­çš„æ–°çŠ¶æ€**
   - è°ƒç”¨ setState åï¼Œæ–°çŠ¶æ€ä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶ç”Ÿæ•ˆï¼Œè€Œä¸æ˜¯ç«‹å³æ›´æ–°ã€‚
   - **ç±»æ¯”å¿«ç…§**ï¼šå½“å‰çš„çŠ¶æ€å¿«ç…§ä»ç„¶ä»£è¡¨æ—§å€¼ï¼Œç›´åˆ°æ–°çš„å¿«ç…§ç”Ÿæˆã€‚

## ç¤ºä¾‹

```tsx
import { useState } from "react";

export default function App() {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    // -- è§¦å‘çŠ¶æ€æ›´æ–°
    setCount(count + 1);
    // -- ä»ç„¶è¾“å‡ºæ—§çš„ count å€¼
    console.log(count);
  };
  return (
    <div>
      <button onClick={handleClick}>Count: {count}</button>
    </div>
  );
}
```

**ä¸ºä»€ä¹ˆä¼šè¾“å‡ºæ—§å€¼ï¼Ÿ**

- å½“ handleClick æ‰§è¡Œæ—¶ï¼Œcount çš„å€¼æ˜¯å½“å‰å¿«ç…§çš„å€¼ï¼ˆå³ state çš„å½“å‰å€¼ï¼‰ã€‚
- è°ƒç”¨ setCount(count + 1) åï¼ŒReact ä¼šè°ƒåº¦çŠ¶æ€æ›´æ–°ï¼Œä½†ä¸ä¼šç«‹å³æ”¹å˜ countã€‚
- ç›´åˆ°ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼ŒReact æ‰ä¼šç”Ÿæˆæ–°çš„å¿«ç…§ï¼Œå¹¶ä¸”åŒ…å«æ›´æ–°åçš„çŠ¶æ€ã€‚

**é‡è¦å¯ç¤º**

1. state **æ˜¯å½“å‰çŠ¶æ€çš„é™æ€æè¿°**ï¼š

   å®ƒä¸ä¼šä¸»åŠ¨å˜åŒ–ï¼ŒReact é€šè¿‡ç”Ÿæˆæ–°çš„å¿«ç…§æ¥æ›´æ–° UIï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å½“å‰çŠ¶æ€ã€‚

2. **ä¸è¦ç›´æ¥ä¾èµ–æ—§çš„** stateï¼š

   åœ¨æ›´æ–°çŠ¶æ€æ—¶ï¼Œå¦‚æœä¾èµ–å‰ä¸€ä¸ªçŠ¶æ€ï¼Œåº”è¯¥ä½¿ç”¨æ›´æ–°å‡½æ•°çš„å½¢å¼ï¼š

   ```tsx
   setCount(prevCount => prevCount + 1);
   ```

3. state **çš„ä¸å¯å˜æ€§è®© React é«˜æ•ˆï¼š**

   å› ä¸º React ä¸ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œè€Œæ˜¯ç”Ÿæˆæ–°çš„å¿«ç…§ï¼Œå®ƒå¯ä»¥è½»æ¾å¯¹æ¯”å‰åçŠ¶æ€å¹¶é«˜æ•ˆæ›´æ–° UIã€‚

# æ‰¹å¤„ç†

@See https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates

React å¯¹ state æ›´æ–°è¿›è¡Œ**æ‰¹å¤„ç†**çš„æœºåˆ¶æ˜¯ React æé«˜æ€§èƒ½å’Œå‡å°‘ä¸å¿…è¦æ¸²æŸ“çš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚

## ä»€ä¹ˆæ˜¯æ‰¹å¤„ç†ï¼Ÿ

æ‰¹å¤„ç†æŒ‡çš„æ˜¯ï¼šReact å°†å¤šä¸ªçŠ¶æ€æ›´æ–° **æ”¶é›†èµ·æ¥**ï¼Œåœ¨ä¸€æ¬¡æ¸²æŸ“å‘¨æœŸä¸­ **åˆå¹¶æ‰§è¡Œ**ï¼Œä»è€Œå‡å°‘é‡æ–°æ¸²æŸ“æ¬¡æ•°ã€‚

ä¾‹å­ï¼š

```tsx

import React from "react";

export default function App() {
  const [count, setCount] = React.useState(0);

  const handleClick = () => {
    setCount(count + 1);
    setCount(count + 2); // çœ‹èµ·æ¥åƒæ˜¯ä¼šå¢åŠ ä¸¤æ¬¡ï¼Œä½†å®é™…ä¸Šåªä¼šæ›´æ–°ä¸€æ¬¡ã€‚
  };

  console.log("Rendered with count:", count);

  return <button onClick={handleClick}>Count: {count}</button>;
}
```

è¾“å‡ºï¼š

- å¦‚æœæ²¡æœ‰æ‰¹å¤„ç†ï¼šReact ä¼šç«‹å³è§¦å‘æ¯æ¬¡ setCount çš„çŠ¶æ€æ›´æ–°ï¼Œå¹¶åœ¨æ¯æ¬¡æ›´æ–°åé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚
- ä½†ç”±äºæ‰¹å¤„ç†çš„å­˜åœ¨ï¼Œä¸Šè¿°ä»£ç åªä¼šé‡æ–°æ¸²æŸ“ä¸€æ¬¡ï¼Œcount åªä¼šåŠ  2ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ setCount éƒ½ç«‹å³æ›´æ–°ã€‚

> æ¸©é¦¨æç¤ºï¼šReact 18+ å¼•å…¥äº†**è‡ªåŠ¨æ‰¹å¤„ç†**ï¼Œå³ä½¿æ˜¯ setTimeout æˆ– Promise å†…çš„çŠ¶æ€æ›´æ–°ä¹Ÿä¼šè¢«æ‰¹å¤„ç†ã€‚

## React å¦‚ä½•æ‰¹å¤„ç†ï¼Ÿ

React ä¼šå¯¹åŒä¸€äº‹ä»¶å¤„ç†è¿‡ç¨‹ä¸­çš„æ‰€æœ‰çŠ¶æ€æ›´æ–°è¿›è¡Œæ‰¹å¤„ç†ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ç‚¹å‡»ã€è¡¨å•è¾“å…¥ç­‰è§¦å‘çš„äº‹ä»¶ã€‚

### æ‰¹å¤„ç†çš„å®ç°

1. **é˜Ÿåˆ—ç®¡ç†**ï¼šReact ä¼šå°†å¤šä¸ªçŠ¶æ€æ›´æ–° **å­˜å…¥é˜Ÿåˆ—**ï¼Œå¹¶åœ¨äº‹ä»¶å¾ªç¯ç»“æŸåç»Ÿä¸€æ‰§è¡Œè¿™äº›æ›´æ–°ã€‚
2. **ç»Ÿä¸€æ‰§è¡Œ**ï¼šåœ¨æ‰§è¡Œæ›´æ–°æ—¶ï¼ŒReact ä¼šè®¡ç®—æœ€æ–°çš„çŠ¶æ€å€¼ï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶æœºè§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ã€‚

### ç¤ºä¾‹

```tsx
import React from "react";

export default function App() {
  const [count, setCount] = React.useState(0);

  const handleClick = () => {
    setCount((prev) => prev + 1); // ç¬¬ä¸€æ¬¡æ›´æ–°
    setCount((prev) => prev + 1); // ç¬¬äºŒæ¬¡æ›´æ–°
  };

  return <button onClick={handleClick}>Count: {count}</button>;
}
```

**æ¸²æŸ“è¡Œä¸ºï¼š**

1. setCount çš„ä¸¤æ¬¡è°ƒç”¨ä¼šè¢«æ‰¹å¤„ç†ã€‚
2. prev è¡¨ç¤ºçš„æ˜¯æ›´æ–°åçš„æœ€æ–°çŠ¶æ€ï¼Œå› æ­¤ count çš„æœ€ç»ˆå€¼ä¼šå¢åŠ  2ï¼Œè€Œä¸æ˜¯ä¾èµ–ä¸¤æ¬¡æ›´æ–°ä¸­çš„åŒä¸€ä¸ªåˆå§‹å€¼ã€‚

## æ‘˜è¦

- è®¾ç½® state ä¸ä¼šç«‹å³æ›´æ”¹ç°æœ‰æ¸²æŸ“ä¸­çš„å˜é‡ï¼Œè€Œæ˜¯è¯·æ±‚ä¸€æ¬¡æ–°çš„æ¸²æŸ“ã€‚
- React ä¼šåœ¨äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæˆåæ‰¹é‡å¤„ç† state æ›´æ–°ï¼Œè¿™ä¸€è¿‡ç¨‹è¢«ç§°ä¸ºæ‰¹å¤„ç†ã€‚
- å¦‚æœéœ€è¦åœ¨åŒä¸€ä¸ªäº‹ä»¶ä¸­å¤šæ¬¡æ›´æ–° stateï¼Œå¯ä»¥ä½¿ç”¨æ›´æ–°å‡½æ•°ï¼Œå¦‚ï¼šsetNumber(n => n + 1)ã€‚

# æ›´æ–°Stateä¸­çš„å¯¹è±¡

@See https://zh-hans.react.dev/learn/updating-objects-in-state

## ä»€ä¹ˆæ˜¯ mutationï¼Ÿ

**Mutation** æ˜¯æŒ‡ **ç›´æ¥ä¿®æ”¹** ç°æœ‰å¯¹è±¡æˆ–æ•°ç»„çš„å†…å®¹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„å‰¯æœ¬ã€‚åœ¨ React ä¸­ï¼Œä¿®æ”¹ state æ—¶éœ€è¦éµå¾ªä¸å¯å˜æ€§ï¼ˆimmutabilityï¼‰çš„åŸåˆ™ï¼Œå› ä¸ºç›´æ¥ä¿®æ”¹ state ä¼šå¯¼è‡´ä¸å¯é¢„æ–™çš„é—®é¢˜ï¼Œç”šè‡³æ— æ³•æ­£ç¡®æ›´æ–°è§†å›¾ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„ mutation ç¤ºä¾‹ï¼š

```tsx
const person = { name: 'Alice', age: 25 };
person.age = 26; // ç›´æ¥ä¿®æ”¹äº†å¯¹è±¡çš„å†…å®¹
```

ç›´æ¥ä¿®æ”¹ person ä¼šæ”¹å˜å…¶åŸå§‹å€¼ï¼Œè¿™åœ¨ React ä¸­å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼Œå¦‚ç»„ä»¶æ— æ³•æ­£ç¡®é‡æ¸²æŸ“ã€‚è¿™ç§è¡Œä¸ºå°±å«åš **mutation**ã€‚

## ä¸ºä»€ä¹ˆé¿å… mutationï¼Ÿ

1. **React çš„æ¸²æŸ“ä¾èµ–äº state çš„ä¸å¯å˜æ€§**

   React åˆ¤æ–­ state æ˜¯å¦å˜åŒ–æ˜¯é€šè¿‡å¼•ç”¨æ¯”è¾ƒã€‚å¦‚æœç›´æ¥ä¿®æ”¹å¯¹è±¡ï¼Œå¼•ç”¨ä¸ä¼šå˜åŒ–ï¼ŒReact å¯èƒ½ä¼šè®¤ä¸ºæ²¡æœ‰æ›´æ–°ï¼Œä»è€Œè·³è¿‡æ¸²æŸ“ã€‚

2. **å½±å“è°ƒè¯•å’Œè·Ÿè¸ªå†å²**

   ç›´æ¥ä¿®æ”¹å¯¹è±¡ä¼šç ´åå®ƒçš„å†å²çŠ¶æ€ï¼Œå¯¼è‡´è°ƒè¯•å›°éš¾ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼€å‘å·¥å…·ä¸­æŸ¥çœ‹ state çš„å˜åŒ–æ—¶ã€‚

3. **æ•°æ®åŒæ­¥é—®é¢˜**

   Mutation ä¼šå¯¼è‡´ä¸å¯é¢„æœŸçš„å‰¯ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å…±äº«çŠ¶æ€æˆ–ä¼ é€’ props æ—¶ï¼Œå¯èƒ½ä¼šå½±å“å¤šä¸ªç»„ä»¶çš„è¡Œä¸ºã€‚

## å¦‚ä½•é¿å… mutationï¼Ÿ

1ï¼‰**ä½¿ç”¨å¯¹è±¡å±•å¼€è¯­æ³•** æ¥åˆ›å»ºæ–°çš„å‰¯æœ¬ï¼š

```tsx
const person = { name: 'Alice', age: 25 };
const updatedPerson = { ...person, age: 26 }; // åˆ›å»ºæ–°å¯¹è±¡
```

> æ³¨æ„ï¼š`...` å±•å¼€è¯­æ³•æœ¬è´¨æ˜¯æµ…æ‹·è´ï¼Œå®ƒåªä¼šå¤åˆ¶å¯¹è±¡çš„ç¬¬ä¸€å±‚ã€‚å¦‚æœæœ‰åµŒå¥—å¯¹è±¡ï¼ŒåµŒå¥—çš„å†…å®¹ä»ç„¶æ˜¯å¼•ç”¨ç±»å‹ï¼Œå› æ­¤å¦‚æœéœ€è¦æ›´æ–°åµŒå¥—å±æ€§ï¼Œéœ€è¦å¤šæ¬¡ä½¿ç”¨å±•å¼€è¯­æ³•ã€‚

2ï¼‰**ä½¿ç”¨å·¥å…·åº“ï¼Œå¦‚ Immer**ï¼Œç®€åŒ–æ·±å±‚ç»“æ„çš„æ›´æ–°

[Immer](https://github.com/immerjs/use-immer) æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€ä¾¿çš„æ–¹å¼æ¥ç›´æ¥ä¿®æ”¹å¯¹è±¡ï¼ŒåŒæ—¶ä¿æŒä¸å¯å˜æ€§ã€‚å®ƒä¼šå¸®åŠ©ä½ å¤„ç†æ·±å±‚åµŒå¥—å¯¹è±¡çš„æ›´æ–°ã€‚

**Immer æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿ** 

ç”± Immer æä¾›çš„ draft æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¯¹è±¡ï¼Œç§°ä¸º [Proxy](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy)ï¼Œå®ƒä¼šè®°å½•ä½ å¯¹å¯¹è±¡è¿›è¡Œçš„æ“ä½œã€‚æ­£å› ä¸ºæ­¤ï¼Œä½ å¯ä»¥éšæ„ä¿®æ”¹å¯¹è±¡ã€‚Immer ä¼šè·Ÿè¸ª draft å¯¹è±¡çš„ä¿®æ”¹éƒ¨åˆ†ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿®æ”¹åˆ›å»ºå‡ºæ–°çš„å¯¹è±¡ã€‚

å°è¯•ä½¿ç”¨ Immerï¼š

1. è¿è¡Œ **`pnpm add use-immer`** å®‰è£… Immer ä¾èµ–ã€‚
2. ç”¨ **`import { useImmer } from 'use-immer'`** æ›¿æ¢ **`import { useState } from 'react'`**ã€‚

ä»£ç ç¤ºä¾‹ï¼š

```tsx
import { useImmer } from "use-immer";

export default function Form() {
  const [formData, updateFormData] = useImmer({
    firstName: "å¼ ",
    lastName: "ä¸‰",
    email: "lihy_online@163.com",
  });

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    updateFormData((draft) => {
      draft[e.target.name as keyof typeof formData] = e.target.value;
    });
  };

  return (
    <div className="m-6">
      <form className="border border-gray-200 p-4 space-y-4">
        <div>
          <label>First nameï¼š</label>
          <input 
            className="border px-2 border-gray-200"
            name="firstName" 
            type="text" 
            value={formData.firstName} 
            onChange={handleChange} 
          />
        </div>
        <div>
          <label>Last nameï¼š</label>
          <input 
            className="border px-2 border-gray-200"
            name="lastName" 
            type="text" 
            value={formData.lastName} 
            onChange={handleChange} 
          />
        </div>
        <div>
          <label>Emailï¼š</label>
          <input 
            className="border px-2 border-gray-200"
            name="email" 
            type="email" 
            value={formData.email} 
            onChange={handleChange} 
          />
        </div>
      </form>
      <div className="mt-4">
        <p>ğŸ‘¨ï¼š{formData.firstName} {formData.lastName}</p>
        <p>ğŸ“®ï¼š{formData.email}</p>
      </div>
    </div>
  );
}
```

é€šè¿‡è¿™äº›æ–¹æ³•ï¼ŒReact å¯ä»¥è¯†åˆ« state æ›´æ–°å¹¶æ­£ç¡®è§¦å‘æ¸²æŸ“ï¼Œé¿å… mutation å¸¦æ¥çš„é—®é¢˜ã€‚

## æ‘˜è¦

- åœ¨ React ä¸­ï¼Œ**ä¸è¦ç›´æ¥ä¿®æ”¹ state**ï¼Œå› ä¸º state è¢«è§†ä¸ºä¸å¯ç›´æ¥æ›´æ”¹ã€‚
- å¦‚æœ state æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç›´æ¥ä¿®æ”¹å¯¹è±¡çš„å±æ€§ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œä¹Ÿä¼šå½±å“ä¹‹å‰çš„æ¸²æŸ“â€œå¿«ç…§â€ã€‚
- **æ­£ç¡®çš„åšæ³•**æ˜¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„**æ–°å‰¯æœ¬**ï¼Œç„¶åç”¨è¿™ä¸ªæ–°å‰¯æœ¬æ›¿æ¢æ—§ stateï¼Œä»è€Œè§¦å‘é‡æ–°æ¸²æŸ“ã€‚
- ä½ å¯ä»¥ç”¨ **`{...obj, something: 'newValue'}`** çš„ **å±•å¼€è¯­æ³•**æ¥å¿«é€Ÿå¤åˆ¶å¯¹è±¡ï¼Œå¹¶æ›´æ–°éœ€è¦ä¿®æ”¹çš„å±æ€§ã€‚
- **æ³¨æ„**ï¼šå±•å¼€è¯­æ³•åªèƒ½å¤åˆ¶ä¸€å±‚ã€‚å¦‚æœå¯¹è±¡æœ‰åµŒå¥—ç»“æ„ï¼Œéœ€è¦é€å±‚åˆ›å»ºæ–°çš„å¯¹è±¡æ‹·è´ã€‚
- å¦‚æœè§‰å¾—æ‰‹åŠ¨å¤„ç†æ‹·è´ä»£ç å¤ªéº»çƒ¦ï¼Œå¯ä»¥å€ŸåŠ©å·¥å…·åº“ï¼Œæ¯”å¦‚ **Immer**ï¼Œæ¥ç®€åŒ–æ“ä½œã€‚

# æ›´æ–°State ä¸­çš„æ•°ç»„

@See https://zh-hans.react.dev/learn/updating-arrays-in-state

## å¸¸è§æ•°ç»„æ“ä½œå‚è€ƒè¡¨

å½“æ“ä½œ React state ä¸­çš„æ•°ç»„æ—¶ï¼Œä½ éœ€è¦é¿å…ä½¿ç”¨å·¦åˆ—çš„æ“ä½œæ–¹æ³•ï¼Œæ¨èä½¿ç”¨å³åˆ—çš„æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä½ ä¸ä¼šç›´æ¥ä¿®æ”¹åŸå§‹æ•°ç»„ï¼š

| #        | é¿å…ä½¿ç”¨ (ä¼šæ”¹å˜åŸå§‹æ•°ç»„)     | æ¨èä½¿ç”¨ (ä¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼‰                                 |
| -------- | ----------------------------- | ------------------------------------------------------------ |
| æ·»åŠ å…ƒç´  | `push`ï¼Œ`unshift`             | `concat`ï¼Œ`[...arr]` å±•å¼€è¯­æ³•ï¼ˆ[ä¾‹å­](https://zh-hans.react.dev/learn/updating-arrays-in-state#adding-to-an-array)ï¼‰ |
| åˆ é™¤å…ƒç´  | `pop`ï¼Œ`shift`ï¼Œ`splice`      | `filter`ï¼Œ`slice`ï¼ˆ[ä¾‹å­](https://zh-hans.react.dev/learn/updating-arrays-in-state#removing-from-an-array)ï¼‰ |
| æ›¿æ¢å…ƒç´  | `splice`ï¼Œ`arr[i] = ...` èµ‹å€¼ | `map`ï¼ˆ[ä¾‹å­](https://zh-hans.react.dev/learn/updating-arrays-in-state#replacing-items-in-an-array)ï¼‰ |
| æ’åº     | `reverse`ï¼Œ`sort`             | å…ˆå°†æ•°ç»„å¤åˆ¶ä¸€ä»½ï¼ˆ[ä¾‹å­](https://zh-hans.react.dev/learn/updating-arrays-in-state#making-other-changes-to-an-array)ï¼‰ |

æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ [ä½¿ç”¨ Immer](https://zh-hans.react.dev/learn/updating-arrays-in-state#write-concise-update-logic-with-immer)ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¡¨æ ¼ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚

## ä¸ºä»€ä¹ˆé¿å…ç›´æ¥ä¿®æ”¹æ•°ç»„ï¼Ÿ

ç›´æ¥ä¿®æ”¹æ•°ç»„ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

1. **React ä¸ä¼šæ£€æµ‹åˆ°æ•°ç»„å˜åŒ–ï¼š** React æ˜¯é€šè¿‡å¼•ç”¨æ¯”è¾ƒæ¥æ£€æµ‹æ•°ç»„å˜åŒ–çš„ï¼Œç›´æ¥ä¿®æ”¹æ•°ç»„çš„å…ƒç´ ä¸ä¼šæ”¹å˜å®ƒçš„å¼•ç”¨ï¼Œä»è€Œæ— æ³•è§¦å‘è§†å›¾çš„æ›´æ–°ã€‚

2. **ç ´åä¸å¯å˜æ€§ï¼š** ä¿®æ”¹åŸå§‹æ•°ç»„è¿åäº† React æ¨èçš„ä¸å¯å˜æ€§åŸåˆ™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸å¯é¢„æ–™çš„å‰¯ä½œç”¨ï¼Œå½±å“åº”ç”¨çš„ç¨³å®šæ€§ã€‚

3. **è°ƒè¯•å›°éš¾ï¼š** ç›´æ¥ä¿®æ”¹æ•°ç»„ä¼šä½¿å¾—å†å²çŠ¶æ€å˜å¾—ä¸æ¸…æ™°ï¼Œè°ƒè¯•æ—¶éš¾ä»¥è·Ÿè¸ªçŠ¶æ€çš„å˜åŒ–ã€‚

## å¦‚ä½•æ­£ç¡®æ›´æ–°æ•°ç»„ï¼Ÿ

1ï¼‰**æ·»åŠ å…ƒç´ ï¼š**

ä½ å¯ä»¥ä½¿ç”¨ concat æˆ–è€…å±•å¼€è¯­æ³• [...] æ¥æ·»åŠ å…ƒç´ ï¼š

```tsx
const arr = [1, 2, 3];
// 1. ä½¿ç”¨å±•å¼€è¯­æ³•
const updatedArr = [...arr, 4];  
// 2. ä½¿ç”¨ concat æ–¹æ³•
const updatedArr = arr.concat(4);  
```

2ï¼‰**åˆ é™¤å…ƒç´ ï¼š**

ä½¿ç”¨ filter æˆ–è€… slice æ¥åˆ é™¤å…ƒç´ ï¼š

```tsx
const arr = [1, 2, 3];
// 1. åˆ é™¤å…ƒç´  2
const updatedArr = arr.filter(item => item !== 2);  
// 2. åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ 
const updatedArr = arr.slice(0, 2); 
```

3ï¼‰**æ›¿æ¢å…ƒç´ ï¼š**

ä½¿ç”¨ map æ¥æ›¿æ¢æ•°ç»„ä¸­çš„å…ƒç´ ï¼š

```tsx
const arr = [1, 2, 3];
const updatedArr = arr.map(item => item === 2 ? 4 : item);  // æ›¿æ¢å…ƒç´  2 ä¸º 4
```

4ï¼‰**æ’åºï¼š**

é¦–å…ˆå¤åˆ¶æ•°ç»„ï¼Œç„¶åä½¿ç”¨ sort æˆ– reverse è¿›è¡Œæ’åºï¼š

```tsx
const arr = [3, 1, 2];
const updatedArr = [...arr].sort();  // æ’åº
```

## ä½¿ç”¨ Immer è®©ä»£ç æ›´ç®€æ´

å¦‚æœä½ æƒ³è¦ç®€åŒ–æ›´æ–°æ•°ç»„çš„æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ Immerã€‚å®ƒå…è®¸ä½ ç›´æ¥ä¿®æ”¹æ•°ç»„ï¼ŒImmer ä¼šå¤„ç†å¥½ä¸å¯å˜æ€§å’ŒçŠ¶æ€æ›´æ–°çš„é—®é¢˜ã€‚

é€šè¿‡ Immerï¼Œä½ å¯ä»¥ç›´æ¥æ“ä½œæ•°ç»„å¹¶è®©å®ƒè‡ªåŠ¨è¿”å›æ–°çš„æ•°ç»„å‰¯æœ¬ï¼Œç®€åŒ–ä»£ç ï¼š

```tsx
import { useImmer } from "use-immer";

export default function App() {
  const [arr, updateArr] = useImmer([1, 2, 3]);

  const addItem = () => {
    updateArr((draft) => {
      draft.push(4); // ç›´æ¥ä¿®æ”¹ draftï¼ŒImmer ä¼šå¸®ä½ å¤„ç†ä¸å¯å˜æ€§
    });
  };

  return <div>{arr.join(", ")}</div>;
}
```

## æ‘˜è¦

- åœ¨ React ä¸­æ“ä½œæ•°ç»„æ—¶ï¼Œ**ä¸è¦ç›´æ¥ä¿®æ”¹åŸæ•°ç»„**ï¼Œè€Œæ˜¯åˆ›å»ºæ–°çš„æ•°ç»„å‰¯æœ¬ã€‚
- ä½¿ç”¨ **`[...arr, newItem`**] æˆ– **`concat`** æ¥æ·»åŠ å…ƒç´ ã€‚
- ä½¿ç”¨ **`filter()`** å’Œ **`map()`** æ¥å¤„ç†åˆ é™¤å’Œæ›¿æ¢å…ƒç´ ã€‚
- å¦‚æœéœ€è¦ç®€åŒ–æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ Immer åº“æ¥ä¿æŒä»£ç ç®€æ´ï¼Œå¹¶ä¸”æ— éœ€æ‰‹åŠ¨å¤„ç†ä¸å¯å˜æ€§ã€‚
