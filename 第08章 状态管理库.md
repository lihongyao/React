# æ¦‚è§ˆ

React çš„å¤–éƒ¨çŠ¶æ€ç®¡ç†ä¸€ç›´æ˜¯ä¸€ä¸ªç«äº‰æ¿€çƒˆçš„é¢†åŸŸï¼Œç”Ÿæ€ä¸­æ¶Œç°äº†è®¸å¤šä¼˜ç§€çš„çŠ¶æ€ç®¡ç†åº“ï¼Œå¦‚ Reduxï¼ˆä»¥åŠåŸºäº Redux çš„ Dvaã€Icestoreï¼‰ã€Mobxã€Zustandã€Recoilã€Jotaiã€Valtioã€Hox ç­‰ã€‚

ä» [npmtrends >>](https://npmtrends.com/hox-vs-jotai-vs-mobx-vs-recoil-vs-redux-vs-valtio-vs-zustand) è¿‘ä¸€å¹´çš„ npm ä¸‹è½½é‡æ¥çœ‹ï¼ŒRedux ä¾ç„¶æ˜¯æœ€å—æ¬¢è¿çš„çŠ¶æ€ç®¡ç†åº“ä¹‹ä¸€ã€‚å› æ­¤ï¼Œæœ¬æ–‡å°†é‡ç‚¹ä»‹ç» Redux çš„ä½¿ç”¨æ–¹æ³•ã€‚

## Redux æ˜¯ä»€ä¹ˆâ“

[Redux >>](https://cn.redux.js.org/) æ˜¯ä¸€ä¸ª JavaScript åº”ç”¨çš„**çŠ¶æ€ç®¡ç†å®¹å™¨**ï¼Œæä¾›å¯é¢„æµ‹çš„æ•°æ®æµç®¡ç†ã€‚

> æ‘˜è‡ªå®˜ç½‘ï¼š*Redux æ˜¯ä¸€ä¸ªä½¿ç”¨ **action** äº‹ä»¶æ¥ç®¡ç†å’Œæ›´æ–°åº”ç”¨çŠ¶æ€çš„æ¨¡å¼å’Œå·¥å…·åº“ã€‚å®ƒé‡‡ç”¨é›†ä¸­å¼* *Store* *å¯¹åº”ç”¨çš„çŠ¶æ€è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œå¹¶ç¡®ä¿çŠ¶æ€åªèƒ½ä»¥å¯é¢„æµ‹çš„æ–¹å¼æ›´æ–°ã€‚*

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Reduxâ“

Redux ä¸»è¦ç”¨äºç®¡ç†**å…¨å±€çŠ¶æ€**â€”â€”ä¹Ÿå°±æ˜¯å¤šä¸ªç»„ä»¶éƒ½éœ€è¦è®¿é—®å’Œä¿®æ”¹çš„çŠ¶æ€ã€‚

**Redux æä¾›äº†ä¸€ç§æ¨¡å¼å’Œå·¥å…·ï¼Œä½¿ä½ èƒ½å¤Ÿæ¸…æ™°åœ°ç†è§£åº”ç”¨çŠ¶æ€çš„å˜æ›´è¿‡ç¨‹ï¼šä½•æ—¶ã€ä½•åœ°ã€ä¸ºä½•å‘ç”Ÿï¼ŒåŠå…¶å¯¹åº”ç”¨é€»è¾‘çš„å½±å“ã€‚**

æ­¤å¤–ï¼ŒRedux å¼ºè°ƒ**å¯é¢„æµ‹æ€§**å’Œ**å¯æµ‹è¯•æ€§**ï¼Œè¿™ä½¿å¾—ä»£ç æ›´æ˜“ç»´æŠ¤ï¼Œä¹Ÿèƒ½ç¡®ä¿åº”ç”¨æŒ‰é¢„æœŸè¿è¡Œã€‚

## ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Reduxâ“

è™½ç„¶ Redux åœ¨ç®¡ç†å…±äº«çŠ¶æ€æ—¶éå¸¸æœ‰ç”¨ï¼Œä½†å®ƒä¹Ÿå¸¦æ¥äº†ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œå¹¶è¦æ±‚éµå¾ªç‰¹å®šçš„æ¨¡å¼ã€‚å› æ­¤ï¼Œåœ¨å†³å®šæ˜¯å¦ä½¿ç”¨ Redux æ—¶ï¼Œéœ€è¦æƒè¡¡åˆ©å¼Šã€‚

ä»¥ä¸‹æƒ…å†µé€‚åˆä½¿ç”¨ Reduxï¼š

- **åº”ç”¨ä¸­æœ‰è®¸å¤š state éœ€è¦åœ¨å¤šä¸ªç»„ä»¶é—´å…±äº«**
- **state éœ€è¦é¢‘ç¹æ›´æ–°**
- **state æ›´æ–°é€»è¾‘è¾ƒä¸ºå¤æ‚**
- **é¡¹ç›®è§„æ¨¡è¾ƒå¤§ï¼Œå›¢é˜Ÿåä½œå¼€å‘ï¼ŒçŠ¶æ€ç®¡ç†éœ€è¦æ ‡å‡†åŒ–**

> **æ³¨æ„**ï¼š**å¹¶éæ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½éœ€è¦ Redux**ã€‚å¦‚æœä½ çš„åº”ç”¨çŠ¶æ€ç®¡ç†éœ€æ±‚è¾ƒç®€å•ï¼Œæˆ–è€…ç»„ä»¶çŠ¶æ€ä¸»è¦æ˜¯å±€éƒ¨çš„ï¼ŒReact å†…ç½®çš„ useState å’Œ useReducer å¯èƒ½æ›´åˆé€‚ã€‚

## Redux ç›¸å…³åº“å’Œå·¥å…·â“

Redux æœ¬èº«æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ JS åº“ï¼Œä½†é€šå¸¸ä¸ä»¥ä¸‹å·¥å…·é…åˆä½¿ç”¨ï¼š

- **React-Redux**

  Redux å¯ä»¥ä¸ä»»ä½• UI æ¡†æ¶ç»“åˆä½¿ç”¨ï¼Œè€Œ [**React-Redux**](https://cn.react-redux.js.org/) æ˜¯å®˜æ–¹æ¨èçš„ React ç»‘å®šåº“ã€‚å®ƒæä¾›äº†ä¸€ç§é«˜æ•ˆçš„æ–¹å¼ï¼Œä½¿ React ç»„ä»¶èƒ½å¤Ÿè®¿é—® Redux stateï¼Œå¹¶é€šè¿‡ dispatch è§¦å‘çŠ¶æ€æ›´æ–°ã€‚

- **Redux Toolkit**

  [**Redux Toolkit (RTK)**](https://cn.redux-toolkit.js.org/) æ˜¯å®˜æ–¹æ¨èçš„ Redux ä»£ç ç¼–å†™æ–¹å¼ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—å®ç”¨å·¥å…·ï¼Œä½¿ Redux å¼€å‘æ›´åŠ ç®€æ´é«˜æ•ˆï¼ŒåŒ…æ‹¬ï¼š
  
  - **ç®€åŒ– Redux ä»£ç **ï¼Œå‡å°‘æ¨¡æ¿ä»£ç ï¼ˆboilerplateï¼‰
  - **æä¾› Redux é€»è¾‘çš„æœ€ä½³å®è·µ**ï¼Œé™ä½å‡ºé”™æ¦‚ç‡
  - **å†…ç½® Immerï¼Œæ”¯æŒæ›´ç›´è§‚çš„ state å˜æ›´æ–¹å¼**
  - **é›†æˆ RTK Queryï¼Œæ–¹ä¾¿è¿›è¡Œæ•°æ®è¯·æ±‚ç®¡ç†**
  
- **Redux DevTools** 

  [**Redux DevTools**](https://github.com/zalmoxisus/redux-devtools-extension) æ˜¯ä¸€æ¬¾å¼ºå¤§çš„è°ƒè¯•å·¥å…·ï¼Œå¯è·Ÿè¸ª Redux çŠ¶æ€çš„å˜åŒ–ï¼Œå¹¶æä¾›â€œæ—¶é—´æ—…è¡Œè°ƒè¯•â€ç­‰åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…æ›´ç›´è§‚åœ°ç†è§£çŠ¶æ€æµè½¬è¿‡ç¨‹ã€‚

# ç›¸å…³æ¦‚å¿µ

## ğŸ‘‰ ä¸å¯å˜æ€§ï¼ˆimmutableï¼‰

åœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡å’Œæ•°ç»„é»˜è®¤æ˜¯ **å¯å˜çš„ï¼ˆmutableï¼‰**ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹å®ƒä»¬çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼š

```typescript
const person = {
  name: 'å¼ ä¸‰',
  car: {
    brand: 'ä¸œé£æœ¬ç”°Â·æ€åŸŸ',
    color: 'çç ç™½',
  }
};

// -- ä¿®æ”¹å¯¹è±¡å†…éƒ¨å±æ€§ï¼ˆå¯å˜æ“ä½œï¼‰
person.car.color = 'ç‚«åŠ¨è“'; 
```

å°½ç®¡ person çš„å¼•ç”¨æ²¡æœ‰å˜åŒ–ï¼Œä½†å…¶å†…éƒ¨å†…å®¹å·²è¢«ä¿®æ”¹ã€‚è¿™ç§ç›´æ¥ä¿®æ”¹å¯¹è±¡çš„æ–¹å¼å¯èƒ½å¯¼è‡´éš¾ä»¥è·Ÿè¸ªçŠ¶æ€å˜åŒ–ï¼Œå¢åŠ è°ƒè¯•éš¾åº¦ã€‚

**âœ… ä¸å¯å˜æ›´æ–°æ–¹å¼**

ä¸ºäº†ä¿è¯çŠ¶æ€çš„å¯è¿½è¸ªæ€§å’Œ Redux çš„æ­£ç¡®è¿è¡Œï¼Œæˆ‘ä»¬åº”è¯¥ **ä½¿ç”¨ä¸å¯å˜ï¼ˆimmutableï¼‰æ–¹å¼æ›´æ–°çŠ¶æ€**ï¼Œå³ **åˆ›å»ºæ–°çš„å¯¹è±¡** è€Œä¸æ˜¯ä¿®æ”¹åŸå¯¹è±¡ï¼š

```typescript
const updatedPerson = {
  ...person,
  car: {
    ...person.car,
    color: 'ç‚«åŠ¨è“',
  },
};
```

åœ¨ Redux ä¸­ï¼Œ**æ‰€æœ‰çŠ¶æ€æ›´æ–°å¿…é¡»æ˜¯ä¸å¯å˜çš„**ã€‚

> **æç¤º**ï¼šä½¿ç”¨ **Redux Toolkit** æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ reducers é‡Œå†™â€œçœ‹ä¼¼å¯å˜â€çš„ä»£ç ï¼Œå› ä¸º Redux Toolkit å†…éƒ¨ä½¿ç”¨ immerï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸å¯å˜çŠ¶æ€ã€‚ä¾‹å¦‚ï¼š
>
> ```js
> const personSlice = createSlice({
>   name: 'person',
>   initialState: {
>     name: 'å¼ ä¸‰',
>     car: { brand: 'ä¸œé£æœ¬ç”°Â·æ€åŸŸ', color: 'çç ç™½' }
>   },
>   reducers: {
>     changeCarColor: (state, action) => {
>       // -- è¿™é‡Œçœ‹ä¼¼ä¿®æ”¹äº† stateï¼Œå®é™… immer ä¼šç”Ÿæˆä¸€ä¸ªæ–°çŠ¶æ€
>       state.car.color = action.payload; 
>     }
>   }
> });
> ```

## ğŸ‘‰ å•å‘æ•°æ®æµ

åœ¨ React ä¸­ï¼Œæ•°æ®æµæ˜¯ **å•å‘çš„**ï¼Œå³ **æ•°æ®æ€»æ˜¯ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶**ã€‚

æ¢ä¸ªè§’åº¦ç†è§£ï¼Œå•å‘æ•°æ®æµç±»ä¼¼äº **èº«ä»½è¯ç®¡ç†**ï¼š

1. **æ”¿åºœï¼ˆçˆ¶ç»„ä»¶ï¼‰** å‘æ”¾èº«ä»½è¯ï¼ˆpropsï¼‰ã€‚
2. å¦‚æœä½ æƒ³ä¿®æ”¹èº«ä»½è¯ä¸Šçš„ä¿¡æ¯ï¼Œ**ä¸èƒ½è‡ªå·±æ”¹**ï¼Œè€Œæ˜¯è¦å»æ”¿åºœç”³è¯·å˜æ›´ã€‚
3. **æ”¿åºœï¼ˆçˆ¶ç»„ä»¶ï¼‰** å®¡æ‰¹åé‡æ–°å‘æ”¾æ–°çš„èº«ä»½è¯ï¼Œå­ç»„ä»¶æ¥æ”¶æ›´æ–°åçš„æ•°æ®ã€‚

åœ¨ React ä¸­ï¼Œå­ç»„ä»¶ **ä¸èƒ½ç›´æ¥ä¿®æ”¹ props**ï¼Œåªèƒ½è°ƒç”¨çˆ¶ç»„ä»¶æä¾›çš„å›è°ƒå‡½æ•°è®©å…¶ä¿®æ”¹ stateï¼Œç„¶å state å˜åŒ–åå†é‡æ–°æ¸²æŸ“å­ç»„ä»¶ã€‚è¿™å°±æ˜¯ **å•å‘æ•°æ®æµ** çš„æ ¸å¿ƒæ¦‚å¿µã€‚

**ç¤ºä¾‹ï¼šReact ç»„ä»¶ä¸­çš„å•å‘æ•°æ®æµ**

```js
function ParentComponent() {
  const [name, setName] = useState('å¼ ä¸‰');

  return <ChildComponent name={name} changeName={setName} />;
}

function ChildComponent({ name, changeName }) {
  return (
    <div>
      <p>å§“åï¼š{name}</p>
      <button onClick={() => changeName('æå¥½å¸…')}>ä¿®æ”¹å§“å</button>
    </div>
  );
}
```

## ğŸ‘‰ Redux æ•°æ®æµ

Redux é€šè¿‡ **å…¨å±€ store** ç®¡ç†åº”ç”¨çŠ¶æ€ï¼Œå¹¶æä¾› **å”¯ä¸€çš„çŠ¶æ€æº**ï¼Œè§£å†³äº† React ç»„ä»¶ä¹‹é—´æ•°æ®ä¼ é€’å¤æ‚çš„é—®é¢˜ã€‚

Redux çš„æ•°æ®æµ **å§‹ç»ˆæ˜¯å•å‘çš„**ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

1. **åˆå§‹å¯åŠ¨**

   - ä½¿ç”¨ **root reducer** åˆ›å»º Redux storeã€‚
   - store è°ƒç”¨ reducer è®¡ç®— **åˆå§‹çŠ¶æ€** å¹¶å­˜å‚¨èµ·æ¥ã€‚
   - UI ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œ**ä» store è¯»å–çŠ¶æ€** å¹¶ç›‘å¬å˜åŒ–ã€‚

2. **æ›´æ–°çŠ¶æ€**

   - **ç”¨æˆ·äº¤äº’**ï¼ˆä¾‹å¦‚ç‚¹å‡»æŒ‰é’®ï¼‰ã€‚

   - ç»„ä»¶ **dispatchï¼ˆæ´¾å‘ï¼‰ä¸€ä¸ª action**ï¼š

     ```js
     dispatch({ type: 'counter/increment' });
     ```

   - Redux store **æ¥æ”¶ action**ï¼Œè°ƒç”¨ reducer **è®¡ç®—æ–° state** å¹¶å­˜å‚¨ã€‚

   - store **é€šçŸ¥ UI ç»„ä»¶** çŠ¶æ€å·²æ›´æ–°ï¼Œè§¦å‘ **é‡æ–°æ¸²æŸ“**ã€‚

**Redux æ•°æ®æµç¤ºæ„å›¾**

<img src="./IMGs/ReduxDataFlowDiagram.gif" style="zoom: 33%;" />

1. **UI ç»„ä»¶** è§¦å‘ **ç”¨æˆ·æ“ä½œ**ï¼ˆå¦‚ç‚¹å‡» Deposit $10ï¼‰ã€‚
2. è§¦å‘ **äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆEvent Handlerï¼‰**ï¼Œç„¶å dispatch ä¸€ä¸ª actionã€‚
3. store æ”¶åˆ° actionï¼Œäº¤ç”± reducer å¤„ç†ã€‚
4. reducer è®¡ç®—å‡º **æ–° state** å¹¶å­˜å…¥ storeã€‚
5. **UI ç»„ä»¶æ”¶åˆ°æ›´æ–°çš„ stateï¼Œé‡æ–°æ¸²æŸ“**ã€‚

## ğŸ“– å°ç»“

1. **ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰**ï¼šRedux æœŸæœ›æ‰€æœ‰çŠ¶æ€æ›´æ–°éƒ½ä½¿ç”¨ **ä¸å¯å˜çš„æ–¹å¼**ï¼Œå¯ä»¥ä½¿ç”¨ **å±•å¼€è¿ç®—ç¬¦** æˆ– immer å¤„ç†çŠ¶æ€æ›´æ–°ã€‚
2. **å•å‘æ•°æ®æµ**ï¼šæ•°æ®ä» store  â†’ UI ç»„ä»¶ï¼ŒUI ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ storeï¼Œåªèƒ½ dispatch ä¸€ä¸ª action é€šçŸ¥ Redux å¤„ç†æ›´æ–°ã€‚
3. **Redux æ•°æ®æµ**ï¼šUI ç»„ä»¶è§¦å‘ dispatch â†’ reducer å¤„ç† state â†’ store æ›´æ–° state â†’ UI ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

# ä¸‰å¤§åŸåˆ™

## 1ï¸âƒ£ å•ä¸€æ•°æ®æº

æ•´ä¸ªåº”ç”¨çš„å…¨å±€çŠ¶æ€ä»¥ **å¯¹è±¡æ ‘** çš„å½¢å¼å­˜å‚¨åœ¨ **å”¯ä¸€çš„ store** ä¸­ã€‚è¿™ç¡®ä¿äº†ï¼š

1. çŠ¶æ€çš„ç®¡ç†æ›´åŠ é›†ä¸­ï¼Œä¾¿äºè°ƒè¯•å’Œå›æº¯ã€‚
2. ç»„ä»¶å¯ä»¥é€šè¿‡ store è®¿é—®æ‰€éœ€çš„çŠ¶æ€ï¼Œè€Œä¸éœ€è¦å±‚å±‚ä¼ é€’ propsã€‚

## 2ï¸âƒ£ State æ˜¯åªè¯»çš„

Redux è§„å®š **çŠ¶æ€ä¸èƒ½ç›´æ¥ä¿®æ”¹**ï¼Œå”¯ä¸€æ”¹å˜ state çš„æ–¹æ³•æ˜¯ **è§¦å‘ action**ï¼Œå³ï¼š

```js
dispatch({ type: 'INCREMENT' });
```

è¿™æ ·åšçš„å¥½å¤„ï¼š

1. çŠ¶æ€çš„å˜åŒ– **å¯é¢„æµ‹**ï¼Œé¿å…ä¸å¯æ§çš„ä¿®æ”¹ã€‚
2. ä¾¿äºè®°å½•å’Œå›æº¯çŠ¶æ€ï¼ˆRedux DevTools å¯ä»¥è·Ÿè¸ª action è§¦å‘å†å²ï¼‰ã€‚
3. ç¡®ä¿æ•°æ®æµæ˜¯ **å•å‘çš„**ï¼Œä½¿åº”ç”¨é€»è¾‘æ›´æ¸…æ™°ã€‚

## 3ï¸âƒ£ ä½¿ç”¨çº¯å‡½æ•° reducer è¿›è¡ŒçŠ¶æ€æ›´æ–°

çŠ¶æ€çš„æ›´æ–°é€»è¾‘å¿…é¡»é€šè¿‡ **reducer çº¯å‡½æ•°** è¿›è¡Œï¼Œreducer åªä¾èµ–ï¼š

1. **æ—§çš„ state**
2. **action æŒ‡å®šçš„å˜åŒ–**

```js
function counterReducer(state = 0, action) {
  switch (action.type) {
    case 'INCREMENT':
      return state + 1;
    case 'DECREMENT':
      return state - 1;
    default:
      return state;
  }
}
```

reducer çº¯å‡½æ•°çš„ç‰¹æ€§ï¼š

1. **æ— å‰¯ä½œç”¨**ï¼šä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼Œä¸èƒ½æ‰§è¡Œå¼‚æ­¥æ“ä½œã€ä¿®æ”¹ DOM æˆ–è¿›è¡Œ API è°ƒç”¨ã€‚
2. **è¿”å›æ–°çŠ¶æ€**ï¼šæ€»æ˜¯åŸºäº state å’Œ action è®¡ç®—å‡º **ä¸€ä¸ªæ–°çŠ¶æ€å¯¹è±¡**ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸçŠ¶æ€ã€‚

# Redux æœ¯è¯­

## Actions

Action æ˜¯ä¸€ä¸ªç”¨äºæè¿°**å‘ç”Ÿäº†ä»€ä¹ˆ**çš„æ™®é€š JavaScript å¯¹è±¡ã€‚å®ƒæ˜¯ Redux **æ•°æ®æµçš„å”¯ä¸€æ¥æº**ï¼Œé€šå¸¸ç”± dispatch(action) å‘é€åˆ° storeï¼Œä»è€Œè§¦å‘ reducer è®¡ç®—æ–°çš„ stateã€‚

æˆ‘ä»¬çº¦å®šï¼Œaction çš„ç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼š

```typescript
interface PayloadAction<T = any> {
  type: string;
  payload: T;
}
```

è¯­æ³•è§£è¯»ï¼š

- `type`ï¼šè¡¨ç¤ºå°†è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œæ¯”å¦‚ `todos/todoAdded`ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠé‚£ä¸ªç±»å‹çš„å­—ç¬¦ä¸²å†™æˆ ã€Œ**åŸŸ/äº‹ä»¶åç§°**ã€çš„å½¢å¼ï¼Œå…¶ä¸­ç¬¬ä¸€éƒ¨åˆ†æ˜¯è¿™ä¸ª action æ‰€å±çš„ç‰¹å¾æˆ–ç±»åˆ«ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å‘ç”Ÿçš„å…·ä½“äº‹æƒ…ã€‚
- `payload`ï¼šæ‰€éœ€çš„å‚æ•°ï¼Œæ¯”å¦‚  `todos/todoAdded` è¡¨ç¤ºæ·»åŠ ä¸€ä¸ªå¾…åŠäº‹é¡¹ï¼Œé‚£å¾…åŠäº‹é¡¹çš„å…·ä½“å†…å®¹å¯ä»¥é€šè¿‡ payload ä¼ é€’ã€‚

ä¸€ä¸ªå…¸å‹çš„ action å¯¹è±¡å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
const addTodoAction = {
  type: 'todos/todoAdded',
  payload: 'Learn to program.'
}
```

**ğŸ‘‰ Action-Creators**

 Action-Creators æ˜¯ä¸€ä¸ªåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª action å¯¹è±¡çš„å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®©ä½ ä¸å¿…æ¯æ¬¡éƒ½æ‰‹åŠ¨ç¼–å†™ action å¯¹è±¡ï¼š

```typescript
export const todoAdded = (todoText: string) => ({
  type: 'todos/todoAdded',
  payload: todoText,
});
```

> **æç¤º**ï¼šAction Creator ä¸æ˜¯ Redux å¿…é¡»çš„åŠŸèƒ½ï¼Œä½† **æ¨èä½¿ç”¨**ã€‚å®ƒèƒ½è®©ä»£ç æ›´æ¸…æ™°ã€æ˜“ç»´æŠ¤ï¼Œå¹¶ä¸”æ”¯æŒå¼‚æ­¥æ“ä½œï¼Œå¯¹äºç®€å•åº”ç”¨ï¼Œå¯ä»¥ç›´æ¥ dispatch(action)ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ Action Creator èƒ½æé«˜ä»£ç è´¨é‡ã€‚

## Reducers

Reducer æ˜¯ä¸€ä¸ª**çº¯å‡½æ•°**ï¼Œç”¨äºæ ¹æ® action è®¡ç®—å¹¶è¿”å›æ–°çš„ stateã€‚Reducer ä¸èƒ½ç›´æ¥ä¿®æ”¹æ—§çš„ stateï¼Œè€Œæ˜¯è¦è¿”å›ä¸€ä¸ªæ–°çš„ state å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼š

```js
function counterReducer(state = { count: 0 }, action) {
  switch (action.type) {
    case 'INCREMENT':
      return { count: state.count + action.payload.amount };
    case 'DECREMENT':
      return { count: state.count - action.payload.amount };
    default:
      return state;
  }
}
```

## Store

[**Store**](https://cn.redux.js.org/api/store) æ˜¯ Redux æä¾›çš„ **å”¯ä¸€** æ•°æ®æºï¼Œæ˜¯ Redux åº”ç”¨çš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨æ•´ä¸ªåº”ç”¨çš„**çŠ¶æ€æ ‘**ï¼ˆstate treeï¼‰ã€‚åº”ç”¨ä¸­çš„çŠ¶æ€ï¼ˆstateï¼‰å§‹ç»ˆå­˜å‚¨åœ¨ store å†…éƒ¨ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡**æ´¾å‘ï¼ˆdispatchï¼‰action** æ¥ä¿®æ”¹ã€‚ä¸€ä¸ª Redux åº”ç”¨é€šå¸¸åªæœ‰ä¸€ä¸ª storeï¼Œä»¥ç¡®ä¿çŠ¶æ€ç®¡ç†çš„å•ä¸€æ€§ã€‚

Store æœ‰ä»¥ä¸‹èŒè´£ï¼š

- åœ¨å†…éƒ¨ä¿å­˜å½“å‰åº”ç”¨ç¨‹åº state
- é€šè¿‡ [`store.getState()`](https://cn.redux.js.org/api/store#getState) è®¿é—®å½“å‰ state;
- é€šè¿‡ [`store.dispatch(action)`](https://cn.redux.js.org/api/store#dispatch) æ›´æ–°çŠ¶æ€;
- é€šè¿‡ [`store.subscribe(listener)`](https://cn.redux.js.org/api/store#subscribe) æ³¨å†Œç›‘å¬å™¨å›è°ƒ;
- é€šè¿‡ [`store.subscribe(listener)`](https://cn.redux.js.org/api/store#subscribe) è¿”å›çš„ `unsubscribe` å‡½æ•°æ³¨é”€ç›‘å¬å™¨ã€‚

> æ³¨æ„ï¼šstoreæ˜¯åªè¯»çš„ï¼ŒRedux æ²¡æœ‰æä¾›ç›´æ¥ä¿®æ”¹æ•°æ®çš„æ–¹æ³•ï¼Œæ”¹å˜stateçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯è§¦å‘ï¼ˆ**dispatch**ï¼‰ **action** ã€‚

## Dispatchï¼ˆæ´¾å‘ï¼‰

`dispatch(action)` æ˜¯ Redux store æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå‘ store å‘é€ actionï¼Œä»è€Œè§¦å‘ reducer è®¡ç®—æ–°çš„ stateã€‚

ä¾‹å¦‚ï¼š

```js
store.dispatch({ type: 'INCREMENT', payload: { amount: 1 } });
```

## Subscribeï¼ˆè®¢é˜…ï¼‰

`subscribe(listener)` å…è®¸æ³¨å†Œä¸€ä¸ªç›‘å¬å‡½æ•°ï¼Œæ¯å½“ state å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¯¥ç›‘å¬å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚é€šå¸¸ç”¨äº UI ç»„ä»¶å“åº” state å˜åŒ–ã€‚

ä¾‹å¦‚ï¼š
```js
const unsubscribe = store.subscribe(() => {
  console.log('State updated:', store.getState());
});

store.dispatch({ type: 'INCREMENT', payload: { amount: 1 } });

// å–æ¶ˆè®¢é˜…
unsubscribe();
```

## Selectorsï¼ˆé€‰æ‹©å™¨ï¼‰

Selector æ˜¯ä¸€ä¸ª**çº¯å‡½æ•°**ï¼Œç”¨äºä» state ä¸­æå–æ‰€éœ€çš„æ•°æ®ï¼Œå‡å°‘ç»„ä»¶çš„è€¦åˆï¼Œå¹¶ä¼˜åŒ–æ€§èƒ½ã€‚

å¦‚ä¸‹æ‰€ç¤ºï¼š

```typescript
// â†’ xxxSlice.ts
export const selectCount = (state: RootState) => state.counter.value;
```

åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¿é—®ï¼š

```tsx
import { useSelector } from 'react-redux';
const count = useSelector(selectCount);
```

ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨çš„åœ°æ–¹ä»¥å†…è”çš„æ–¹å¼å®šä¹‰ï¼š

```typescript
const count = useSelector((state: RootState) => state.counter.value)
```

## Redux Slice

**ğŸ‘‰  [Redux-Toolkit >>](https://cn.redux-toolkit.js.org/)**

**â€œSliceâ€ æ˜¯åº”ç”¨ä¸­å•ä¸ªåŠŸèƒ½çš„ Redux-Reducer é€»è¾‘å’Œ action çš„é›†åˆ**ï¼Œé€šå¸¸ä¸€èµ·å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¯¥åç§°æ¥è‡ªäºå°†æ ¹ Redux çŠ¶æ€å¯¹è±¡æ‹†åˆ†ä¸ºå¤šä¸ªçŠ¶æ€ â€œsliceâ€ã€‚

æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªåšå®¢åº”ç”¨ä¸­ï¼Œstore çš„é…ç½®å¤§è‡´é•¿è¿™æ ·ï¼š

```typescript
import { configureStore } from '@reduxjs/toolkit'
import usersReducer from '@/store/slices/usersSlice'
import postsReducer from '@/store/slices/postsSlice'
import commentsReducer from '@/store/slices/commentsSlice'

export default configureStore({
  reducer: {
    users: usersReducer,
    posts: postsReducer,
    comments: commentsReducer
  }
})
```

ä¾‹å­ä¸­ï¼Œ`state.users`ï¼Œ`state.posts`ï¼Œå’Œ `state.comments` å‡æ˜¯ Redux state çš„ä¸€ä¸ª ç‹¬ç«‹çš„ â€œsliceâ€ã€‚ç”±äº `usersReducer` è´Ÿè´£æ›´æ–° `state.users` sliceï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸º â€œslice reducerâ€ å‡½æ•°ã€‚

## Thunk Functions

Redux store æœ¬èº«æ— æ³•å¤„ç†å¼‚æ­¥é€»è¾‘ã€‚å®ƒåªä¼šåŒæ­¥åœ° dispatch actionï¼Œå¹¶é€šè¿‡è°ƒç”¨æ ¹ reducer å‡½æ•°æ¥æ›´æ–° stateï¼Œç„¶åé€šçŸ¥è§†å›¾æ›´æ–°ã€‚è€ŒReducer æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œç¦æ­¢ä¸€åˆ‡ **å‰¯ä½œç”¨** æ“ä½œï¼Œä»»ä½•å¼‚æ­¥éƒ½å¿…é¡»åœ¨ store ä¹‹å¤–å‘ç”Ÿã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé€šå¸¸å…·æœ‰å¼‚æ­¥é€»è¾‘ï¼Œæ¯”å¦‚ä» API è¯·æ±‚æ•°æ®ä¹‹ç±»çš„äº‹æƒ…ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦ä¸€ä¸ªåœ°æ–¹ä¸“é—¨å¤„ç†å¼‚æ­¥é€»è¾‘ï¼Œ**ä¸­é—´ä»¶** å°±æ˜¯ç”¨æ¥æ”¾è¿™äº›å‰¯ä½œç”¨é€»è¾‘ä»£ç çš„åœ°æ–¹ã€‚

Reudx å¼‚æ­¥æ“ä½œç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼š`Redux Middlewares` â†’ `redux-chunk` â†’ `Redux Toolkit`

ä¸‹é¢æˆ‘ä»¬å°†é€ä¸€è¯´æ˜å„é˜¶æ®µçš„ç”¨æ³•ã€‚

### Middlewares

ä¸‹é¢æ˜¯å‡ ä¸ªç¤ºä¾‹ï¼Œç”¨æ¥è¯´æ˜ middleware å¦‚ä½•ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™ä¸ Redux store äº¤äº’çš„å¼‚æ­¥é€»è¾‘ã€‚

ä¸€ä¸ªå¥‘æœºæ˜¯ç¼–å†™ middleware æ¥æŸ¥æ‰¾ç‰¹å®šçš„ action typeï¼Œå¹¶åœ¨æ‰§è¡Œè¿™äº› action æ—¶è¿è¡Œå¼‚æ­¥é€»è¾‘ï¼Œä¾‹å¦‚ä»¥ä¸‹ç¤ºä¾‹ï¼š

```typescript
import { client } from '@/api/client'
// â†’ Examples 1
const delayedActionMiddleware = storeAPI => next => action => {
  if (action.type === 'todos/todoAdded') {
    setTimeout(() => {
      // -- å°†è¿™ä¸ª action å»¶è¿Ÿ1ç§’æ‰§è¡Œ
      next(action)
    }, 1000)
    return
  }
  return next(action)
}
// â†’ Exmaples 2
const fetchTodosMiddleware = storeAPI => next => action => {
  if (action.type === 'todos/fetchTodos') {
    // -- å‘é€ API ä»æœåŠ¡å™¨è·å– todos
    client.get('todos').then(todos => {
      // -- ä½¿ç”¨è·å–åˆ°çš„ todos æ•°æ®æ¥ dispatch ä¸€ä¸ª action
      storeAPI.dispatch({ type: 'todos/todosLoaded', payload: todos })
    })
  }
  return next(action)
}
```

è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®æœ‰è‹¥å¹²ä¸ªå¼‚æ­¥å¤„ç†ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç¼–å†™è‹¥å¹²ä¸ªä¸­é—´ï¼Œå¦‚æœæœ‰åŠæ³•å¯ä»¥æå‰ç¼–å†™ ä»»ä½• å¼‚æ­¥é€»è¾‘ï¼Œä¸ä½†ä¸ middleware æœ¬èº«åˆ†å¼€ï¼Œè€Œä¸”ä»ç„¶å¯ä»¥è®¿é—® `dispatch` å’Œ `getState` æ¥å’Œ store è¿›è¡Œäº¤äº’ï¼Œé‚£å°±å¤ªå¥½äº†ã€‚

**å‡è®¾æˆ‘ä»¬å®ç°è¿™æ ·çš„ middlewareï¼Œå®ƒå¯ä»¥ä¼ é€’ å‡½æ•° ç»™ dispatchï¼Œè€Œä¸æ˜¯ action å¯¹è±¡å‘¢ï¼Ÿ**å¯ä»¥è®©è¿™ä¸ª middleware åˆ¤æ–­ action æ˜¯å¦ä¸ºå‡½æ•°ï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œå°±ç«‹å³è°ƒç”¨ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ middleware å®šä¹‰ä¹‹å¤–çš„å…¶ä»–å‡½æ•°ä¸­ç¼–å†™å¼‚æ­¥é€»è¾‘äº†ã€‚

middleware çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```typescript
import { Middleware } from 'redux';
export const asyncMiddleware: Middleware = (storeApi) => (next) => (action) => {
  if (typeof action === 'function') {
    // â†’ å¦‚æœä¼ å…¥çš„actionæ˜¯ä¸€ä¸ªå‡½æ•°
    // â†’ è°ƒç”¨è¯¥å‡½æ•°å¹¶ä¼ å…¥ dispatch å’Œ getState ä½œä¸ºå‚æ•°
    return action(storeApi.dispatch, storeApi.getState);
  } else {
    // â†’ å¦åˆ™ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€š actionï¼Œé‚£å°±ç»§ç»­æ‰§è¡Œ
    return next(action);
  }
};
```
ç„¶åå°±å¯ä»¥åƒè¿™æ ·ä½¿ç”¨è¯¥ middlewareï¼š

```typescript
// ğŸ‘‰ ä»£ç ç‰‡æ®µ1ï¼šæ³¨å†Œä¸­é—´ä»¶
const store = createStore(rootReducer, applyMiddleware(asyncMiddleware) /* æ³¨å†Œä¸­é—´ä»¶*/);

// ğŸ‘‰ ä»£ç ç‰‡æ®µ2ï¼šç¼–å†™ä¸€ä¸ªæ¥æ”¶ dispatch å’Œ getState ä½œä¸ºå‚æ•°çš„å‡½æ•°
const fetchSomeData = (dispatch, getState) => {
  client.get('todos').then(todos => { // â†’ å‘é€ä¸€ä¸ªå¼‚æ­¥ HTTP è¯·æ±‚
    // â†’ ä½¿ç”¨è·å–çš„ todos æ¥ dispatch action
    dispatch({ type: 'todos/todosLoaded', payload: todos })
    // â†’ dispatch åæ£€æŸ¥æ›´æ–°åçš„ store
    const allTodos = getState().todos
    console.log('Number of todos after loading: ', allTodos.length)
  })
}

// ğŸ‘‰ ä»£ç ç‰‡æ®µ3ï¼šå‘ dispatch ä¼ å…¥å‡½æ•°
store.dispatch(fetchSomeData);
```

> **æ³¨æ„ï¼š** **è¿™ä¸ªå¼‚æ­¥å‡½æ•° middleware ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç»™ `dispatch` ä¼ å…¥å‡½æ•° ï¼**åœ¨è¯¥å‡½æ•°ä¸­ï¼Œå¯ä»¥ç¼–å†™ä¸€äº›å¼‚æ­¥é€»è¾‘ï¼ˆæ¯”å¦‚ HTTP è¯·æ±‚ï¼‰ï¼Œç„¶ååœ¨è¯·æ±‚å®Œæˆå dispatch ä¸€ä¸ªæ™®é€šçš„ actionã€‚

### Redux-thunk

ç›®å‰ï¼ŒRedux å·²ç»æœ‰äº†å¼‚æ­¥å‡½æ•° middleware çš„æ­£å¼ç‰ˆæœ¬ï¼Œç§°ä¸º [**Redux â€œThunkâ€ middleware**](https://github.com/reduxjs/redux-thunk)ã€‚thunk middleware å…è®¸æˆ‘ä»¬ç¼–å†™ä»¥ `dispatch` å’Œ `getState` ä½œä¸ºå‚æ•°çš„å‡½æ•°ã€‚thunk å‡½æ•°å¯ä»¥åŒ…å«æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•å¼‚æ­¥é€»è¾‘ï¼Œå¹¶ä¸”è¯¥é€»è¾‘å¯ä»¥æ ¹æ®éœ€è¦ dispatch action ä»¥åŠè¯»å– store stateã€‚

**thunk** æ˜¯ä¸€ç§ç‰¹å®šç±»å‹çš„ Redux å‡½æ•°ï¼Œå¯ä»¥åŒ…å«å¼‚æ­¥é€»è¾‘ã€‚ä¸Šä¸€å°èŠ‚ä¸­çš„ `fetchSomeData` å‡½æ•°å°±æ˜¯ä¸€ä¸ª Thunk.

å®é™…åº”ç”¨ä¸­ï¼Œ Thunk æ˜¯ä½¿ç”¨ä¸¤ä¸ªå‡½æ•°ç¼–å†™çš„ï¼š

- ä¸€ä¸ªå†…éƒ¨ thunk å‡½æ•°ï¼Œå®ƒä»¥ `dispatch` å’Œ `getState` ä½œä¸ºå‚æ•° â†’ *çœŸæ­£çš„Thunkå‡½æ•°*
- å¤–éƒ¨åˆ›å»ºè€…å‡½æ•°ï¼Œå®ƒåˆ›å»ºå¹¶è¿”å› thunk å‡½æ•° â†’ *é€šè¿‡å¤–éƒ¨åˆ›å»ºå‡½æ•°ï¼Œå¯ä»¥å®ç°å‚æ•°çš„ä¼ é€’*

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```typescript
export const incrementAsync = (amount) => async (dispatch, getState) => {
  console.log('Loading...');
  // â†’ æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
  const data = await new Promise((resolve) => {
    setTimeout(() => resolve(amount + 1), 2000);
  });
  // â†’ å½“å¼‚æ­¥ä»£ç æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå¯ä»¥ dispatched actions
  dispatch({ type: 'counter/incrementByAmount', payload: data });
  console.log('completed!');
};
// â†’ æˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨æ™®é€š Redux action creator ä¸€æ ·ä½¿ç”¨å®ƒä»¬
store.dispatch(incrementAsync(10));
```

å½“ä½ éœ€è¦è¯·æ±‚åç«¯æœåŠ¡æ—¶ï¼Œä½ å¯ä»¥å°†è¯¥è°ƒç”¨æ”¾å…¥ thunk ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªå†™å¾—æœ‰ç‚¹é•¿çš„ä¾‹å­ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å®šä¹‰çš„ï¼š

```typescript
// â†’  å¤–éƒ¨çš„ thunk creator å‡½æ•°
function fetchUserById(userId: string) {
  // â†’  å†…éƒ¨çš„ thunk å‡½æ•°
  return async function (dispatch: Dispatch) {
    try {
      // â†’  thunk å†…å‘èµ·å¼‚æ­¥æ•°æ®è¯·æ±‚
      const user = await userAPI.fetchById(userId);
      // â†’  æ•°æ®å“åº”å®Œæˆå dispatch ä¸€ä¸ª action
      dispatch(userLoaded(user));
    } catch (err) {
      // â†’ å¦‚æœè¿‡ç¨‹å‡ºé”™ï¼Œåœ¨è¿™é‡Œå¤„ç†
    }
  };
}
```

**ğŸ‘‰ é…ç½®Store**

Redux thunk middleware åœ¨ NPM ä¸Šä½œä¸ºä¸€ä¸ªåä¸º redux-thunk çš„åŒ…æä¾›ã€‚éœ€è¦å®‰è£…è¯¥è½¯ä»¶åŒ…åæ‰èƒ½åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼š

```shell
$ npm install redux-thunk
```

å®‰è£…åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Redux store ä¸­ä½¿ç”¨è¯¥ middlewareï¼š

```typescript
import { AnyAction, applyMiddleware, createStore } from 'redux';
import { rootReducer } from './reducers';
import thunkMiddleware from 'redux-thunk';
import type { ThunkAction, ThunkMiddleware } from 'redux-thunk';

const store = createStore(
  rootReducer,
  applyMiddleware(thunkMiddleware as ThunkMiddleware) /* æ³¨å†Œä¸­é—´ä»¶*/
);

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
export type AppThunk<ReturnType = void> = ThunkAction<ReturnType, RootState, unknown, AnyAction>;

export default store;
```

## Redux DevToolsï¼ˆå¼€å‘å·¥å…·ï¼‰

Redux DevTools æ˜¯ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œå…è®¸å¼€å‘è€…æŸ¥çœ‹ state å˜åŒ–ã€å›æº¯ action ä»¥åŠè¿›è¡Œæ—¶é—´æ—…è¡Œè°ƒè¯•ï¼ˆTime Travel Debuggingï¼‰ã€‚

å¯ä»¥é€šè¿‡æµè§ˆå™¨æ‰©å±•æˆ–è€… composeWithDevTools è¿›è¡Œé›†æˆï¼š

```js
import { composeWithDevTools } from 'redux-devtools-extension';
const store = createStore(reducer, composeWithDevTools());
```

# React-Reduxï¼ˆäº†è§£ï¼‰

## Use-in-js

![](./IMGs/redux_basics.gif)

æˆ‘ä»¬é¦–å…ˆé€šè¿‡ Counter ç¤ºä¾‹å¸®åŠ©å¤§å®¶äº†è§£ Redux åœ¨ JavaScript ä¸­çš„åº”ç”¨ã€‚

### åˆ›å»ºé¡¹ç›®

```shell
$ mkdir redux-basics && cd redux-basics && touch index.css index.html index.js && code .
```

### ç¼–å†™ä»£ç 

**ğŸ‘‰  ` index.js`**

```javascript
// ğŸ‘‰ Get DOMs
const $ = (sel) => document.querySelector(sel);

// ğŸ‘‰ Actions creators
const increment = () => ({ type: 'counter/increment' });
const decrement = () => ({ type: 'counter/decrement' });
const incrementByAmount = (amount) => ({
  type: 'counter/incrementByAmount',
  payload: amount,
});
const toggleStatus = () => ({ type: 'status/toggleStatus' });

// ğŸ‘‰ Reduers
const counterReducer = (state = { count: 6 }, action) => {
  switch (action.type) {
    case 'counter/increment':
      return { ...state, count: state.count + 1 };
    case 'counter/decrement':
      return { ...state, count: state.count - 1 };
    case 'counter/incrementByAmount':
      return { ...state, count: state.count + action.payload };
    default:
      return state;
  }
};
const statusReducer = (state = { loading: false }, action) => {
  switch (action.type) {
    case 'status/toggleStatus':
      return { ...state, loading: !state.loading };
    default:
      return state;
  }
};

// ğŸ‘‰ Middlewares - ä¸­é—´ä»¶
// -- è§¦å‘æµç¨‹ï¼šdispatch â†’ ä¸­é—´ä»¶ â†’ reducers
// -- ä¸­é—´ä»¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨Reduxä¸­è¿›è¡Œå‰¯ä½œç”¨æ“ä½œ
// -- é€šå¸¸ä½ ä¸å¿…å•ç‹¬ä¸ºæŸä¸€ä¸ªåŠŸèƒ½æ„å»ºä¸­é—´ä»¶ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„å¼‚æ­¥ä¸­é—´ä»¶æ¥å¤„ç†é¡¹ç›®ä¸­çš„å¼‚æ­¥æ“ä½œ
// -- ä½¿ç”¨æ—¶ä½ éœ€è¦å…ˆç”³è¯·ä¸­é—´ä»¶å¢å¼ºå™¨ï¼Œç„¶ååœ¨åˆ›å»ºstoreçš„æ—¶å€™ä¼ å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
// -- 1. const middlewareEnhancer = Redux.applyMiddleware(xxxMiddleware)
// -- 2. const store = Redux.createStore(reducer, middlewareEnhancer)
const asyncFunctionMiddleware = (storeApi) => (next) => (action) => {
  if (typeof action === 'function') {
    // â†’ å¦‚æœä¼ å…¥çš„actionæ˜¯ä¸€ä¸ªå‡½æ•°
    // â†’ è°ƒç”¨è¯¥å‡½æ•°å¹¶ä¼ å…¥ dispatch å’Œ getState ä½œä¸ºå‚æ•°
    return action(storeApi.dispatch, storeApi.getState);
  } else {
    // â†’ å¦åˆ™ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€š actionï¼Œé‚£å°±ç»§ç»­æ‰§è¡Œ
    return next(action);
  }
};

// ğŸ‘‰ Create store
// â†’ æ³¨å†Œä¸­é—´ä»¶
const middlewareEnhancer = Redux.applyMiddleware(asyncFunctionMiddleware);
// â†’ åˆå¹¶reducers
const reducer = Redux.combineReducers({
  counter: counterReducer,
  status: statusReducer,
});
const store = Redux.createStore(reducer, middlewareEnhancer);

// ğŸ‘‰ Selectors
const useSelector = (fn) => {
  return fn(store.getState());
};

//  ğŸ‘‰ CHUNKs - å¼‚æ­¥å‡½æ•°
const incrementAsync = (amount) => async (dispatch, getState) => {
  const isLoading = getState().status.loading;
  if (isLoading) {
    return console.log('å½“å‰æ­£åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œè¯·ç¨åå†è¯•...');
  }
  dispatch(toggleStatus());
  await new Promise((resolve) => {
    console.log('Loading...');
    setTimeout(() => {
      resolve();
    }, 1000);
  });
  dispatch(toggleStatus());
  dispatch(incrementByAmount(amount));
  console.log('Completed!');
};

// ğŸ‘‰ Render functions
const render = () => {
  const count = useSelector((state) => state.counter.count);
  $('#value').textContent = count;
};
// â†’ è®¢é˜…Storeæ›´æ–°
store.subscribe(render);

// ğŸ‘‰ Events - Dispatchs
$('#increment').onclick = () => store.dispatch(increment());
$('#decrement').onclick = () => store.dispatch(decrement());
$('#addAmount').onclick = () => {
  const value = $('#textbox').value;
  store.dispatch(incrementByAmount(Number(value) || 0));
};
$('#asyncButton').onclick = () => {
  const value = $('#textbox').value;
  store.dispatch(incrementAsync(Number(value) || 0));
};

// ğŸ‘‰ Enter Actions...
$('#textbox').value = 2;
render();
```

**ğŸ‘‰  ` index.html`**

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./index.css" />
    <title>Redux basic example</title>
    <script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
  </head>
  <body>
    <div class="app">
      <div class="row">
        <button class="button" id="increment">+</button>
        <span class="value" id="value">0</span>
        <button class="button" id="decrement">-</button>
      </div>
      <div class="row">
        <input class="textbox" id="textbox" />
        <button class="button" id="addAmount">Add Amount</button>
        <button class="button asyncButton" id="asyncButton">Add Async</button>
      </div>
    </div>
    <script src="./index.js"></script>
  </body>
</html>
```

**ğŸ‘‰  ` index.css`**

```css
.app { height: 100vh; padding-top: 100px; }

.row { display: flex; align-items: center; justify-content: center; margin-bottom: 16px; }
.button {
  font-size: 32px;
  padding: 4px 12px;
  border: 2px solid transparent;
  color: rgb(112, 76, 182);
  cursor: pointer;
  background-color: rgba(112, 76, 182, 0.1);
  border-radius: 10px;
  transition: all 0.15s;
}

.button:hover,
.button:focus  { border: 2px solid rgba(112, 76, 182, 0.4); }
.button:active { background-color: rgba(112, 76, 182, 0.2); }

.value { font-size: 78px; padding: 0 16px; font-family: 'Courier New', Courier, monospace; }

.textbox {
  font-size: 32px;
  padding: 4px;
  width: 64px;
  text-align: center;
  margin-right: 8px;
  border-radius: 10px;
}

.asyncButton { position: relative; margin-left: 8px; overflow: hidden; }
.asyncButton:after {
  content: '';
  display: block;
  width: 100%;
  height: 100%;
  background-color: rgba(112, 76, 182, 0.15);
  position: absolute;
  left: 0;
  top: 0;
  opacity: 0;
  transition: width 1s linear, opacity 0.5s ease 1s;
}
.asyncButton:active:after { width: 0%; opacity: 1; transition: 0s; }
```

## Use-in-React-Class

### å‰ç½®çŸ¥è¯†

åœ¨ React ä¸­ä½¿ç”¨ Reduxï¼Œä¸»è¦åŸºäº `react-redux` åº“å®ç°ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å…³äº React-Class-Component ç›¸å…³çš„çŸ¥è¯†ã€‚

> *æç¤ºï¼šç°å¦‚ä»Šï¼ŒHooks ç››è¡Œï¼ŒåŸºæœ¬ä¸Šæˆ‘ç°åœ¨å¼€å‘çš„é¡¹ç›®éƒ½æ˜¯åŸºäº React-Hooks + TypeScript å®ç°çš„ï¼Œä½†ä½ ä»ç„¶æœ‰å¿…è¦å»äº†è§£Classä¸­çš„ä½¿ç”¨ï¼Œä¸è¯´åˆ«çš„ï¼Œè‡³å°‘é¢è¯•çš„æ—¶å€™é¢è¯•å®˜å¯èƒ½ä¼šé—®ä½ ã€‚*

#### å®¹å™¨ç»„ä»¶ & å±•ç¤ºç»„ä»¶

React-Redux å°†æ‰€æœ‰ç»„ä»¶åˆ†æˆä¸¤å¤§ç±»ï¼šå®¹å™¨ç»„ä»¶ / å±•ç¤ºç»„ä»¶ã€‚

**ğŸ‘‰ å±•ç¤ºç»„ä»¶**

å±•ç¤ºç»„ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾ï¼š

1. åªè´Ÿè´£ UI çš„å‘ˆç°ï¼Œä¸å¸¦æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼ˆå³å‰¯ä½œç”¨æ“ä½œï¼‰

2. æ²¡æœ‰çŠ¶æ€ï¼ˆNo Stateï¼‰

3. æ‰€æœ‰æ•°æ®éƒ½ç”± Props æä¾›

4. ä¸ä½¿ç”¨ä»»ä½• Redux çš„ APIs

ä¸‹é¢æ˜¯ä¸€ä¸ªå±•ç¤ºç»„ä»¶çš„ç¤ºä¾‹ï¼š

```react
const Button = props => (
  <button type="button">{props.text}</button>
)
```

> æç¤ºï¼šå› ä¸ºä¸å«æœ‰çŠ¶æ€ï¼Œå±•ç¤ºç»„ä»¶åˆç§°ä¸º"çº¯ç»„ä»¶"ï¼Œå³å®ƒè·Ÿçº¯å‡½æ•°ä¸€æ ·ï¼Œçº¯ç²¹ç”±å‚æ•°å†³å®šå®ƒçš„å€¼ã€‚

**ğŸ‘‰ å®¹å™¨ç»„ä»¶**

å®¹å™¨ç»„ä»¶çš„ç‰¹å¾æ°æ°ç›¸åã€‚

1. è´Ÿè´£ç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œä¸è´Ÿè´£ UI çš„å‘ˆç°

2. å¸¦æœ‰å†…éƒ¨çŠ¶æ€

3. ä½¿ç”¨ Redux  çš„ APIs

> **ç»“è®ºï¼šå±•ç¤ºç»„ä»¶è´Ÿè´£ UI çš„å‘ˆç°ï¼Œå®¹å™¨ç»„ä»¶è´Ÿè´£ç®¡ç†æ•°æ®å’Œé€»è¾‘ã€‚**

React-Redux è§„å®šï¼Œæ‰€æœ‰çš„å±•ç¤ºç»„ä»¶éƒ½ç”±ç”¨æˆ·æä¾›ï¼Œå®¹å™¨ç»„ä»¶åˆ™æ˜¯ç”± React-Redux è‡ªåŠ¨ç”Ÿæˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·è´Ÿè´£è§†è§‰å±‚ï¼ŒçŠ¶æ€ç®¡ç†åˆ™æ˜¯å…¨éƒ¨äº¤ç»™å®ƒã€‚

| #                  | å±•ç¤ºç»„ä»¶                   | å®¹å™¨ç»„ä»¶                           |
| ------------------ | -------------------------- | ---------------------------------- |
| **ä½œç”¨**           | æè¿°å¦‚ä½•å±•ç°ï¼ˆéª¨æ¶ã€æ ·å¼ï¼‰ | æè¿°å¦‚ä½•è¿è¡Œï¼ˆæ•°æ®è·å–ã€çŠ¶æ€æ›´æ–°ï¼‰ |
| **ç›´æ¥ä½¿ç”¨ Redux** | å¦                         | æ˜¯                                 |
| **æ•°æ®æ¥æº**       | props                      | ç›‘å¬ Redux-state                   |
| **æ•°æ®ä¿®æ”¹**       | ä» props è°ƒç”¨å›è°ƒå‡½æ•°      | å‘ Redux æ´¾å‘ actions              |
| **è°ƒç”¨æ–¹å¼**       | æ‰‹åŠ¨                       | é€šå¸¸ç”± React-Redux ç”Ÿæˆ            |

#### connect()

React-Redux å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶HOCï¼Œæä¾› connect æ–¹æ³•ï¼Œç”¨äºç”Ÿæˆå®¹å™¨ç»„ä»¶ã€‚

ä½¿ç”¨äº† connectï¼Œå°±ç›¸å½“äº store.subscribeï¼Œ å³ç»„ä»¶è®¢é˜…äº† store ä¸­çš„æ•°æ®ã€‚

```js
import { connect } from 'react-redux'
const ContainerCounter = connect()(Counter);
```

ä¸Šé¢ä»£ç ä¸­ï¼ŒCounter æ˜¯å±•ç¤ºç»„ä»¶ï¼ŒContainerCounter å°±æ˜¯ç”± React-Redux é€šè¿‡ connect æ–¹æ³•è‡ªåŠ¨ç”Ÿæˆçš„å®¹å™¨ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæ²¡æœ‰å®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œä¸Šé¢è¿™ä¸ªå®¹å™¨ç»„ä»¶æ¯«æ— æ„ä¹‰ï¼Œåªæ˜¯ UI ç»„ä»¶çš„ä¸€ä¸ªå•çº¯çš„åŒ…è£…å±‚ã€‚ä¸ºäº†å®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ç»™å‡ºä¸‹é¢ä¸¤æ–¹é¢çš„ä¿¡æ¯ã€‚

1ï¼‰è¾“å…¥é€»è¾‘ï¼šå¤–éƒ¨çš„æ•°æ®ï¼ˆå³ State å¯¹è±¡ï¼‰å¦‚ä½•è½¬æ¢ä¸ºå±•ç¤ºç»„ä»¶çš„å‚æ•°

2ï¼‰è¾“å‡ºé€»è¾‘ï¼šç”¨æˆ·å‘å‡ºçš„åŠ¨ä½œå¦‚ä½•å˜ä¸º Action å¯¹è±¡ï¼Œä»å±•ç¤ºç»„ä»¶ä¼ å‡ºå»ã€‚

å› æ­¤ï¼Œ`connect` æ–¹æ³•çš„å®Œæ•´ API å¦‚ä¸‹ã€‚

```js
import { connect } from 'react-redux'

const ContainerCounter = connect(
  mapStateToProps,
  mapDispatchToProps
)(Counter)
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`connect` æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š`mapStateToProps` å’Œ `mapDispatchToProps`ã€‚å®ƒä»¬å®šä¹‰äº† å±•ç¤º ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘ã€‚å‰è€…è´Ÿè´£è¾“å…¥é€»è¾‘ï¼Œå³å°†`state`æ˜ å°„åˆ° å±•ç¤º ç»„ä»¶çš„å‚æ•°ï¼ˆ`props`ï¼‰ï¼Œåè€…è´Ÿè´£è¾“å‡ºé€»è¾‘ï¼Œå³å°†ç”¨æˆ·å¯¹ å±•ç¤º ç»„ä»¶çš„æ“ä½œæ˜ å°„æˆ Actionã€‚

#### mapStateToProps()

è¯¥å‡½æ•°å¤„ç†æ•°æ®çš„æµå…¥ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œ ä½¿ç”¨ connect å‡½æ•°ï¼Œä¼ å…¥ mapStateToPropsï¼Œå®Œæˆ store æ•°æ®ä¸ç»„ä»¶çš„ props ç»‘å®šã€‚

```js
const mapStateToProps = (state: RootState) => ({
    count: state.counter.count
});
```

åœ¨å±•ç¤ºç»„ä»¶ä¸­å¯é€šè¿‡ `this.props.count` è®¿é—®ã€‚

#### mapDispatchToProps()

è¯¥å‡½æ•°å¤„ç†æ•°æ®çš„æµå‡ºï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µéƒ½æ˜¯ä¸€ä¸ª dispatch å¤„ç†å‡½æ•°ï¼Œä½¿ç”¨ connect å‡½æ•°ï¼Œä¼ å…¥ mapDispatchToPropsï¼Œå®Œæˆ dispatch ä¸ç»„ä»¶çš„ props ç»‘å®šã€‚

```js
const mapDispatchToProps = (dispatch: AppDispatch) => ({
  increment: () => dispatch(increment()),
  decrement: () => dispatch(decrement()),
});
```

åœ¨å±•ç¤ºç»„ä»¶ä¸­å¯é€šè¿‡ `this.props.increment()` è®¿é—®ï¼Œå…¶å†…éƒ¨é€»è¾‘æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ dispatch ä¸€ä¸ª actionã€‚

#### Provider

React-Redux åˆ©ç”¨ä¸Šä¸‹æ–‡ Contextï¼Œæä¾›çš„æ•°æ®ç»„ä»¶ Providerï¼Œä½¿ç”¨Providerï¼ŒåŠ è½½æ•°æ®ä»“åº“ store å³å¯åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ storeã€‚

```react
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

// â†’ React-Redux åˆ©ç”¨ä¸Šä¸‹æ–‡ Contextï¼Œæä¾›çš„æ•°æ®ç»„ä»¶ Provider
import { Provider } from 'react-redux';
import store from './stores';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    {/* ä½¿ç”¨Providerï¼ŒåŠ è½½æ•°æ®ä»“åº“ store å³å¯åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ store */}
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

> **Tipsï¼š**\<Provider> çš„å®ç°åŸç†æ˜¯åŸºäº **React-Context** å®ç°çš„ã€‚

`React-Redux` è‡ªåŠ¨ç”Ÿæˆçš„å®¹å™¨ç»„ä»¶çš„ä»£ç ï¼Œå°±ç±»ä¼¼ä¸Šé¢è¿™æ ·ï¼Œä»è€Œæ‹¿åˆ°`store`ã€‚

### ä»£ç ç¤ºä¾‹

éœ€æ±‚æè¿°ï¼šè¿™é‡Œæˆ‘ä»¬å°† **Use-in-js** é‡Œé¢çš„ä»£ç é€šè¿‡ React-Class å®ç°ä¸€éã€‚

#### 1. åˆ›å»ºProject

```shell
$ npm create vite@latest use-in-react-class  -- --template react-ts
$ cd use-in-react-class && npm install react-redux redux && code .
```

ç›®å½•ç»“æ„ï¼š

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components â†’ è§†å›¾ç»„ä»¶
	      â”œâ”€â”€ Counter.css
	  	  â””â”€â”€	Counter.tsx
	  â”œâ”€â”€	/stores  
	  		â”œâ”€â”€ /middlewares â†’ ä¸­é—´ä»¶
    				â””â”€â”€ index.ts
    		â”œâ”€â”€ /reducers
    				â”œâ”€â”€ counterReducer.ts
    				â”œâ”€â”€ index.ts â†’ åˆå¹¶Reducers
    				â””â”€â”€ statusReducer.ts
	  	  â””â”€â”€	index.ts â†’ åˆ›å»ºStoreå®ä¾‹
	  â”œâ”€â”€	App.tsx
	  â”œâ”€â”€	main.tsx â†’ å¼•å…¥Storeå®ä¾‹
â”œâ”€â”€ ....
```

#### 2. åˆ›å»ºMiddlewares

**`/stores/middlewares/index.ts`**

```typescript
import { Middleware } from 'redux';
export const asyncMiddleware: Middleware = (storeApi) => (next) => (action) => {
  if (typeof action === 'function') {
    // â†’ å¦‚æœä¼ å…¥çš„actionæ˜¯ä¸€ä¸ªå‡½æ•°
    // â†’ è°ƒç”¨è¯¥å‡½æ•°å¹¶ä¼ å…¥ dispatch å’Œ getState ä½œä¸ºå‚æ•°
    return action(storeApi.dispatch, storeApi.getState);
  } else {
    // â†’ å¦åˆ™ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€š actionï¼Œé‚£å°±ç»§ç»­æ‰§è¡Œ
    return next(action);
  }
};
```

#### 3. åˆ›å»ºReducers

**`counterReducer`**

```typescript
import { ActionCreator } from 'redux';
import { AppDispatch, RootState } from '..';
import { statusToggle } from './statusReducer';

// -- Define Actions
// ğŸ‘‰ ç”¨å¸¸é‡å®šä¹‰Action.typeï¼Œå‡å°‘ä»£ç æ•²é”™
const COUNTER_INCREMENT = 'counter/increment';
const COUNTER_DECREMENT = 'counter/decrement';
const COUNTER_INCREMENT_BY_AMOUNT = 'counter/incrementByAmount';

// ğŸ‘‰ Action ç±»å‹å£°æ˜
type CounterIncrementAction = { type: typeof COUNTER_INCREMENT };
type CounterDecrementAction = { type: typeof COUNTER_DECREMENT };
type CounterIncrementByAmountAction = { type: typeof COUNTER_INCREMENT_BY_AMOUNT; payload: number };
type CounterAction = CounterIncrementAction | CounterDecrementAction | CounterIncrementByAmountAction;

// ğŸ‘‰ å·¥å‚æ¨¡å¼ â†’ åˆ›å»º Action
export const increment: ActionCreator<CounterIncrementAction> = () => ({
  type: COUNTER_INCREMENT,
});
export const decrement: ActionCreator<CounterDecrementAction> = () => ({
  type: COUNTER_DECREMENT,
});
export const incrementByAmount: ActionCreator<CounterIncrementByAmountAction> = (amount: number) => ({
  type: COUNTER_INCREMENT_BY_AMOUNT,
  payload: amount,
});

// ğŸ‘‰ initialState
interface CounterState {
  count: number;
}
const initialState: CounterState = { count: 0 };

// ğŸ‘‰ Define Reducer
const counterReducer = (
  state = initialState,
  action: CounterAction
): CounterState => {
  switch (action.type) {
    case COUNTER_INCREMENT:
      return { ...state, count: state.count + 1 };
    case COUNTER_DECREMENT:
      return { ...state, count: state.count - 1 };
    case COUNTER_INCREMENT_BY_AMOUNT:
      return { ...state, count: state.count + action.payload };
    default:
      return state;
  }
};

// ğŸ‘‰ CHUNKs - å¼‚æ­¥å‡½æ•°
export const incrementAsync = (amount: number) => {
  return async (dispatch: AppDispatch, getState: () => RootState) => {
    const isLoading = getState().status.loading;
    if (isLoading) {
      console.log('å½“å‰æ­£åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œè¯·ç¨åå†è¯•...');
      return;
    }
    dispatch(statusToggle());
    await new Promise((resolve) => {
      console.log('Loading...');
      setTimeout(() => {
        resolve(null);
      }, 1000);
    });
    dispatch(statusToggle());
    dispatch(incrementByAmount(amount));
    console.log('Completed!');
  };
};

export default counterReducer;
```

**`statusReducer.ts`**

```typescript
import { ActionCreator } from 'redux';

// -- Define Actions
// 1. ç”¨å¸¸é‡å®šä¹‰Action.typeï¼Œå‡å°‘ä»£ç æ•²é”™
const STATUS_TOGGLE = 'status/toggle';

// 2. Action ç±»å‹å£°æ˜
type StatusAction = { type: typeof STATUS_TOGGLE };

// 3. å·¥å‚æ¨¡å¼ â†’ åˆ›å»º Action
export const statusToggle: ActionCreator<StatusAction> = () => ({
  type: STATUS_TOGGLE,
});

// -- initialState
interface StatusState {
  loading: boolean;
}
const initialState: StatusState = {
  loading: false,
};

// -- Define Reducer
const statusReducer = (
  state = initialState,
  action: StatusAction
): StatusState => {
  switch (action.type) {
    case STATUS_TOGGLE:
      return { ...state, loading: !state.loading };
    default:
      return state;
  }
};

export default statusReducer;
```

**ğŸ‘‰  åˆå¹¶Reducers**

**`/reducers/index.ts`**

```typescript
import { combineReducers } from 'redux';

import counterReducer from './counterReducer';
import statusReducer from './statusReducer';

export const rootReducer = combineReducers({
  counter: counterReducer,
  status: statusReducer,
});
```

#### 4. åˆ›å»ºStore

**`/store/index.ts`**

```typescript
import { applyMiddleware, createStore } from 'redux';
import { asyncMiddleware } from './middlewares';
import { rootReducer } from './reducers';

const store = createStore(rootReducer, applyMiddleware(asyncMiddleware));

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;

export default store;
```

#### 5. åˆ›å»ºCounter-Comps

**`/components/Counter.tsx`**

```tsx
import React, { ChangeEvent, Dispatch } from 'react';
import { connect } from 'react-redux';
import { RootState } from '../stores';
import {
  decrement,
  increment,
  incrementAsync,
  incrementByAmount,
} from '../stores/reducers/counterReducer';
import './Counter.css';

// â†’ å¤„ç†æ•°æ®çš„æµå…¥ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡
// â†’ ä½¿ç”¨ connect å‡½æ•°ï¼Œä¼ å…¥ mapStateToPropsï¼Œå®Œæˆstoreæ•°æ®ä¸ç»„ä»¶çš„propsç»‘å®š
const mapStateToProps = (state: RootState) => ({
  count: state.counter.count,
  loading: state.status.loading,
});

// â†’ å¤„ç†æ•°æ®çš„æµå‡ºï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µéƒ½æ˜¯ä¸€ä¸ªdispatchå¤„ç†å‡½æ•°
// â†’ ä½¿ç”¨ connect å‡½æ•°ï¼Œä¼ å…¥ mapDispatchToPropsï¼Œå®Œæˆdispatchä¸ç»„ä»¶çš„propsç»‘å®š
const mapDispatchToProps = (dispatch: Dispatch<any>) => ({
  increment: () => dispatch(increment()),
  decrement: () => dispatch(decrement()),
  incrementByAmount: (amount: number) => dispatch(incrementByAmount(amount)),
  incrementAsync: (amount: number) => dispatch(incrementAsync(amount)),
});

// -- ç±»å‹å£°æ˜
type IProps = ReturnType<typeof mapStateToProps> & ReturnType<typeof mapDispatchToProps>;
type IState = { incrementAmount: string };
class Counter extends React.Component<IProps, IState> {
  // -- constructor
  constructor(props: IProps) {
    super(props);
    this.state = {
      incrementAmount: '5',
    };
  }
  // -- methods
  getAmount = () => Number(this.state.incrementAmount) || 0;
  // -- events
  onIncrement = () => this.props.increment();
  onDecrement = () => this.props.decrement();
  onAddAmount = () => this.props.incrementByAmount(this.getAmount());
  onAddAsync = () => this.props.incrementAsync(this.getAmount());
  onInputChange = ($event: ChangeEvent<HTMLInputElement>) =>
    this.setState({
      incrementAmount: $event.target.value,
    });
  // -- renders
  render(): React.ReactNode {
    return (
      <div className='counter'>
        <div className='row'>
          <button className='button' onClick={this.onIncrement}>+</button>
          <span className='value'>{this.props.count}</span>
          <button className='button' onClick={this.onDecrement}>-</button>
        </div>
        <div className='row'>
          <input
            className='textbox'
            value={this.state.incrementAmount}
            onChange={this.onInputChange}
          />
          <button className='button' onClick={this.onAddAmount}>Add Amount</button>
          <button className='button asyncButton' onClick={this.onAddAsync}>Add Async</button>
        </div>
      </div>
    );
  }
}

// â†’ ç”Ÿæˆå®¹å™¨ç»„ä»¶
export default connect(mapStateToProps, mapDispatchToProps)(Counter);
```

> **TIPsï¼š**Counter æ ·å¼ç›´æ¥å¤åˆ¶ **Use-in-js** é‡Œçš„CSSæ ·å¼å³å¯ã€‚

**`App.tsx`**

```tsx
import React from 'react';
import Counter from './components/Counter';

class App extends React.Component {
  render(): React.ReactNode {
    return (
      <div className='app'>
        <Counter />
      </div>
    );
  }
}

export default App;
```

#### 6. æ³¨å…¥Store

**`main.tsx`**

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

// â†’ React-Redux åˆ©ç”¨ä¸Šä¸‹æ–‡ Contextï¼Œæä¾›çš„æ•°æ®ç»„ä»¶ Provider
import { Provider } from 'react-redux';
import store from './stores';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    {/* ä½¿ç”¨Providerï¼ŒåŠ è½½æ•°æ®ä»“åº“ store å³å¯åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ store */}
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

## Use-in-React-Hooks

éœ€æ±‚æè¿°ï¼šè¿™é‡Œæˆ‘ä»¬å°† **Use-in-React-Class** é‡Œé¢çš„ä»£ç é€šè¿‡ React-Hooks å®ç°ä¸€éï¼Œæœ¬ç¤ºä¾‹å¤§éƒ¨åˆ†ä»£ç å¯ä»¥å’Œä¸Šä¸€å°èŠ‚çš„ä»£ç å¤ç”¨ã€‚

Hooksä¸­ï¼ŒReact-Redux æä¾›äº† **`useSelector`** & **`useDispatch`** é’©å­å‡½æ•°è®©åæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿çµæ´»çš„å»è·å–Stateä»¥åŠDispatch.

### 1. åˆ›å»ºProject

```shell
$ npm create vite@latest use-in-react-hooks  -- --template react-ts
$ cd use-in-react-hooks && npm install react-redux redux && code .
```

ç›®å½•ç»“æ„ï¼š

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components â†’ è§†å›¾ç»„ä»¶
	      â”œâ”€â”€ Counter.css
	  	  â””â”€â”€	Counter.tsx
	  â”œâ”€â”€	/stores 
    		â”œâ”€â”€ /reducers
    				â”œâ”€â”€ counterReducer.ts
    				â”œâ”€â”€ index.ts â†’ åˆå¹¶Reducers
    				â””â”€â”€ statusReducer.ts
        â”œâ”€â”€ hooks.ts â†’ useSelector & useDispatch
	  	  â””â”€â”€	index.ts â†’ åˆ›å»ºStoreå®ä¾‹
	  â”œâ”€â”€	App.tsx
	  â”œâ”€â”€	main.tsx â†’ å¼•å…¥Storeå®ä¾‹
â”œâ”€â”€ ....
```

> **æç¤ºï¼š**
>
> - åˆ é™¤äº† middlewares ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ [redux-thunk >>](https://www.npmjs.com/package/redux-thunk) æ¥å¤„ç†ä¸­é—´ä»¶ã€‚
> - æ–°å¢ hooks æ–‡ä»¶ï¼Œå°è£… useSelector & useDispatch æ¥è¯»å–å’Œæ›´æ–°Storeã€‚

### 2. åˆ›å»ºHooks

**`stores/hooks.ts`**

```typescript
import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';
import type { AppDispatch, RootState } from '.';

// ğŸ‘‰ æ¨èåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å•çº¯çš„ä½¿ç”¨ useDispatch & useSelector
export const useAppDispatch = () => useDispatch<AppDispatch>();
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;
```

### 3. åˆ›å»ºReducers

**æç¤ºï¼š** Reducer ç›¸å…³ä»£ç å’Œç¤ºä¾‹ **Use-in-React-Class** ä¸€è‡´ï¼Œä½ å¯ä»¥å‚ç…§ç¤ºä¾‹ç›®å½•å°†å…¶ç›´æ¥å¤åˆ¶/ç²˜è´´è¿‡æ¥ä½¿ç”¨ï¼Œè¿™é‡Œåªåˆ—å‡ºä¿®æ”¹/æ–°å¢éƒ¨åˆ†ä»£ç ã€‚

```typescript
// ....
import { AppThunk } from '..';
export const incrementAsync = (amount: number): AppThunk /** æŒ‡å®šè¿”å›ç±»å‹ */ => {
  return async (dispatch, getState) => {
    const isLoading = getState().status.loading;
    if (isLoading) {
      console.log('å½“å‰æ­£åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œè¯·ç¨åå†è¯•...');
      return;
    }
    dispatch(statusToggle());
    await new Promise((resolve) => {
      console.log('Loading...');
      setTimeout(() => {
        resolve(null);
      }, 1000);
    });
    dispatch(statusToggle());
    dispatch(incrementByAmount(amount));
    console.log('Completed!');
  };
};
// ....
```

### 4. åˆ›å»ºStore

> **æç¤ºï¼š** Store ç›¸å…³ä»£ç å’Œç¤ºä¾‹ **Use-in-React-Class** ä¸€è‡´ï¼Œä½ å¯ä»¥å‚ç…§ç¤ºä¾‹ç›®å½•å°†å…¶ç›´æ¥å¤åˆ¶/ç²˜è´´è¿‡æ¥ä½¿ç”¨ï¼Œè¿™é‡Œåªåˆ—å‡ºä¿®æ”¹/æ–°å¢éƒ¨åˆ†ä»£ç ã€‚

**`/store/index.ts`**

```typescript
import { AnyAction, applyMiddleware, createStore } from 'redux';
import { rootReducer } from './reducers';
import thunkMiddleware from 'redux-thunk';
import type { ThunkAction, ThunkMiddleware } from 'redux-thunk';

const store = createStore(
  rootReducer,
  applyMiddleware(thunkMiddleware as ThunkMiddleware) /* æ³¨å†Œä¸­é—´ä»¶*/
);

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
export type AppThunk<ReturnType = void> = ThunkAction<ReturnType, RootState, unknown, AnyAction>;

export default store;
```

### 5. åˆ›å»ºCounter-Comps

> **æç¤ºï¼š** Counter æ ·å¼ä»£ç å’Œç¤ºä¾‹ **Use-in-React-Class** ä¸€è‡´ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶/ç²˜è´´è¿‡æ¥ä½¿ç”¨ï¼Œè¿™é‡Œåªåˆ—å‡º **`Counter.tsx`** æ–‡ä»¶ä»£ç .

**`/components/Counter.tsx`**

```tsx
import React, { ChangeEvent, memo, useState } from 'react';
import { useAppDispatch, useAppSelector } from '../stores/hooks';
import { decrement, increment, incrementAsync, incrementByAmount } from '../stores/reducers/counterReducer';
import './Counter.css';

const Counter: React.FC = () => {
  // -- state
  const [incrementAmount, setIncrementAmount] = useState('5');
  // -- stores
  const count = useAppSelector((state) => state.counter.count);
  // -- dispatch
  const dispatch = useAppDispatch();
  // -- methods
  const getNumAmount = () => Number(incrementAmount) || 0;
  // -- events
  const onIncrement = () => dispatch(increment());
  const onDecrement = () => dispatch(decrement());
  const onAddAmount = () => dispatch(incrementByAmount(getNumAmount()));
  const onAddAsync = () => dispatch(incrementAsync(getNumAmount()));
  const onInputChange = ($event: ChangeEvent<HTMLInputElement>) => { setIncrementAmount($event.target.value) };
  // -- renders
  return (
    <div className='counter'>
      <div className='row'>
        <button className='button' onClick={onIncrement}>+</button>
        <span className='value'>{count}</span>
        <button className='button' onClick={onDecrement}>-</button>
      </div>
      <div className='row'>
        <input className='textbox' value={incrementAmount} onChange={onInputChange}/>
        <button className='button' onClick={onAddAmount}>Add Amount</button>
        <button className='button asyncButton' onClick={onAddAsync}>Add Async</button>
      </div>
    </div>
  );
};

export default memo(Counter);
```

**`App.tsx`**

```tsx
import React from 'react';
import Counter from './components/Counter';

const App: React.FC = () => (
  <div className='app'>
    <Counter />
  </div>
);

export default App;

```

### 6. æ³¨å…¥Store

> **æç¤ºï¼š** æ³¨å…¥Storeä»£ç å’Œç¤ºä¾‹ **Use-in-React-Class** ä¸€è‡´ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶/ç²˜è´´è¿‡æ¥ä½¿ç”¨.

# Redux-Toolkitï¼ˆæ¨èï¼‰

**ğŸ‘‰  [Redux-Toolkit >>](https://cn.redux-toolkit.js.org/)**

ç°åœ¨ï¼Œè¿æ¥å®¡åˆ¤å§ï¼ï¼ï¼

åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚ä½ æ‰€è§ï¼ŒRedux æ¶‰åŠç¼–å†™ä¸€äº›å†—é•¿çš„ä»£ç ï¼Œä¾‹å¦‚ä¸å¯å˜æ›´æ–°ã€action types å’Œ action creatorsï¼Œä»¥åŠå½’ä¸€åŒ– stateã€‚è™½ç„¶è¿™äº›æ¨¡å¼æœ‰å……åˆ†çš„å­˜åœ¨ç†ç”±ï¼Œä½†æ˜¯â€œæ‰‹åŠ¨â€ç¼–å†™è¿™äº›ä»£ç å¯èƒ½æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚å¾ˆå¤šæ—¶å€™ç”¨æˆ·ä¸ç¡®å®šç¼–å†™ Redux é€»è¾‘çš„â€œæ­£ç¡®æ–¹æ³•â€æ˜¯ä»€ä¹ˆã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Redux å›¢é˜Ÿåˆ›å»ºäº† Redux Toolkitã€‚

Redux Toolkit åŒ…å«äº†å¯¹äºæ„å»º Redux åº”ç”¨ç¨‹åºè‡³å…³é‡è¦çš„åŒ…å’Œå‡½æ•°ï¼Œç®€åŒ–äº†å¤§å¤šæ•° Redux ä»»åŠ¡ï¼Œé¿å…äº†å¸¸è§é”™è¯¯ï¼Œä½¿å¾—ç¼–å†™ Redux åº”ç”¨ç¨‹åºæ›´å®¹æ˜“äº†ã€‚å› æ­¤ï¼Œ**Redux Toolkit æ˜¯ç¼–å†™ Redux åº”ç”¨ç¨‹åºé€»è¾‘çš„æ ‡å‡†æ–¹å¼**ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œ**ä½ åº”è¯¥ä½¿ç”¨ Redux Toolkit æ¥ç¼–å†™ Redux é€»è¾‘ã€‚**

å½“ä½ ä½¿ç”¨ Redux Toolkit æ—¶ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ä»‹ç»çš„æ‰€æœ‰æ¦‚å¿µï¼ˆactionsã€reducersã€store setupã€action creatorsã€thunk ç­‰ï¼‰ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯ **Redux Toolkit æä¾›äº†æ›´ç®€å•çš„æ–¹æ³•æ¥ç¼–å†™ä»£ç **ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ Redux-Toolkit å°†ä¹‹å‰çš„ Counter æ¡ˆä¾‹å†å®ç°ä¸€éã€‚

## Examplesï¼šCounters



![](./IMGs/redux_counter.gif)

### 1. åˆ›å»ºProject

```shell
$ npm create vite@latest use-in-toolkit  -- --template react-ts 
$ cd use-in-toolkit && npm install @reduxjs/toolkit react-redux && code .
```

é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components â†’ è‡ªå®šä¹‰ç»„ä»¶
	      â”œâ”€â”€ /counter
            â”œâ”€â”€ Counter.css
            â””â”€â”€	Counter.tsx
        â””â”€â”€ /user
        	  â””â”€â”€	User.tsx
	  â”œâ”€â”€	/store      â†’ Redux Store
    		â”œâ”€â”€ /slices â†’ åŠŸèƒ½ï¼Œreducers & actions & chunks...
    				â”œâ”€â”€ counterSlice.ts
        		â””â”€â”€	userSlice.ts
    		â”œâ”€â”€ hooks.ts â†’ é’©å­
    		â””â”€â”€ index.ts â†’ ç»„åˆReducers/åˆ›å»ºStoreå®ä¾‹
	  â”œâ”€â”€	App.tsx
	  â”œâ”€â”€	index.less
	  â”œâ”€â”€	main.tsx â†’ Provider-Store
â”œâ”€â”€ ....
```

æ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®ä¸€ä¸‹å–åˆ«åï¼Œæ¯•ç«Ÿå¼•ç”¨è·¯å¾„ä¸­å‡ºç°æ³¨å…¥ **`./..`** çš„ç¬¦å·æˆ‘è§‰å¾—ç‰¹åˆ«æ‰­ã€‚

**ğŸ‘‰ `vite.config.ts`**

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
});
```

**ğŸ‘‰ `tsconfig.json`**

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

### 2. åˆ›å»ºRedux Store

**ğŸ‘‰ `@/store/index.ts`**

```typescript
import { AnyAction, configureStore, ThunkAction } from '@reduxjs/toolkit';
import couterReducer from '@/stores/slices/couterSlice';
import userReducer from '@/stores/slices/userSlice';

// ğŸ‘‰ è‡ªåŠ¨è°ƒç”¨ combineReducers åˆå¹¶ reducers
const store = configureStore({
  reducer: {
    counter: couterReducer,
    user: userReducer,
  },
});

// ğŸ‘‰ TypeScriptï¼šä» store æœ¬èº«æ¨æ–­å‡º RootState å’Œ AppDispatch ç±»å‹
export type AppDispatch = typeof store.dispatch;
export type RootState = ReturnType<typeof store.getState>;

// ğŸ‘‰ å®šä¹‰Chunkç±»å‹
export type AppThunk<ReturnType = void> = ThunkAction<ReturnType, RootState, unknown, AnyAction>;

export default store;

```

> æç¤ºï¼šconfigureStore æ–¹æ³•ä¸ºæˆ‘ä»¬è‡ªåŠ¨è°ƒç”¨å¹¶ç»„åˆï¼ˆcombineReducersï¼‰ Reducersã€‚

### 3. åˆ›å»ºRedux Slice

**ğŸ‘‰ `@/store/slices/counterSlice.ts`**

```typescript
import { createSlice, PayloadAction } from '@reduxjs/toolkit';
import { AppThunk, RootState } from '@/stores';

type CounterState = { count: number };

// ğŸ‘‰ initialState
const initialState: CounterState = { count: 0 };

// ğŸ‘‰ Chunks
// â†’ å¼‚æ­¥æ›´æ–°Storeï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ createAsyncThunk å‡½æ•°åˆ›å»º
export const incrementAsync = (amount: number): AppThunk => {
  return async (dispatch, getState) => {
    await new Promise((resolve) => {
      console.log('Loading...');
      setTimeout(() => {
        resolve(null);
      }, 1000);
    });
    dispatch(incrementByAmount(amount));
    console.log('Completed!');
  };
};

// ğŸ‘‰ Define Slice
const counterSlice = createSlice({
  name: 'counter',
  initialState,
  reducers: {
    // -- è‡ªåŠ¨ç”ŸæˆActionï¼š{ type: 'counter/increment' }
    increment: (state) => {
      // â†’ Redux Toolkit å…è®¸æˆ‘ä»¬åœ¨ reducers å†™ "å¯å˜" é€»è¾‘ã€‚
      // â†’ å¹¶ä¸æ˜¯çœŸæ­£çš„æ”¹å˜ state å› ä¸ºå®ƒä½¿ç”¨äº† immer åº“
      // â†’ å½“ immer æ£€æµ‹åˆ° ã€Œdraft stateã€ æ”¹å˜æ—¶ï¼Œä¼šåŸºäºè¿™äº›æ”¹å˜å»åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜çš„ state
      state.count += 1;
    },
    // -- è‡ªåŠ¨ç”ŸæˆActionï¼š{ type: 'counter/decrement' }
    decrement: (state) => {
      state.count -= 1;
    },
    // -- è‡ªåŠ¨ç”ŸæˆActionï¼š{ type: 'counter/incrementByAmount', payload: number }
    incrementByAmount: (state, action: PayloadAction<number>) => {
      state.count += action.payload;
    },
  },
});

// ğŸ‘‰ Selectors
export const selectCount = (state: RootState) => state.counter.count;

// ğŸ‘‰ Export Dispatchs
export const { increment, decrement, incrementByAmount } = counterSlice.actions;

// ğŸ‘‰ Export Reducer
export default counterSlice.reducer;
```

**ğŸ‘‰ `@/store/slices/userSlice`**

```typescript
import { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit';
import { AppDispatch, RootState } from '@/stores';

// ğŸ‘‰ Define some types.
type UserInfos = { name: string; job: string };
type UserState = { loading: boolean; infos: UserInfos };

// ğŸ‘‰ initialState
const initialState: UserState = {
  infos: { name: '', job: '' },
  loading: false,
};

// ğŸ‘‰ Chunks - å¼‚æ­¥é€»è¾‘
// â†’ æ ¹æ®IDè¯·æ±‚ç”¨æˆ·ä¿¡æ¯
export const fetchUserById = createAsyncThunk<
  // â†’ å®šä¹‰è¿”å›å€¼ç±»å‹
  UserInfos,
  // â†’ å®šä¹‰å‚æ•°ç±»å‹
  string,
  // â†’ å®šä¹‰ Thunk-Apis ç±»å‹ï¼Œæ¯”å¦‚ dispatch & getState è¿”å›å€¼ç±»å‹
  { dispatch: AppDispatch; state: RootState }
>('user/fetchUserById', async (userId, thunkApi) => {
  const { dispatch, getState, requestId, signal, extra } = thunkApi;
  console.log(getState());
  console.log(`USER ID is: ${userId}`);
  // â†’ æ¨¡æ‹Ÿè¯·æ±‚
  const response = await new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve({ name: 'å¼ ä¸‰', job: 'ç¨‹åºçŒ¿' });
    }, 1000);
  });
  // â†’ æ¨æ–­è¿”å›å€¼ç±»å‹
  return response as UserInfos;
});

// ğŸ‘‰ Define Slice
const userSlice = createSlice({
  name: 'user',
  initialState,
  reducers: {
    // -- è‡ªåŠ¨ç”ŸæˆActionï¼š{ type: 'user/updateInfos', payload: UserInfos }
    updateInfos: (state, action: PayloadAction<UserInfos>) => {
      state.infos = action.payload;
    },
  },
  // â†’ å¤„ç†å¼‚æ­¥ thunk dispatch çš„æ¯ä¸ª action
  extraReducers(builder) {
    builder
      .addCase(fetchUserById.pending, (state) => {
        state.loading = true;
      })
      .addCase(fetchUserById.fulfilled, (state, action) => {
        state.loading = false;
        state.infos = action.payload;
      })
      .addCase(fetchUserById.rejected, (state, action) => {
        state.loading = false;
        console.log(action.error.message);
      });
  },
});

// ğŸ‘‰ Selectors
export const selectInfos = (state: RootState) => state.user.infos;
export const selectLoading = (state: RootState) => state.user.loading;

// ğŸ‘‰ Export Dispatchs
export const { updateInfos } = userSlice.actions;

// ğŸ‘‰ Export Reducer
export default userSlice.reducer;
```

### 4. åˆ›å»ºRedux Hooks

**ğŸ‘‰ `@/store/hooks.ts`**

```typescript
import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';
import { AppDispatch, RootState } from '@/stores';

// ğŸ‘‰ æ¨èåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å•çº¯çš„ä½¿ç”¨ useDispatch & useSelector
export const useAppDispatch = () => useDispatch<AppDispatch>();
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;
```

### 5. åˆ›å»ºReact Counters-Comp

> **æç¤ºï¼š** **`Counter.css`** ç›´æ¥å¤åˆ¶ **Use-in-js** é‡Œçš„æ ·å¼ä»£ç å³å¯ã€‚

**ğŸ‘‰ `@/components/conter/Counter.tsx`**

```tsx
import React, { ChangeEvent, memo, useState } from 'react';
import { useAppDispatch, useAppSelector } from '@/stores/hooks';
import { decrement, increment, incrementAsync, incrementByAmount, selectCount } from '@/stores/slices/couterSlice';
import './Counter.css';

const Counter: React.FC = () => {
  // -- state
  const [incrementAmount, setIncrementAmount] = useState('5');
  // -- stores
  const count = useAppSelector(selectCount);
  // -- dispatch
  const dispatch = useAppDispatch();
  // -- methods
  const getNumAmount = () => Number(incrementAmount) || 0;
  // -- events
  const onIncrement = () => dispatch(increment());
  const onDecrement = () => dispatch(decrement());
  const onAddAmount = () => dispatch(incrementByAmount(getNumAmount()));
  const onAddAsync = () => dispatch(incrementAsync(getNumAmount()));
  const onInputChange = ($event: ChangeEvent<HTMLInputElement>) => setIncrementAmount($event.target.value);
  // -- renders
  return (
    <div className='counter'>
      <div className='row'>
        <button className='button' onClick={onIncrement}>+</button>
        <span className='value'>{count}</span>
        <button className='button' onClick={onDecrement}>-</button>
      </div>
      <div className='row'>
        <input
          className='textbox'
          value={incrementAmount}
          onChange={onInputChange}
        />
        <button className='button' onClick={onAddAmount}>Add Amount</button>
        <button className='button asyncButton' onClick={onAddAsync}>Add Async</button>
      </div>
    </div>
  );
};

export default memo(Counter);
```

**ğŸ‘‰ `@/components/user/User.tsx`**

```tsx
import { nanoid } from '@reduxjs/toolkit';
import React, { CSSProperties, memo } from 'react';
import { useAppDispatch, useAppSelector } from '@/stores/hooks';
import {
  fetchUserById,
  selectInfos,
  selectLoading,
} from '@/stores/slices/userSlice';

const User: React.FC = () => {
  // -- styles
  const styles: CSSProperties = {
    textAlign: 'center',
  };
  // -- stores
  const infos = useAppSelector(selectInfos);
  const loading = useAppSelector(selectLoading);
  // -- dispatch
  const dispatch = useAppDispatch();
  // -- renders
  return (
    <div style={styles}>
      <p>{loading ? 'Loading...' : `${infos.name} - ${infos.job}`}</p>
      {/* è¿™é‡Œ â€œfetchUserByIdâ€ çš„å‚æ•°è¢«è‡ªåŠ¨æ¨æ–­ä¸º string */}
      {/* ç”Ÿæˆéšæœºçš„IDå­—ç¬¦ä¸²ï¼šnanoid()  */}
      <button onClick={() => dispatch(fetchUserById(nanoid()))}>
        Fetch Infos
      </button>
    </div>
  );
};

export default memo(User);
```

**ğŸ‘‰ App.tsx**

```tsx
import React from 'react';
import Counter from '@/components/counter/Counter';
import User from '@/components/user/User';

const App: React.FC = () => (
  <div className='app'>
    <Counter />
    <User />
  </div>
);

export default App;
```

### 6. æ³¨å…¥Store

**ğŸ‘‰ main.tsx**

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

// â†’ React-Redux åˆ©ç”¨ä¸Šä¸‹æ–‡ Contextï¼Œæä¾›çš„æ•°æ®ç»„ä»¶ Provider
import { Provider } from 'react-redux';
import store from './stores';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    {/* ä½¿ç”¨Providerï¼ŒåŠ è½½æ•°æ®ä»“åº“ store å³å¯åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ store */}
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

è‡³æ­¤ï¼Œç¤ºä¾‹ä»£ç å·²ç¼–è¾‘å®Œæˆï¼Œè¿è¡Œä»£ç æŸ¥çœ‹æ•ˆæœå§ã€‚

## Examplesï¼šTodos

Nodeï¼šv18.17.1

pnpmï¼šv8.7.5

**ğŸ‘‰ Todos Intro.**

æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ä¸€ä¸ªå°å‹çš„  â€œå¾…åŠäº‹é¡¹â€ åº”ç”¨ç¨‹åºå¼€å§‹ã€‚é¦–å…ˆå¼„æ¸…æ¥šè¿™ä¸ªåº”ç”¨ç¨‹åºçš„åˆå§‹ä¸šåŠ¡éœ€æ±‚ï¼š

- UI åº”åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š
  - ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè®©ç”¨æˆ·è¾“å…¥æ–°å¾…åŠäº‹é¡¹çš„æ–‡æœ¬
  - æ‰€æœ‰ç°æœ‰å¾…åŠäº‹é¡¹çš„åˆ—è¡¨
  - é¡µè„šéƒ¨åˆ†ï¼Œæ˜¾ç¤ºæœªå®Œæˆçš„å¾…åŠäº‹é¡¹æ•°é‡ï¼Œå¹¶æ˜¾ç¤ºè¿‡æ»¤é€‰é¡¹
- å¾…åŠäº‹é¡¹åˆ—è¡¨é¡¹åº”è¯¥æœ‰ä¸€ä¸ªå¤é€‰æ¡†æ¥åˆ‡æ¢â€œå®Œæˆâ€çŠ¶æ€ã€‚è¿˜åº”è¯¥èƒ½å¤Ÿä¸ºé¢„å®šä¹‰çš„é¢œè‰²åˆ—è¡¨æ·»åŠ é¢œè‰²ç¼–ç çš„ç±»åˆ«æ ‡ç­¾ï¼Œå¹¶åˆ é™¤å¾…åŠäº‹é¡¹ã€‚
- è®¡æ•°å™¨åº”è¯¥å¤æ•°æ´»åŠ¨å¾…åŠäº‹é¡¹çš„æ•°é‡ï¼šâ€œ0 itemsâ€ã€â€œ1 itemsâ€ã€â€œ3 itemsâ€ç­‰
- åº”è¯¥æœ‰æŒ‰é’®å°†æ‰€æœ‰å¾…åŠäº‹é¡¹æ ‡è®°ä¸ºå·²å®Œæˆï¼Œå¹¶é€šè¿‡åˆ é™¤å®ƒä»¬æ¥æ¸…é™¤æ‰€æœ‰å·²å®Œæˆçš„å¾…åŠäº‹é¡¹
- åº”è¯¥æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è¿‡æ»¤åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„å¾…åŠäº‹é¡¹ï¼š
  - å¾…åŠäº‹é¡¹å¯åŸºäº All ã€ Active å’Œ Completed è¿›è¡Œè¿‡æ»¤
  - åŸºäºé€‰æ‹©ä¸€ç§æˆ–å¤šç§é¢œè‰²è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶æ˜¾ç¤ºæ ‡ç­¾ä¸è¿™äº›é¢œè‰²åŒ¹é…çš„ä»»ä½•å¾…åŠäº‹é¡¹

ç¨åå°†æ·»åŠ æ›´å¤šéœ€æ±‚ã€‚

### 1. åˆ›å»º & é…ç½®

#### åˆ›å»ºé¡¹ç›®

é¦–å…ˆæˆ‘ä»¬é€šè¿‡ vite åˆ›å»ºä¸€ä¸ª react-ts é¡¹ç›®

```shell
$ pnpm create vite todolist --template react-ts
$ cd todolist && pnpm install && code .
```

#### é…ç½®åˆ«å

å¼•ç”¨æ¨¡å—æ—¶ï¼Œä½¿ç”¨ @ å¼•ç”¨ï¼Œé¿å… `../..` å½±å“å¯è¯»æ€§ï¼Œè¿™é‡Œéœ€è¦é…ç½®ä¸€ä¸‹åˆ«åã€‚

â‘  å®‰è£…ç›¸å…³ä¾èµ–

```shell
$ pnpm i @types/node -D
```
â‘¡ æ›´æ–° `vite.config.ts`

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
});
```

â‘¢ åœ¨ `tsconfig.json` æ–‡ä»¶ä¸­æ–°å¢å¦‚ä¸‹é…ç½®ï¼š

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

#### ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components â†’ è‡ªå®šä¹‰ç»„ä»¶
	      â”œâ”€â”€ /footer
	  	  		â””â”€â”€	Footer.tsx
        â”œâ”€â”€ /header
        		â””â”€â”€	Header.tsx
        â””â”€â”€	/todos
        		â”œâ”€â”€ TodoList.tsx
        		â””â”€â”€	TodoListItem.tsx
	  â”œâ”€â”€	/constants  â†’ å¸¸é‡/è®°å½•æ»¤è‰²å™¨é¢œè‰²é›†åˆ
    		â””â”€â”€	index.ts
	  â”œâ”€â”€	/service    â†’ å¼‚æ­¥è¯·æ±‚
    		â””â”€â”€	index.ts
	  â”œâ”€â”€	/store      â†’ Redux Store
    		â”œâ”€â”€ /slices â†’ åŠŸèƒ½ï¼Œreducers & actions & chunks...
        		â”œâ”€â”€ filtersSlice.ts
        		â””â”€â”€	todosSlice.ts
    		â”œâ”€â”€ hooks.ts â†’ é’©å­
    		â””â”€â”€ index.ts â†’ ç»„åˆReducers/åˆ›å»ºStoreå®ä¾‹
	  â”œâ”€â”€	App.tsx
	  â”œâ”€â”€	index.less
	  â”œâ”€â”€	main.tsx â†’ Provider-Store
â”œâ”€â”€ ....
```

### 2. å®‰è£…ä¾èµ–

```shell
$ pnpm i @reduxjs/toolkit react-redux redux-logger 
```

```shell
$ pnpm i less @types/redux-logger -D
```

> **æç¤º**ï¼šç¤ºä¾‹ä½¿ç”¨ less æ„å»ºæ ·å¼ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å®‰è£… lessã€‚

### 3. åˆ›å»º Redux Slice













