# æ¦‚è¿°

éšç€åº”ç”¨ä¸æ–­å˜å¤§ï¼Œåˆç†ç»„ç»‡çŠ¶æ€å’Œæ•°æ®æµå¯¹äºä¿æŒä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§è‡³å…³é‡è¦ã€‚å†—ä½™æˆ–é‡å¤çš„çŠ¶æ€å®¹æ˜“å¯¼è‡´ä¸å¿…è¦çš„å¤æ‚æ€§å’Œ bugã€‚æœ¬èŠ‚ä»‹ç» **å¦‚ä½•ç»„ç»‡çŠ¶æ€ã€ä¼˜åŒ–çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œä»¥åŠå¦‚ä½•åœ¨ç»„ä»¶é—´å…±äº«çŠ¶æ€**ã€‚

> ğŸ“– **åˆ¤æ–­å“ªäº›æ•°æ®åº”è¯¥å­˜å…¥ state**

å¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½éœ€è¦å­˜å…¥ stateã€‚ä»¥ä¸‹å‡ ç§æƒ…å†µé€šå¸¸ä¸éœ€è¦å­˜å…¥ stateï¼š

1. âœ… **å¯ä»¥ä» props è®¡ç®—å¾—å‡ºçš„æ•°æ®** â€”â€” ç›´æ¥ä½¿ç”¨ props è®¡ç®—ï¼Œè€Œä¸æ˜¯å­˜å…¥ stateã€‚
2. âœ… **å¯ä»¥é€šè¿‡ UI æ§ä»¶å®æ—¶è®¡ç®—çš„æ•°æ®** â€”â€” ä¾‹å¦‚æœç´¢è¾“å…¥æ¡†å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ useStateï¼Œä½†ä¸éœ€è¦å­˜æ•´ä¸ªè¿‡æ»¤åçš„æ•°æ®åˆ—è¡¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ç”± filter() è®¡ç®—å¾—å‡ºã€‚
3. âœ… **å¯é€šè¿‡å…¶ä»–çŠ¶æ€æˆ–è®¡ç®—æ´¾ç”Ÿçš„æ•°æ®** â€”â€” ä¾‹å¦‚ isLoading çŠ¶æ€ï¼Œå¯èƒ½å¯ä»¥é€šè¿‡ data === null æ¥æ¨æ–­ã€‚

> ğŸ“– **çŠ¶æ€åº”å­˜åœ¨å“ªä¸ªç»„ä»¶ï¼Ÿ**

ç¡®å®šçŠ¶æ€çš„å½’å±ï¼Œå¯ä»¥æŒ‰ç…§ **è‡ªä¸Šè€Œä¸‹** çš„æ–¹å¼åˆ¤æ–­ï¼š

1. **è¯¥æ•°æ®æ˜¯å¦åªå½±å“æŸä¸ªç»„ä»¶ï¼Ÿ** â†’ æ”¾å…¥è¯¥ç»„ä»¶çš„ state ä¸­ã€‚
2. **è¯¥æ•°æ®æ˜¯å¦è¢«å¤šä¸ªç»„ä»¶ä½¿ç”¨ï¼Ÿ** â†’ æå‡åˆ°å®ƒä»¬çš„æœ€è¿‘å…¬å…±ç¥–å…ˆç»„ä»¶ï¼ˆLifting State Upï¼‰ã€‚
3. **æ˜¯å¦æœ‰æ›´å¥½çš„æ–¹å¼ï¼ˆå¦‚ Context æˆ–å…¨å±€çŠ¶æ€ç®¡ç†ï¼‰ï¼Ÿ**

# ç”¨Stateå“åº”è¾“å…¥

@See https://zh-hans.react.dev/learn/reacting-to-input-with-state

React é‡‡ç”¨å£°æ˜å¼æ–¹å¼æ§åˆ¶ UIï¼Œæ— éœ€ç›´æ¥æ“æ§å„ä¸ªéƒ¨åˆ†ï¼Œåªéœ€å®šä¹‰ç»„ä»¶çš„ä¸åŒçŠ¶æ€ï¼Œå¹¶æ ¹æ®ç”¨æˆ·è¾“å…¥åˆ‡æ¢ï¼Œä¸è®¾è®¡å¸ˆçš„ UI è®¾è®¡æ€ç»´ç›¸å¥‘åˆã€‚

## å£°æ˜å¼ UI vs. å‘½ä»¤å¼ UI

**è®¾è®¡ UI äº¤äº’çš„å…³é”®**åœ¨äºå¦‚ä½•è®©ç•Œé¢å“åº”ç”¨æˆ·æ“ä½œå¹¶åŠ¨æ€æ›´æ–°ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæäº¤ç­”æ¡ˆçš„è¡¨å•ä¸­ï¼š

- ç”¨æˆ·è¾“å…¥æ—¶ï¼Œ**æäº¤æŒ‰é’®å˜ä¸ºå¯ç”¨**ã€‚
- ç‚¹å‡»æäº¤åï¼Œ**è¡¨å•å’ŒæŒ‰é’®ç¦ç”¨**ï¼Œæ˜¾ç¤ºåŠ è½½åŠ¨ç”»ã€‚
- è¯·æ±‚æˆåŠŸï¼Œ**éšè—è¡¨å•ï¼Œæ˜¾ç¤ºâ€œæäº¤æˆåŠŸâ€**ã€‚
- è¯·æ±‚å¤±è´¥ï¼Œ**æ¢å¤è¡¨å•å¯ç”¨çŠ¶æ€ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯**ã€‚

**å‘½ä»¤å¼ç¼–ç¨‹**

åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­ï¼Œä½ éœ€è¦**é€æ­¥æŒ‡æŒ¥ UI å…ƒç´ çš„å˜åŒ–**ï¼Œæ˜ç¡®å‘Šè¯‰æ¯ä¸ªç»„ä»¶è¯¥åšä»€ä¹ˆï¼š

- **ç”¨æˆ·è¾“å…¥æ—¶**ï¼Œæ‰‹åŠ¨å¯ç”¨æŒ‰é’®ã€‚

- **ç‚¹å‡»æäº¤æ—¶**ï¼Œç¦ç”¨è¡¨å•å’ŒæŒ‰é’®ï¼Œå¹¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ã€‚

- **è¯·æ±‚æˆåŠŸæˆ–å¤±è´¥å**ï¼Œåˆ†åˆ«æ‰‹åŠ¨æ›´æ–° UIã€‚

è¿™å°±åƒåå‰¯é©¾é©¶æŒ‡æŒ¥å¸æœºï¼šâ€œç›´è¡Œâ€ã€â€œå·¦è½¬â€ã€â€œåœè½¦â€ã€‚å¸æœº**åªçŸ¥é“æ€ä¹ˆåš**ï¼Œä½†ä¸ç†è§£**ä¸ºä»€ä¹ˆè¿™ä¹ˆåš**ï¼Œå¦‚æœæŒ‡ä»¤é”™äº†ï¼Œæœ€ç»ˆç»“æœä¹Ÿä¼šå‡ºé”™ã€‚

**ä¸ºä»€ä¹ˆå«å‘½ä»¤å¼ç¼–ç¨‹ï¼Ÿ**

å› ä¸ºå®ƒéœ€è¦ä½  **ç›´æ¥æ“ä½œ UI å…ƒç´ **ï¼Œé€æ­¥æ›´æ–°çŠ¶æ€ã€‚**é€»è¾‘å¤æ‚æ—¶ï¼Œå®¹æ˜“å‡ºé”™**ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰å¤šä¸ªäº¤äº’çš„é¡µé¢ä¸­ï¼Œç¨æœ‰é—æ¼å°±å¯èƒ½å¯¼è‡´ UI çŠ¶æ€ä¸ä¸€è‡´ã€‚

**React çš„å£°æ˜å¼æ–¹å¼**

React é‡‡ç”¨**å£°æ˜å¼ç¼–ç¨‹**ï¼Œä½ åªéœ€**æè¿° UI åœ¨ä¸åŒçŠ¶æ€ä¸‹åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­**ï¼ŒReact ä¼šè‡ªåŠ¨è®¡ç®—å¹¶æ›´æ–° UIã€‚

è¿™å°±åƒåå‡ºç§Ÿè½¦ï¼Œä½ **åªéœ€å‘Šè¯‰å¸æœºç›®çš„åœ°**ï¼Œè€Œä¸æ˜¯ä¸€æ­¥æ­¥æŒ‡æŒ¥å¦‚ä½•é©¾é©¶ã€‚

**ä¼˜ç‚¹**

1. **é™ä½å¤æ‚åº¦**ï¼šæ— éœ€æ‰‹åŠ¨æ“ä½œ UIï¼ŒReact ä¼šè‡ªåŠ¨æ›´æ–°ã€‚

2. **å‡å°‘ bug**ï¼šé¿å…å› é—æ¼çŠ¶æ€æ›´æ–°å¯¼è‡´çš„é—®é¢˜ã€‚

3. **æ›´æ˜“ç»´æŠ¤**ï¼šä¿®æ”¹äº¤äº’é€»è¾‘æ—¶ï¼Œæ— éœ€æ£€æŸ¥æ‰€æœ‰æ—§ä»£ç ï¼Œåªéœ€è°ƒæ•´çŠ¶æ€å£°æ˜ã€‚

React çš„å£°æ˜å¼æ–¹å¼**è®©å¼€å‘è€…ä¸“æ³¨äºâ€œç›®æ ‡â€ï¼Œè€Œéè¿‡ç¨‹**ï¼Œæå‡äº†å¼€å‘æ•ˆç‡å’Œä»£ç å¯é æ€§ã€‚

## å£°æ˜å¼åœ°è€ƒè™‘ UI

æˆ‘ä»¬åˆšåˆšæåˆ°ï¼šåœ¨ç®€å•çš„ç³»ç»Ÿä¸­ï¼Œå‘½ä»¤å¼æ§åˆ¶ UI å¯èƒ½è¶³å¤Ÿï¼Œä½†åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œç®¡ç†ä¼šå˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨ **å£°æ˜å¼** çš„æ–¹å¼å®ç°ç›¸åŒçš„éœ€æ±‚ã€‚

### æ­¥éª¤ 1ï¼šè¯†åˆ« UI çš„ä¸åŒçŠ¶æ€

åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ**çŠ¶æ€æœº**æè¿°äº†ç³»ç»Ÿå¯èƒ½çš„çŠ¶æ€åŠå…¶è½¬æ¢ã€‚åœ¨ UI è®¾è®¡ä¸­ï¼Œè®¾è®¡å¸ˆé€šå¸¸ä¼šæä¾›ä¸åŒçŠ¶æ€çš„ç¤ºæ„å›¾ã€‚

React ç»“åˆäº†è¿™ä¸¤è€…çš„æ€æƒ³ï¼Œè®© UI æ›´æ¸…æ™°ã€å¯é¢„æµ‹ã€‚

**å¯è§†åŒ–è§†å›¾çŠ¶æ€**

åœ¨ç¼–å†™ä»£ç å‰ï¼Œå…ˆæ¢³ç† UI å¯èƒ½çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¡¨å•å¯èƒ½æœ‰ä»¥ä¸‹ 5 ç§çŠ¶æ€ï¼š

1. **æ— æ•°æ®**ï¼šè¡¨å•ä¸ºç©ºï¼Œâ€œæäº¤â€æŒ‰é’®ä¸å¯ç”¨ã€‚
2. **è¾“å…¥ä¸­**ï¼šç”¨æˆ·æ­£åœ¨è¾“å…¥ï¼Œâ€œæäº¤â€æŒ‰é’®å˜ä¸ºå¯ç”¨ã€‚
3. **æäº¤ä¸­**ï¼šç‚¹å‡»æäº¤åï¼Œè¡¨å•ç¦ç”¨ï¼Œæ˜¾ç¤ºåŠ è½½åŠ¨ç”»ã€‚
4. **æäº¤æˆåŠŸ**ï¼šè¡¨å•æ¶ˆå¤±ï¼Œæ˜¾ç¤ºâ€œæäº¤æˆåŠŸâ€æ¶ˆæ¯ã€‚
5. **æäº¤å¤±è´¥**ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œè¡¨å•æ¢å¤å¯ç¼–è¾‘çŠ¶æ€ã€‚

**ä½¿ç”¨ä»£ç æ¨¡æ‹ŸçŠ¶æ€**

ä½ å¯ä»¥ç”¨ä¸€ä¸ª status å±æ€§æ¥æ§åˆ¶è¿™äº›çŠ¶æ€ï¼š

```tsx
function Form({ status }: { status: string }) {
  if (status === "empty") return <button disabled>æäº¤</button>;
  if (status === "typing") return <button>æäº¤</button>;
  if (status === "submitting") return <p>æäº¤ä¸­...</p>;
  if (status === "success") return <p>æäº¤æˆåŠŸï¼</p>;
  if (status === "error")
    return (
      <>
        <p style={{ color: "red" }}>æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚</p>
        <button>æäº¤</button>
      </>
    );
  return null;
}
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œstatus è®¾ä¸º "empty"ï¼š

```tsx
<Form status="empty" />
```

**å¥½å¤„**

é€šè¿‡æ¨¡æ‹Ÿä¸åŒçŠ¶æ€ï¼Œå¯ä»¥æ›´æ¸…æ¥šåœ°ç†è§£å’Œå®šä¹‰ç»„ä»¶çš„è¡Œä¸ºï¼š

1. **é€»è¾‘æ¸…æ™°**ï¼šå„çŠ¶æ€ä¸€ç›®äº†ç„¶ï¼Œä¾¿äºæ‰©å±•äº¤äº’ã€‚
2. **æ›´æ˜“ç»´æŠ¤**ï¼šèƒ½è¿…é€Ÿå‘ç°é—æ¼çš„çŠ¶æ€ã€‚
3. **ç¬¦åˆè®¾è®¡é¢„æœŸ**ï¼šç¡®ä¿ UI ç¬¦åˆè®¾è®¡å¸ˆçš„æ€è·¯ã€‚

è¿™ä¸€æ­¥å¸®åŠ©å¼€å‘è€…åœ¨å¼€å§‹ç¼–å†™é€»è¾‘å‰æ‰“ä¸‹åšå®çš„åŸºç¡€ï¼Œä¹Ÿè®©åç»­çš„çŠ¶æ€ç®¡ç†æ›´ç®€å•æ˜äº†ã€‚

### æ­¥éª¤ 2ï¼šç¡®å®šçŠ¶æ€åˆ‡æ¢çš„è§¦å‘æ¡ä»¶

åœ¨ React ä¸­ï¼ŒçŠ¶æ€é€šå¸¸ç”±ä¸¤ç±»è¾“å…¥è§¦å‘ï¼š

1. **ç”¨æˆ·æ“ä½œ**ï¼ˆå¦‚è¾“å…¥æ–‡æœ¬ã€ç‚¹å‡»æŒ‰é’®ï¼‰ã€‚
2. **ç¨‹åºé€»è¾‘**ï¼ˆå¦‚ API å“åº”ã€å®šæ—¶å™¨è§¦å‘ï¼‰ã€‚

**è¡¨å•ä¸­çš„è§¦å‘æ¡ä»¶**

| è§¦å‘æ–¹å¼     | çŠ¶æ€å˜åŒ–             |
| ------------ | -------------------- |
| ç”¨æˆ·å¼€å§‹è¾“å…¥ | empty â†’ typing       |
| è¾“å…¥æ¡†æ¸…ç©º   | typing â†’ empty       |
| ç‚¹å‡»æäº¤æŒ‰é’® | typing â†’ submitting  |
| è¯·æ±‚æˆåŠŸ     | submitting â†’ success |
| è¯·æ±‚å¤±è´¥     | submitting â†’ error   |

ä¸ºäº†æ›´æ¸…æ™°åœ°è§„åˆ’çŠ¶æ€åŠå…¶åˆ‡æ¢è·¯å¾„ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªçŠ¶æ€æµå›¾è¡¨ç¤ºï¼š

- åœ†åœˆè¡¨ç¤ºçŠ¶æ€ï¼ˆemptyã€typingã€submittingâ€¦ï¼‰ã€‚

- ç®­å¤´è¡¨ç¤ºçŠ¶æ€è½¬æ¢çš„è§¦å‘æ¡ä»¶ã€‚

![](./imgs/responding_to_input_flow.webp)

æå‰ç»˜åˆ¶çŠ¶æ€æµå›¾ï¼Œå¯ä»¥å¸®åŠ©å‡å°‘æ½œåœ¨ bugï¼Œä½¿å®ç°æ›´æœ‰æ¡ç†ã€‚

### æ­¥éª¤ 3ï¼šä½¿ç”¨ useState ç®¡ç†çŠ¶æ€

åœ¨ React ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ useState æ¥å­˜å‚¨ UI çŠ¶æ€ã€‚

**å®šä¹‰æœ€æ ¸å¿ƒçš„çŠ¶æ€**

```tsx
const [answer, setAnswer] = useState(""); // ç”¨æˆ·è¾“å…¥
const [error, setError] = useState(null); // é”™è¯¯ä¿¡æ¯
```

è¿™ä¸¤éƒ¨åˆ†æ˜¯åŸºç¡€ï¼Œå®ƒä»¬ç›´æ¥å½±å“ UI æ˜¾ç¤ºã€‚

**è¡¨ç¤º UI è§†å›¾çŠ¶æ€**

æœ€åˆï¼Œä½ å¯èƒ½ä¼šå†™å¤šä¸ª useStateï¼š

```tsx
const [isEmpty, setIsEmpty] = useState(true);
const [isTyping, setIsTyping] = useState(false);
const [isSubmitting, setIsSubmitting] = useState(false);
const [isSuccess, setIsSuccess] = useState(false);
const [isError, setIsError] = useState(false);
```

ä½†è¿™æ ·ä¼šå¯¼è‡´çŠ¶æ€ç®¡ç†æ··ä¹±ï¼Œæˆ‘ä»¬å¯ä»¥**ä¼˜åŒ–**å®ƒã€‚

### æ­¥éª¤ 4ï¼šä¼˜åŒ–çŠ¶æ€ç®¡ç†ï¼Œå»é™¤å†—ä½™çŠ¶æ€

**ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–ï¼Ÿ**

1. **é˜²æ­¢çŸ›ç›¾çŠ¶æ€**ï¼šé¿å… isTyping å’Œ isSubmitting åŒæ—¶ä¸º trueã€‚

2. **å‡å°‘é‡å¤**ï¼šå¦‚æœçŠ¶æ€èƒ½ä»å·²æœ‰å˜é‡æ¨å¯¼ï¼Œå°±ä¸éœ€è¦å•ç‹¬å­˜å‚¨ã€‚
3. **æé«˜å¯ç»´æŠ¤æ€§**ï¼šé¿å…å¤æ‚çš„çŠ¶æ€åŒæ­¥é—®é¢˜ã€‚

**ä¼˜åŒ–æ­¥éª¤**

1. **åˆå¹¶äº’æ–¥çŠ¶æ€**

   ç¤ºä¾‹ä¸­ï¼ŒisTyping å’Œ isSubmitting æ˜¯äº’æ–¥çš„ï¼Œä¸å¯èƒ½åŒæ—¶ä¸º trueã€‚å¯ä»¥å°†å®ƒä»¬ç”¨ä¸€ä¸ª status å˜é‡è¡¨ç¤ºï¼š

   ```tsx
   const [status, setStatus] = useState("typing"); // 'typing', 'submitting', or 'success'
   ```

   è¿™ç§æ–¹å¼ç¡®ä¿äº†çŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œå¹¶ç§»é™¤äº†æ— æ•ˆç»„åˆã€‚

2. **åˆ é™¤å¯æ¨å¯¼çš„çŠ¶æ€**

   å¦‚æœä¸€ä¸ªçŠ¶æ€å˜é‡èƒ½ä»å¦ä¸€ä¸ªå˜é‡ä¸­æ¨å¯¼å‡ºæ¥ï¼Œå°±ä¸éœ€è¦é‡å¤å£°æ˜ã€‚ä¾‹å¦‚ï¼š

   - isEmpty å¯ä»¥é€šè¿‡ answer.length === 0 æ¨å¯¼å¾—å‡ºï¼Œä¸éœ€è¦å•ç‹¬å­˜å‚¨ã€‚

   - åªéœ€è¦ç»´æŠ¤ç”¨æˆ·è¾“å…¥çš„ answer å³å¯ï¼š
   
   ```tsx
   const [answer, setAnswer] = useState("");
   ```
3. **é¿å…å¤šä½™çŠ¶æ€**

   å¦‚æœä¸€ä¸ªçŠ¶æ€å¯ä»¥é€šè¿‡å…¶ä»–çŠ¶æ€çš„å€¼ç›´æ¥åˆ¤æ–­ï¼Œåˆ™æ— éœ€é¢å¤–å­˜å‚¨ã€‚ä¾‹å¦‚ï¼š

   - isError æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºä½ å¯ä»¥é€šè¿‡æ£€æŸ¥ error !== null æ¥åˆ¤æ–­ã€‚

   ```tsx
   const [error, setError] = useState(null);
   ```


æœ€ç»ˆï¼Œæˆ‘ä»¬åªä¿ç•™ 3 ä¸ªçŠ¶æ€å˜é‡ï¼š

```tsx
const [answer, setAnswer] = useState('');         // ç”¨æˆ·çš„è¾“å…¥
const [error, setError] = useState(null);         // é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
const [status, setStatus] = useState('typing');   // å½“å‰çŠ¶æ€ï¼š'typing', 'submitting', or 'success'
```

**å¥½å¤„**

- **é€»è¾‘æ›´æ¸…æ™°**ï¼šé¿å…çŠ¶æ€å†²çªå’Œé‡å¤ã€‚

- **çŠ¶æ€æ›´ç´§å‡‘**ï¼šå‡å°‘ä¸å¿…è¦çš„ useState è°ƒç”¨ã€‚

- **æ›´æ˜“æ‰©å±•**ï¼šåç»­å¢åŠ æ–°çŠ¶æ€ä¸ä¼šç ´ååŸæœ‰ä»£ç ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ç¡®ä¿æ¯ä¸ªçŠ¶æ€å˜é‡éƒ½å¿…è¦ä¸”åŠŸèƒ½æ˜ç¡®ï¼ŒåŒæ—¶é¿å…å¤æ‚çš„çŠ¶æ€ç®¡ç†é—®é¢˜ã€‚

### æ­¥éª¤ 5ï¼šç»‘å®šäº‹ä»¶ï¼Œæ›´æ–°çŠ¶æ€

æˆ‘ä»¬éœ€è¦**äº‹ä»¶å¤„ç†å‡½æ•°**æ¥æ›´æ–°çŠ¶æ€ï¼š

> ğŸ“– **æäº¤è¡¨å•**

```tsx
async function handleSubmit(e) {
  e.preventDefault();
  setStatus("submitting"); // è¿›å…¥æäº¤ä¸­çŠ¶æ€
  try {
    await submitForm(answer);
    setStatus("success"); // æäº¤æˆåŠŸ
  } catch (err) {
    setStatus("typing"); // å¤±è´¥åè¿”å›å¯ç¼–è¾‘çŠ¶æ€
    setError(err);
  }
}
```

> ğŸ“– **è¾“å…¥æ¡†æ›´æ–°**

```tsx
function handleTextareaChange(e) {
  setAnswer(e.target.value);
}
```

### å®Œæ•´ç¤ºä¾‹

```tsx
import { ChangeEvent, FormEvent, useState } from "react";

export default function App() {
  const [answer, setAnswer] = useState("");
  const [error, setError] = useState<Error | null>(null);
  const [status, setStatus] = useState<"typing" | "submitting" | "success">("typing");

  const submitForm = async (answer: string): Promise<void> => {
    // æ¨¡æ‹Ÿæ¥å£è¯·æ±‚
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        let shouldError = answer.toLowerCase() !== "æˆéƒ½";
        if (shouldError) {
          reject(new Error("çŒœçš„ä¸é”™ï¼Œä½†ç­”æ¡ˆä¸å¯¹ã€‚å†è¯•è¯•çœ‹å§ï¼"));
        } else {
          resolve();
        }
      }, 1500);
    });
  };

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setStatus("submitting");
    try {
      await submitForm(answer);
      setStatus("success");
    } catch (err: unknown) {
      setStatus("typing");
      setError(err as Error);
    }
  };

  const handleTextareaChange = (e: ChangeEvent<HTMLTextAreaElement>) => {
    setAnswer(e.target.value);
  };

  if (status === "success") {
    return <h1 className="m-4">ç­”å¯¹äº†ï¼</h1>;
  }

  return (
    <div className="m-4">
      <h2>åŸå¸‚æµ‹éªŒ</h2>
      <p>å“ªä¸ªåŸå¸‚æœ‰æŠŠç©ºæ°”å˜æˆé¥®ç”¨æ°´çš„å¹¿å‘Šç‰Œï¼Ÿ</p>
      <form onSubmit={handleSubmit}>
        <textarea 
          value={answer} 
          onChange={handleTextareaChange} 
          disabled={status === "submitting"} 
          className="border border-black" 
          rows={1} 
        />
        <br />
        <button disabled={answer.length === 0 || status === "submitting"}>æäº¤</button>
      </form>
      {status === "submitting" && <p>æäº¤ä¸­...</p>}
      {error !== null && <p className="Error">{error.message}</p>}
    </div>
  );
}
```

æ¼”ç¤ºæ•ˆæœï¼š

![](./imgs/state_response.gif)

# é€‰æ‹©Stateç»“æ„

@See https://zh-hans.react.dev/learn/choosing-the-state-structure

è‰¯å¥½çš„ state è®¾è®¡å¯ä»¥è®©ç»„ä»¶å˜å¾—æ›´æ˜“äºä¿®æ”¹ã€è°ƒè¯•å¹¶å‡å°‘é”™è¯¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æŒ‡å¯¼å»ºè®®ï¼Œå¸®åŠ©ä½ åœ¨æ„å»º state æ—¶åšå‡ºæ›´å¥½çš„å†³ç­–ã€‚

1. **åˆå¹¶å…³è”çš„ state**

   å¦‚æœä½ ç»å¸¸éœ€è¦åŒæ—¶æ›´æ–°å¤šä¸ª state å˜é‡ï¼Œè€ƒè™‘å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªå•ç‹¬çš„ state å˜é‡ã€‚è¿™æ ·ä¸ä»…å¯ä»¥å‡å°‘æ›´æ–°çš„å¤æ‚æ€§ï¼Œè¿˜èƒ½ç¡®ä¿å®ƒä»¬å§‹ç»ˆä¿æŒåŒæ­¥ã€‚

2. **é¿å…äº’ç›¸çŸ›ç›¾çš„ state**

   å¤šä¸ª state å˜é‡å¦‚æœå­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå¯èƒ½ä¼šå¯¼è‡´éš¾ä»¥è¿½è¸ªçš„é”™è¯¯ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå°½é‡ç¡®ä¿ä½ çš„ state å˜é‡ä¹‹é—´æ˜¯åè°ƒä¸€è‡´çš„ã€‚

3. **é¿å…å†—ä½™çš„ state**

   å¦‚æœæŸäº›æ•°æ®å¯ä»¥ä»ç°æœ‰çš„ props æˆ– state ä¸­è®¡ç®—å¾—åˆ°ï¼Œå°±ä¸å¿…å°†å…¶å­˜å…¥ stateã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç›´æ¥ä»å·²æœ‰çš„ state ä¸­æ´¾ç”Ÿå‡ºæ–°çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å†—ä½™å­˜å‚¨ã€‚

4. **é¿å…é‡å¤çš„ state**

   å½“åŒä¸€æ•°æ®åœ¨å¤šä¸ª state å˜é‡ä¸­æˆ–åœ¨åµŒå¥—å¯¹è±¡ä¸­é‡å¤å­˜å‚¨æ—¶ï¼Œå®¹æ˜“å‡ºç°åŒæ­¥é—®é¢˜ã€‚å°½é‡å‡å°‘è¿™ç§é‡å¤ï¼Œå¹¶ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚

5. **é¿å…æ·±åº¦åµŒå¥—çš„ state**

   æ·±å±‚åµŒå¥—çš„ state ä¸ä»…æ›´æ–°èµ·æ¥éº»çƒ¦ï¼Œè¿˜å®¹æ˜“å‡ºé”™ã€‚å°½å¯èƒ½å°† state ä¿æŒæ‰å¹³åŒ–ï¼Œç®€åŒ–æ›´æ–°é€»è¾‘ã€‚

è¿™äº›åŸåˆ™çš„ç›®æ ‡æ˜¯ **ç®€åŒ– state çš„æ›´æ–°æµç¨‹ï¼Œé¿å…å¼•å…¥é”™è¯¯**ã€‚é€šè¿‡é¿å…å†—ä½™ã€é‡å¤å’Œå¤æ‚çš„åµŒå¥—ç»“æ„ï¼Œå¯ä»¥ç¡®ä¿å„éƒ¨åˆ†ä¿æŒåŒæ­¥ï¼Œå‡å°‘æ½œåœ¨çš„é”™è¯¯ã€‚è¿™ç±»ä¼¼äºæ•°æ®åº“å·¥ç¨‹ä¸­çš„ **â€œè§„èŒƒåŒ–â€**ï¼Œæ—¨åœ¨å‡å°‘æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚

å¦‚çˆ±å› æ–¯å¦æ‰€è¨€ï¼šâ€œ**è®©ä½ çš„çŠ¶æ€å°½å¯èƒ½ç®€å•ï¼Œä½†ä¸è¦è¿‡äºç®€å•ã€‚**â€

# åœ¨ç»„ä»¶é—´å…±äº«çŠ¶æ€

@See https://zh-hans.react.dev/learn/sharing-state-between-components

åœ¨ React å¼€å‘ä¸­ï¼Œæœ‰æ—¶éœ€è¦è®©å¤šä¸ªç»„ä»¶å…±äº«åŒä¸€ä»½çŠ¶æ€ï¼Œå¹¶ä¿æŒå®ƒä»¬çš„åŒæ­¥æ›´æ–°ã€‚å®ç°è¿™ä¸€ç‚¹çš„æœ€ä½³æ–¹å¼æ˜¯ **â€œçŠ¶æ€æå‡â€**ï¼Œå³å°†çŠ¶æ€ä¸Šç§»åˆ°å®ƒä»¬çš„å…¬å…±çˆ¶çº§ç»„ä»¶ï¼Œå¹¶é€šè¿‡ props ä¼ é€’çŠ¶æ€åŠå…¶æ›´æ–°æ–¹æ³•ã€‚

**ğŸ”µ ç¤ºä¾‹ï¼šåŒæ­¥è¾“å…¥æ¡†å†…å®¹**

åŠŸèƒ½ï¼šå½“ä¸€ä¸ªè¾“å…¥æ¡†è¾“å…¥å†…å®¹æ—¶ï¼Œå¦ä¸€ä¸ªè¾“å…¥æ¡†è‡ªåŠ¨åŒæ­¥ã€‚

å®ç°æ–¹å¼ï¼š

- å°† value çŠ¶æ€å­˜å‚¨åœ¨çˆ¶ç»„ä»¶
- åœ¨ onChange äº‹ä»¶ä¸­æ›´æ–° value
- é€šè¿‡ props å°† value å’Œ onChange ä¼ é€’ç»™å­ç»„ä»¶

ä»£ç å®ç°ï¼š

```tsx
import { useState } from "react";

function Input({ value, onChange }: { value: string; onChange: (value: string) => void }) {
  return (
    <fieldset className="border border-black p-4 m-4">
      <legend>Please enter messageï¼š</legend>
      <input 
        className="border border-gray-200 px-4 py-2" 
        type="text" 
        value={value} 
        onChange={(e) => onChange(e.target.value)} 
      />
    </fieldset>
  );
}

export default function App() {
  const [value, setValue] = useState("");

  const handleChange = (value: string) => {
    setValue(value);
  };

  return (
    <div>
      <Input value={value} onChange={handleChange} />
      <Input value={value} onChange={handleChange} />
    </div>
  );
}
```

![](/Users/lihongyao/Desktop/repositories/React/IMGS/promote.gif)

ğŸ”µ **ä»£ç è§£æ**

1. Input ç»„ä»¶ï¼š
   - value ç»‘å®šåˆ° props.value
   - onChange è§¦å‘æ—¶ï¼Œè°ƒç”¨ props.onChange ä¼ é€’æ–°å€¼
2. App ç»„ä»¶ï¼š
   - ä½¿ç”¨ useState å­˜å‚¨ value
   - é€šè¿‡ setValue æ›´æ–° value
   - å°† value å’Œ setValue ä¼ é€’ç»™ä¸¤ä¸ª Input ç»„ä»¶

ğŸ”µ **çŠ¶æ€æå‡çš„æ ¸å¿ƒé€»è¾‘**

å½“ Input ç»„ä»¶çš„ onChange è§¦å‘æ—¶ï¼š

1. è°ƒç”¨ setValue æ›´æ–° value
2. è§¦å‘ App ç»„ä»¶é‡æ–°æ¸²æŸ“
3. value å˜æ›´åï¼Œä¸¤ä¸ª Input ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä¿æŒåŒæ­¥

**ğŸ”µ ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ Input ç»„ä»¶å†…å­˜å‚¨ valueï¼Ÿ**

å¦‚æœ Input ç»„ä»¶è‡ªå·±ç»´æŠ¤ valueï¼Œæ¯ä¸ª Input ç»„ä»¶éƒ½ä¼šæœ‰è‡ªå·±çš„ useStateï¼Œå¯¼è‡´ä¸¤ä¸ªè¾“å…¥æ¡†çš„å€¼æ— æ³•åŒæ­¥ã€‚å› æ­¤ï¼Œéœ€è¦ **å°† state æå‡åˆ°æœ€è¿‘çš„å…¬å…±çˆ¶çº§**ï¼Œè®© App ç»„ä»¶é›†ä¸­ç®¡ç† valueã€‚

**ğŸ”µ å°èŠ‚**

1. **çŠ¶æ€æå‡** æ˜¯å…±äº«çŠ¶æ€çš„æ¨èæ–¹å¼ï¼Œç¡®ä¿æ•°æ®æ¥æºå”¯ä¸€ï¼Œå‡å°‘æ•°æ®åŒæ­¥çš„å¤æ‚æ€§ã€‚
2. **è‡ªä¸Šè€Œä¸‹çš„æ•°æ®æµ** æœ‰åŠ©äº bug æ’æŸ¥ï¼Œå› ä¸ºçŠ¶æ€åªèƒ½ç”±ç®¡ç†å®ƒçš„ç»„ä»¶ä¿®æ”¹ï¼Œæ•°æ®æµæ¸…æ™°å¯æ§ã€‚
3. **å°½é‡é¿å…å¤šä¸ªç»„ä»¶é—´åŒæ­¥ state**ï¼Œè€Œåº”å°† state æå‡åˆ°å…¬å…±çˆ¶çº§ç»„ä»¶ï¼Œä»¥ç¡®ä¿ä¸€è‡´æ€§ã€‚

è™½ç„¶çŠ¶æ€æå‡æ¯”åŒå‘ç»‘å®šéœ€è¦å†™æ›´å¤šçš„ä»£ç ï¼Œä½†å®ƒä½¿å¾—æ•°æ®æµæ›´æ¸…æ™°ï¼Œå¯ç»´æŠ¤æ€§æ›´é«˜ï¼Œå¹¶å‡å°‘äº†æ½œåœ¨çš„åŒæ­¥é—®é¢˜ã€‚

# å¯¹ state è¿›è¡Œä¿ç•™å’Œé‡ç½®

@See https://zh-hans.react.dev/learn/preserving-and-resetting-state

åœ¨ React å¼€å‘ä¸­ï¼Œç»„ä»¶çš„çŠ¶æ€ï¼ˆstateï¼‰ç®¡ç†æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚ç†è§£ React å¦‚ä½•ä¿ç•™å’Œé‡ç½®ç»„ä»¶çš„çŠ¶æ€ï¼Œå¯¹äºæ„å»ºé«˜æ•ˆã€å¯é¢„æµ‹çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚æ¥ä¸‹æ¥å°†å¸¦ä½ å¿«é€Ÿäº†è§£ React ä¸­ state çš„ä¿ç•™ä¸é‡ç½®æœºåˆ¶ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶ç»„ä»¶çš„çŠ¶æ€ã€‚

## çŠ¶æ€ä¸æ¸²æŸ“æ ‘çš„ä½ç½®

React é€šè¿‡ç»„ä»¶åœ¨æ¸²æŸ“æ ‘ä¸­çš„ä½ç½®æ¥è·Ÿè¸ªæ¯ä¸ªç»„ä»¶çš„çŠ¶æ€ã€‚è¿™æ„å‘³ç€ï¼Œ åªè¦ç»„ä»¶åœ¨ UI æ ‘ä¸­çš„ä½ç½®ä¸å˜ï¼ŒReact å°±ä¼šä¿ç•™å®ƒçš„çŠ¶æ€ ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨åŒä¸€ä¸ªä½ç½®å¤šæ¬¡æ¸²æŸ“åŒä¸€ä¸ªç»„ä»¶ï¼ŒReact ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªç»„ä»¶ï¼Œå¹¶ä¿ç•™å…¶çŠ¶æ€ã€‚

```tsx
function App() {
  return (
    <div>
      <Counter />
      <Counter />
    </div>
  );
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸¤ä¸ª Counter ç»„ä»¶å„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„çŠ¶æ€ï¼Œå› ä¸ºå®ƒä»¬è¢«æ¸²æŸ“åœ¨äº†ä¸åŒçš„ä½ç½®ã€‚

## çŠ¶æ€çš„é‡ç½®

å½“ç»„ä»¶è¢«ç§»é™¤æˆ–æ›¿æ¢æ—¶ï¼ŒReact ä¼šé”€æ¯å®ƒçš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ é€šè¿‡æ¡ä»¶æ¸²æŸ“æ¥åˆ‡æ¢ç»„ä»¶ï¼ŒReact ä¼šåœ¨ç»„ä»¶è¢«ç§»é™¤æ—¶é‡ç½®å…¶çŠ¶æ€ã€‚

```tsx
function App() {
  const [show, setShow] = useState(true);
  return (
    <div>
      {show && <Counter />}
      <button onClick={() => setShow(!show)}>Toggle Counter</button>
    </div>
  );
}
```

## ä½¿ç”¨ `key` å¼ºåˆ¶é‡ç½®çŠ¶æ€

æœ‰æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨ç›¸åŒä½ç½®æ¸²æŸ“ç›¸åŒç»„ä»¶æ—¶é‡ç½®å…¶çŠ¶æ€ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ key å±æ€§ã€‚ key å‘Šè¯‰ Reactï¼Œå³ä½¿ç»„ä»¶åœ¨ç›¸åŒä½ç½®ï¼Œå®ƒä»¬ä¹Ÿæ˜¯ä¸åŒçš„å®ä¾‹ã€‚

```tsx
function App() {
  const [isPlayerA, setIsPlayerA] = useState(true);
  return (
    <div>
      {isPlayerA ? (
        <Counter key="Taylor" person="Taylor" />
      ) : (
        <Counter key="Sarah" person="Sarah" />
      )}
      <button onClick={() => setIsPlayerA(!isPlayerA)}>åˆ‡æ¢ç©å®¶</button>
    </div>
  );
}
```

## é¿å…åµŒå¥—ç»„ä»¶å®šä¹‰

åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰å…¶ä»–ç»„ä»¶ä¼šå¯¼è‡´æ¯æ¬¡æ¸²æŸ“æ—¶åˆ›å»ºæ–°çš„ç»„ä»¶å®ä¾‹ï¼Œä»è€Œå¯¼è‡´çŠ¶æ€è¢«æ„å¤–é‡ç½®ã€‚

ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œ å§‹ç»ˆå°†ç»„ä»¶å®šä¹‰åœ¨é¡¶å±‚ ã€‚

```tsx
// é”™è¯¯ç¤ºä¾‹
function MyComponent() {
  function MyTextField() {
    const [text, setText] = useState('');
    return <input value={text} onChange={e => setText(e.target.value)} />;
  }
  return <MyTextField />;
}

// æ­£ç¡®ç¤ºä¾‹
function MyTextField() {
  const [text, setText] = useState('');
  return <input value={text} onChange={e => setText(e.target.value)} />;
}

function MyComponent() {
  return <MyTextField />;
}
```

## æ€»ç»“

1. **çŠ¶æ€ä¿ç•™** ï¼šåªè¦ç»„ä»¶åœ¨ç›¸åŒä½ç½®æ¸²æŸ“ï¼ŒReact å°±ä¼šä¿ç•™å…¶çŠ¶æ€ã€‚
2. **çŠ¶æ€é‡ç½®** ï¼šå½“ç»„ä»¶è¢«ç§»é™¤æˆ–æ›¿æ¢æ—¶ï¼ŒReact ä¼šé‡ç½®å…¶çŠ¶æ€ã€‚
3. **ä½¿ç”¨ `key`** ï¼šé€šè¿‡ `key` å¯ä»¥åœ¨ç›¸åŒä½ç½®æ¸²æŸ“ç›¸åŒç»„ä»¶æ—¶å¼ºåˆ¶é‡ç½®çŠ¶æ€ã€‚
4. **é¿å…åµŒå¥—ç»„ä»¶å®šä¹‰** ï¼šåµŒå¥—ç»„ä»¶å®šä¹‰ä¼šå¯¼è‡´çŠ¶æ€æ„å¤–é‡ç½®ï¼Œåº”å°†ç»„ä»¶å®šä¹‰åœ¨é¡¶å±‚ã€‚

ç†è§£è¿™äº›æœºåˆ¶ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶ React ç»„ä»¶çš„çŠ¶æ€ï¼Œæ„å»ºæ›´ç¨³å®šã€å¯é¢„æµ‹çš„åº”ç”¨ç¨‹åºã€‚

# è¿ç§»çŠ¶æ€é€»è¾‘è‡³ Reducer ä¸­

åœ¨ React å¼€å‘ä¸­ï¼Œéšç€ç»„ä»¶é€»è¾‘çš„å¤æ‚åŒ–ï¼ŒçŠ¶æ€ç®¡ç†å¾€å¾€ä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚ç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤šä¸ªçŠ¶æ€æ›´æ–°é€»è¾‘æ—¶ï¼Œä»£ç å¯èƒ½ä¼šå˜å¾—å†—é•¿ä¸”éš¾ä»¥ç†è§£ã€‚ä¸ºäº†åº”å¯¹è¿™ä¸€é—®é¢˜ï¼ŒReact æä¾›äº†ä¸€ç§æ›´ä¸ºç»“æ„åŒ–çš„çŠ¶æ€ç®¡ç†æ–¹å¼ï¼š Reducer ã€‚

## ä»€ä¹ˆæ˜¯ Reducerï¼Ÿ

Reducer æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè´Ÿè´£å¤„ç†ç»„ä»¶çš„çŠ¶æ€æ›´æ–°é€»è¾‘ã€‚ä¸ç›´æ¥ä½¿ç”¨ useState ä¸åŒï¼ŒReducer å°†çŠ¶æ€æ›´æ–°çš„é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Reducerï¼Ÿ

1. **ä»£ç ç»„ç»‡** ï¼šå½“ç»„ä»¶çš„çŠ¶æ€æ›´æ–°é€»è¾‘åˆ†æ•£åœ¨å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºä¸­æ—¶ï¼Œä»£ç ä¼šå˜å¾—éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚Reducer å°†è¿™äº›é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œä½¿å¾—ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ã€‚
2. **å¯è°ƒè¯•æ€§** ï¼šReducer ä½¿å¾—çŠ¶æ€æ›´æ–°é€»è¾‘æ›´åŠ é€æ˜ï¼Œä½ å¯ä»¥é€šè¿‡æ‰“å°æ—¥å¿—æ¥è§‚å¯Ÿæ¯ä¸ªçŠ¶æ€çš„æ›´æ–°ï¼Œä»è€Œæ›´å®¹æ˜“å‘ç°å’Œä¿®å¤é—®é¢˜ã€‚
3. **å¯æµ‹è¯•æ€§** ï¼šReducer æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸ä¾èµ–äºç»„ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œå› æ­¤å¯ä»¥å•ç‹¬è¿›è¡Œæµ‹è¯•ã€‚

## å¦‚ä½•å°† useState è¿ç§»åˆ° useReducer ï¼Ÿ

1. **å®šä¹‰ Action** ï¼šé¦–å…ˆï¼Œä½ éœ€è¦å®šä¹‰ä¸€äº› Actionï¼Œè¿™äº› Action æè¿°äº†ç”¨æˆ·çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ·»åŠ ä»»åŠ¡ã€ä¿®æ”¹ä»»åŠ¡ã€åˆ é™¤ä»»åŠ¡ç­‰ã€‚
2. **ç¼–å†™ Reducer å‡½æ•°** ï¼šReducer å‡½æ•°æ¥å—å½“å‰çŠ¶æ€å’Œä¸€ä¸ª Actionï¼Œå¹¶è¿”å›æ–°çš„çŠ¶æ€ã€‚ä½ å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°ä¸­å¤„ç†æ‰€æœ‰çš„çŠ¶æ€æ›´æ–°é€»è¾‘ã€‚
3. **ä½¿ç”¨ useReducer** ï¼šåœ¨ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ useReducer æ›¿æ¢ useState ï¼Œå¹¶å°† Reducer å‡½æ•°å’Œåˆå§‹çŠ¶æ€ä¼ é€’ç»™å®ƒã€‚

## ç¤ºä¾‹ä»£ç 

```tsx
import React, { useReducer } from "react";

// -- å®šä¹‰ä»»åŠ¡ç±»å‹
interface Task {
  id: number;
  text: string;
  done: boolean;
}

// -- å®šä¹‰ Action ç±»å‹
type Action = 
	{ type: "added"; id: number; text: string } | 
	{ type: "changed"; task: Task } | 
	{ type: "deleted"; id: number };

// -- å®šä¹‰ Reducer å‡½æ•°
function tasksReducer(tasks: Task[], action: Action): Task[] {
  switch (action.type) {
    case "added":
      return [...tasks, { id: action.id, text: action.text, done: false }];
    case "changed":
      return tasks.map((t) => (t.id === action.task.id ? action.task : t));
    case "deleted":
      return tasks.filter((t) => t.id !== action.id);
    default:
      throw new Error("æœªçŸ¥ action: " + (action as any).type);
  }
}

// -- å®šä¹‰ AddTask ç»„ä»¶
function AddTask({ onAddTask }: { onAddTask: (text: string) => void }) {
  const [text, setText] = React.useState("");
  return (
    <div className="space-x-4 mb-4">
      <input className="border border-gray-200" value={text} onChange={(e) => setText(e.target.value)} />
      <button className="bg-blue-500 text-white px-2 cursor-pointer" onClick={() => onAddTask(text)}>
        æ·»åŠ ä»»åŠ¡
      </button>
    </div>
  );
}

// -- å®šä¹‰ TaskList ç»„ä»¶
function TaskList({ 
  tasks, 
  onChangeTask, 
  onDeleteTask 
}: { 
  tasks: Task[]; 
  onChangeTask: (task: Task) => void; 
  onDeleteTask: (id: number) => void 
}) {
  return (
    <ul className="space-y-2">
      {tasks.map((task) => (
        <li key={task.id} className="space-x-2">
          <input 
            type="checkbox" 
            checked={task.done} 
            onChange={() => onChangeTask({ ...task, done: !task.done })} 
          />
          <span>{task.text}</span>
          <button className="text-red-500 cursor-pointer" onClick={() => onDeleteTask(task.id)}>
            åˆ é™¤
          </button>
        </li>
      ))}
    </ul>
  );
}

// -- å®šä¹‰åˆå§‹ä»»åŠ¡
const initialTasks: Task[] = [];
let nextId = 0;

// -- å®šä¹‰ TaskApp ç»„ä»¶
export default function TaskApp() {
  const [tasks, dispatch] = useReducer(tasksReducer, initialTasks);

  const handleAddTask = (text: string) => dispatch({ type: "added", id: nextId++, text });
  const handleChangeTask = (task: Task) => dispatch({ type: "changed", task });
  const handleDeleteTask = (taskId: number) => dispatch({ type: "deleted", id: taskId });

  return (
    <div className="m-4">
      <h1>å¼ ä¸‰çš„è¡Œç¨‹å®‰æ’</h1>
      <AddTask onAddTask={handleAddTask} />
      <TaskList tasks={tasks} onChangeTask={handleChangeTask} onDeleteTask={handleDeleteTask} />
    </div>
  );
}

```

## æ€»ç»“

ä½¿ç”¨ Reducer å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç»„ç»‡å’Œç®¡ç† React ç»„ä»¶çš„çŠ¶æ€é€»è¾‘ã€‚è™½ç„¶å®ƒå¯èƒ½éœ€è¦ç¼–å†™æ›´å¤šçš„ä»£ç ï¼Œä½†åœ¨å¤„ç†å¤æ‚çŠ¶æ€æ›´æ–°æ—¶ï¼Œå®ƒèƒ½æ˜¾è‘—æå‡ä»£ç çš„å¯è¯»æ€§ã€å¯è°ƒè¯•æ€§å’Œå¯æµ‹è¯•æ€§ã€‚å¦‚æœä½ å‘ç°ç»„ä»¶çš„çŠ¶æ€ç®¡ç†å˜å¾—éš¾ä»¥ç»´æŠ¤ï¼Œä¸å¦¨å°è¯•å°†çŠ¶æ€é€»è¾‘è¿ç§»åˆ° Reducer ä¸­ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥è®©ä»£ç æ›´åŠ ç»“æ„åŒ–ï¼Œå‡å°‘ bug çš„å‡ºç°ï¼Œå¹¶æå‡å¼€å‘æ•ˆç‡ã€‚

# ä½¿ç”¨ Context æ·±å±‚ä¼ é€’å‚æ•°

åœ¨ React ä¸­ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šé€šè¿‡ props å°†ä¿¡æ¯ä»çˆ¶ç»„ä»¶ä¼ é€’åˆ°å­ç»„ä»¶ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æ ‘ä¸­æ·±å±‚ä¼ é€’å‚æ•°ï¼Œæˆ–è€…å¤šä¸ªç»„ä»¶éœ€è¦ç›¸åŒçš„ä¿¡æ¯æ—¶ï¼Œé€å±‚ä¼ é€’ props ä¼šå˜å¾—å†—é•¿ä¸”ä¸ä¾¿ã€‚React çš„ Context æä¾›äº†ä¸€ç§æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå…è®¸çˆ¶ç»„ä»¶å‘å…¶ä¸‹å±‚æ— è®ºå¤šæ·±çš„ä»»ä½•ç»„ä»¶æä¾›ä¿¡æ¯ï¼Œè€Œæ— éœ€é€šè¿‡ props æ˜¾å¼ä¼ é€’ã€‚

## ä¼ é€’ props å¸¦æ¥çš„é—®é¢˜

åœ¨ React ä¸­ï¼Œ props æ˜¯é€šè¿‡ç»„ä»¶æ ‘ä»ä¸Šåˆ°ä¸‹é€å±‚ä¼ é€’çš„ã€‚å¦‚æœæŸä¸ªç»„ä»¶éœ€è¦çš„æ•°æ®æ¥è‡ªå¾ˆè¿œçš„çˆ¶ç»„ä»¶ï¼Œé‚£ä¹ˆä¸­é—´çš„æ‰€æœ‰ç»„ä»¶éƒ½éœ€è¦æ¥æ”¶å¹¶ä¼ é€’è¿™ä¸ª props ï¼Œå³ä½¿å®ƒä»¬æœ¬èº«å¹¶ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªæ•°æ®ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¸º â€œ**prop é€çº§é€ä¼ **â€ã€‚

![](./imgs/passing_data_prop_drilling.jpg)

## ä½¿ç”¨ Context ä»£æ›¿é‡å¤çš„å‚æ•°ä¼ é€’

è¦æ˜¯æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åœ¨ç»„ä»¶æ ‘ä¸­ä¸éœ€è¦ props å°†æ•°æ®â€œç›´è¾¾â€åˆ°æ‰€éœ€çš„ç»„ä»¶ä¸­ï¼Œé‚£å¯å°±å¤ªå¥½äº†ã€‚React çš„ context åŠŸèƒ½å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„è¿™ä¸ªå¿ƒæ„¿ã€‚

Context æä¾›äº†ä¸€ç§åœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®çš„æ–¹å¼ï¼Œè€Œä¸éœ€è¦æ˜¾å¼åœ°é€šè¿‡æ¯ä¸ªå±‚çº§ä¼ é€’ props ã€‚é€šè¿‡ Context ï¼Œçˆ¶ç»„ä»¶å¯ä»¥ä¸ºå®ƒä¸‹é¢çš„æ•´ä¸ªç»„ä»¶æ ‘æä¾›æ•°æ®ï¼Œå­ç»„ä»¶å¯ä»¥ç›´æ¥è®¿é—®è¿™äº›æ•°æ®ï¼Œè€Œä¸éœ€è¦é€šè¿‡ä¸­é—´ç»„ä»¶ä¼ é€’ã€‚

![](./imgs/passing_data_context_far.jpg)

### Context çš„å¸¸è§ç”¨æ³•

Context çš„å¸¸è§ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š

1. **ä¸»é¢˜** ï¼šå…è®¸ç”¨æˆ·æ›´æ”¹åº”ç”¨çš„å¤–è§‚ï¼ˆå¦‚æš—å¤œæ¨¡å¼ï¼‰ã€‚
2. **å½“å‰è´¦æˆ·** ï¼šè®¸å¤šç»„ä»¶å¯èƒ½éœ€è¦çŸ¥é“å½“å‰ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ã€‚
3. **è·¯ç”±** ï¼šå¤§å¤šæ•°è·¯ç”±è§£å†³æ–¹æ¡ˆåœ¨å…¶å†…éƒ¨ä½¿ç”¨ Context æ¥ä¿å­˜å½“å‰è·¯ç”±ã€‚
4. **çŠ¶æ€ç®¡ç†** ï¼šéšç€åº”ç”¨çš„å¢é•¿ï¼Œ Context å¯ä»¥ä¸ Reducer ç»“åˆä½¿ç”¨ï¼Œç®¡ç†å¤æ‚çš„çŠ¶æ€å¹¶å°†å…¶ä¼ é€’ç»™æ·±å±‚çš„ç»„ä»¶ã€‚

### Context çš„å¸¸è§æ›¿ä»£æ–¹æ¡ˆ

åœ¨ä½¿ç”¨ Context ä¹‹å‰ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ç§æ›¿ä»£æ–¹æ¡ˆï¼š

1. **ä¼ é€’ props** ï¼šå¦‚æœç»„ä»¶çœ‹èµ·æ¥ä¸èµ·çœ¼ï¼Œé€šè¿‡å¤šä¸ªç»„ä»¶ä¼ é€’ props å¹¶ä¸ç½•è§ã€‚
2. **æŠ½è±¡ç»„ä»¶å¹¶å°† JSX ä½œä¸º children ä¼ é€’** ï¼šå¦‚æœé€šè¿‡å¾ˆå¤šå±‚ä¸ä½¿ç”¨è¯¥æ•°æ®çš„ä¸­é—´ç»„ä»¶ä¼ é€’æ•°æ®ï¼Œé€šå¸¸æ„å‘³ç€ä½ åœ¨æ­¤è¿‡ç¨‹ä¸­å¿˜è®°äº†æŠ½è±¡ç»„ä»¶ã€‚

### å¦‚ä½•ä½¿ç”¨ Context

ä½¿ç”¨ Context é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š

1. **åˆ›å»º Context**ï¼šä½¿ç”¨ createContext åˆ›å»ºä¸€ä¸ª Context ï¼Œå¹¶å¯¼å‡ºå®ƒã€‚
2. **ä½¿ç”¨ Context**ï¼šåœ¨éœ€è¦æ•°æ®çš„ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ useContext Hook æ¥è¯»å– Context ã€‚
3. **æä¾› Context**ï¼šåœ¨çˆ¶ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ Context.Provider åŒ…è£¹å­ç»„ä»¶ï¼Œå¹¶æä¾› Context çš„å€¼ã€‚

### ç¤ºä¾‹ï¼šä¸»é¢˜åˆ‡æ¢

1ï¸âƒ£ **åˆ›å»º Context å’Œæä¾›è€…ï¼ˆProviderï¼‰**

é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ª Context å’Œä¸€ä¸ªæä¾›çŠ¶æ€çš„ Providerã€‚

**`@/context/ThemeContext.tsx`**

```tsx
import { createContext, useState, ReactNode, useContext } from "react";

// -- å®šä¹‰ä¸»é¢˜ç±»å‹
type Theme = "light" | "dark";

// -- å®šä¹‰ Context çš„ç±»å‹
interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
}

// -- åˆ›å»º Contextï¼Œåˆå§‹å€¼ä¸º light ä¸»é¢˜
const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

// -- åˆ›å»ºæä¾›è€…ç»„ä»¶
export function ThemeProvider({ children }: { children: ReactNode }) {
  const [theme, setTheme] = useState<Theme>("light");

  const toggleTheme = () => {
    setTheme((prevTheme) => (prevTheme === "light" ? "dark" : "light"));
  };

  return <ThemeContext.Provider value={{ theme, toggleTheme }}>{children}</ThemeContext.Provider>;
}

// -- è‡ªå®šä¹‰ hook æ¥ä½¿ç”¨ ThemeContext
export const useTheme = (): ThemeContextType => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error("useTheme must be used within a ThemeProvider");
  }
  return context;
};
```

2ï¸âƒ£  **åœ¨åº”ç”¨ä¸­ä½¿ç”¨ Provider åŒ…è£¹ç»„ä»¶**

ç„¶åï¼Œåœ¨åº”ç”¨çš„æ ¹ç»„ä»¶ä¸­ä½¿ç”¨ ThemeProvider æ¥åŒ…è£¹æ•´ä¸ªåº”ç”¨ï¼Œç¡®ä¿æ‰€æœ‰å­ç»„ä»¶éƒ½å¯ä»¥è®¿é—®åˆ° Context æä¾›çš„çŠ¶æ€ã€‚

**`@/App.tsx`**

```tsx
import ThemeSwitcher from "@/components/ThemeSwitcher";
import { ThemeProvider } from "@/context/ThemeContext";

export default function App() {
  return (
    <ThemeProvider>
      <div>
        <h1>React Context ç¤ºä¾‹</h1>
        <ThemeSwitcher />
      </div>
    </ThemeProvider>
  );
}
```

3ï¸âƒ£ **åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨ Context**

ç°åœ¨ï¼Œå¯ä»¥åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨ useTheme hook æ¥è·å–å½“å‰ä¸»é¢˜å’Œåˆ‡æ¢ä¸»é¢˜çš„æ–¹æ³•ã€‚

**`@/components/ThemeSwitcher.tsx`**

```tsx
import { useTheme } from "@/context/ThemeContext";

export default function ThemeSwitcher() {
  const { theme, toggleTheme } = useTheme();

  return (
    <div>
      <p>å½“å‰ä¸»é¢˜: {theme}</p>
      <button onClick={toggleTheme}>åˆ‡æ¢ä¸»é¢˜</button>
    </div>
  );
}
```

4ï¸âƒ£ **å¯åŠ¨åº”ç”¨**

ä½ å¯ä»¥å¯åŠ¨åº”ç”¨ï¼Œç‚¹å‡»æŒ‰é’®æ¥åˆ‡æ¢ä¸»é¢˜ã€‚useTheme hook ä¼šä» ThemeContext ä¸­è·å–å½“å‰çš„ä¸»é¢˜å’Œåˆ‡æ¢ä¸»é¢˜çš„å‡½æ•°ï¼Œå¹¶åœ¨ç‚¹å‡»æŒ‰é’®æ—¶è§¦å‘çŠ¶æ€å˜åŒ–ã€‚

<hr />

**å…³é”®ç‚¹**

1. createContext ç”¨æ¥åˆ›å»ºä¸€ä¸ª Contextã€‚
2. ThemeProvider ç»„ä»¶æ˜¯ä¸€ä¸ª Context æä¾›è€…ï¼Œå®ƒåŒ…è£¹åº”ç”¨ï¼Œå‘å­ç»„ä»¶æä¾›å…¨å±€çŠ¶æ€ã€‚
3. useContext ç”¨æ¥åœ¨å­ç»„ä»¶ä¸­è®¿é—® Context çš„å€¼ï¼ŒuseTheme æ˜¯è‡ªå®šä¹‰çš„ hookï¼Œç”¨æ¥è·å– theme å’Œ toggleThemeã€‚

## æ€»ç»“

Context ä½¿ç»„ä»¶å‘å…¶ä¸‹æ–¹çš„æ•´ä¸ªæ ‘æä¾›ä¿¡æ¯ï¼Œé¿å…äº† props é€å±‚ä¼ é€’çš„éº»çƒ¦ã€‚é€šè¿‡ Context ï¼Œä½ å¯ä»¥ç¼–å†™â€œè¾ƒä¸ºé€šç”¨â€çš„ç»„ä»¶ï¼Œå¹¶æ ¹æ®ä¸Šä¸‹æ–‡æ¸²æŸ“ä¸åŒçš„æ ·å­ã€‚åœ¨ä½¿ç”¨ Context ä¹‹å‰ï¼Œå…ˆå°è¯•ä¼ é€’ props æˆ–è€…å°† JSX ä½œä¸º children ä¼ é€’ï¼Œå¦‚æœè¿™äº›æ–¹æ³•éƒ½ä¸é€‚åˆï¼Œå†è€ƒè™‘ä½¿ç”¨ Context ã€‚

# ä½¿ç”¨ Reducer å’Œ Context æ‹“å±•ä½ çš„åº”ç”¨

åœ¨ React ä¸­ï¼Œéšç€åº”ç”¨çš„å¤æ‚åº¦å¢åŠ ï¼ŒçŠ¶æ€ç®¡ç†å¯èƒ½å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚å¦‚æœç»„ä»¶åµŒå¥—è¾ƒæ·±ï¼Œå•çº¯ä¾èµ– useState è¿›è¡ŒçŠ¶æ€ç®¡ç†ä¼šå¯¼è‡´çŠ¶æ€æå‡å˜å¾—ç¹çã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆ useReducer å’Œ Context æ¥ä¼˜åŒ–çŠ¶æ€ç®¡ç†ï¼Œä½¿åº”ç”¨æ›´åŠ æ¸…æ™°ã€å¯ç»´æŠ¤ã€‚

æ¥ä¸‹æ¥å°†é€šä¿—æ˜“æ‡‚åœ°ä»‹ç» useReducer ä¸ Context çš„é…åˆä½¿ç”¨ï¼Œå¹¶é€šè¿‡ä¸€ä¸ª **TodoList** ç¤ºä¾‹è¿›è¡Œå®Œæ•´æ¼”ç¤ºã€‚

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ useReducer + Contextï¼Ÿ

> ğŸ“– **useState çš„å±€é™æ€§**

åœ¨ç»„ä»¶å±‚çº§è¾ƒæ·±æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ï¼š

- éœ€è¦å°† useState æå‡åˆ°æ›´é«˜å±‚çº§ï¼Œå¯¼è‡´ â€œ**çŠ¶æ€æå‡**â€ è¿‡åº¦ã€‚
- åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€æ—¶ï¼Œéœ€è¦ä¸€å±‚å±‚åœ°é€šè¿‡ props ä¼ é€’ï¼Œé™ä½å¯ç»´æŠ¤æ€§ã€‚

> ğŸ“– **useReducer çš„ä¼˜åŠ¿**

- é€‚ç”¨äº **å¤æ‚çš„çŠ¶æ€é€»è¾‘**ï¼ˆå¦‚å¤šä¸ªçŠ¶æ€ç›¸äº’ä¾èµ–ã€çŠ¶æ€æ›´æ–°é€»è¾‘è¾ƒå¤æ‚ï¼‰ã€‚
- çŠ¶æ€ç®¡ç†é€»è¾‘é›†ä¸­åœ¨ reducer ä¸­ï¼Œä½¿ç»„ä»¶æ›´åŠ æ¸…æ™°ã€‚

> ğŸ“– **Context çš„ä¼˜åŠ¿**

- è®©æ·±å±‚ç»„ä»¶å¯ä»¥ **ç›´æ¥è®¿é—®** çŠ¶æ€ï¼Œè€Œä¸éœ€è¦é€å±‚ä¼ é€’ propsã€‚
- ç»“åˆ useReducerï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª **å…¨å±€çŠ¶æ€ç®¡ç†ä¸­å¿ƒ**ã€‚

## TodoList

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª **TodoList** åº”ç”¨ï¼Œæ”¯æŒï¼š

1. æ·»åŠ ä»»åŠ¡
2. åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
3. åˆ é™¤ä»»åŠ¡

### ç›®å½•ç»“æ„

```
src/
 â”œâ”€â”€ components/
 â”‚    â”œâ”€â”€ TodoForm.tsx
 â”‚    â”œâ”€â”€ TodoList.tsx
 â”œâ”€â”€ context/
 â”‚    â”œâ”€â”€ TodoContext.tsx
 â”œâ”€â”€ App.tsx
 â”œâ”€â”€ main.tsx
```

### å®ç° useReducer é€»è¾‘

é¦–å…ˆï¼Œåœ¨ context/TodoContext.tsx ä¸­åˆ›å»º Context å¹¶ä½¿ç”¨ useReducer ç®¡ç† todos çŠ¶æ€ã€‚

> **` @/context/TodoContext.tsx`**

```tsx
import React, { createContext, useReducer, useContext, ReactNode } from "react";

// -- å®šä¹‰ Todo ç±»å‹
interface Todo {
  id: number;
  text: string;
  completed: boolean;
}

// -- å®šä¹‰ Reducer å¯æ‰§è¡Œçš„åŠ¨ä½œ
type Action = 
  { type: "ADD_TODO"; payload: string } | 
  { type: "TOGGLE_TODO"; payload: number } | 
  { type: "REMOVE_TODO"; payload: number };

// -- Reducer é€»è¾‘
const todoReducer = (state: Todo[], action: Action): Todo[] => {
  switch (action.type) {
    case "ADD_TODO":
      return [...state, { id: Date.now(), text: action.payload, completed: false }];
    case "TOGGLE_TODO":
      return state.map((todo) => (todo.id === action.payload ? { 
        ...todo, completed: !todo.completed 
      } : todo));
    case "REMOVE_TODO":
      return state.filter((todo) => todo.id !== action.payload);
    default:
      return state;
  }
};

// -- åˆ›å»º Context
const TodoContext = createContext<
  | {
      todos: Todo[];
      dispatch: React.Dispatch<Action>;
    }
  | undefined
>(undefined);

// -- æä¾› Context çš„ Provider
export const TodoProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [todos, dispatch] = useReducer(todoReducer, []);

  return <TodoContext.Provider value={{ todos, dispatch }}>{children}</TodoContext.Provider>;
};

// -- è‡ªå®šä¹‰ Hook
export const useTodo = () => {
  const context = useContext(TodoContext);
  if (!context) {
    throw new Error("useTodo must be used within a TodoProvider");
  }
  return context;
};

```

### åˆ›å»º TodoForm.tsx ç»„ä»¶

ç”¨æˆ·å¯ä»¥è¾“å…¥ä»»åŠ¡å¹¶æäº¤ã€‚

> **`@/components/TodoForm.tsx`**

```tsx
import React, { useState } from "react";
import { useTodo } from "@/context/TodoContext";

export default function TodoForm() {
  const [text, setText] = useState("");
  const { dispatch } = useTodo();

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (text.trim() === "") return;
    dispatch({ type: "ADD_TODO", payload: text });
    setText("");
  };

  return (
    <form onSubmit={handleSubmit} className="flex gap-2 p-4">
      <input 
        type="text" 
        value={text} 
        onChange={(e) => setText(e.target.value)} 
        className="border p-2 rounded-md w-full" 
        placeholder="è¾“å…¥å¾…åŠäº‹é¡¹..." 
      />
      <button type="submit" className="bg-blue-500 text-white px-4 py-2 rounded-md">
        æ·»åŠ 
      </button>
    </form>
  );
}
```

### åˆ›å»º TodoList.tsx ç»„ä»¶

æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨ï¼Œå¹¶æ”¯æŒ **åˆ‡æ¢å®ŒæˆçŠ¶æ€** å’Œ **åˆ é™¤ä»»åŠ¡**ã€‚

> **`@/components/TodoList.tsx`**

```tsx
import { useTodo } from "@/context/TodoContext";

export default function TodoList() {
  const { todos, dispatch } = useTodo();
  return (
    <ul className="p-4 space-y-2">
      {todos.map((todo) => (
        <li key={todo.id} className="flex justify-between items-center bg-gray-100 p-2 rounded-md">
          <span 
            onClick={() => dispatch({ type: "TOGGLE_TODO", payload: todo.id })} 
            className={`cursor-pointer ${todo.completed ? "line-through text-gray-400" : ""}`}
          >
            {todo.text}
          </span>
          <button 
            onClick={() => dispatch({ type: "REMOVE_TODO", payload: todo.id })} 
            className="bg-red-500 text-white px-3 py-1 rounded-md"
          >
            åˆ é™¤
          </button>
        </li>
      ))}
    </ul>
  );
}
```

### ç»„è£… App.tsx

åœ¨ App.tsx ä¸­ä½¿ç”¨ TodoProvider åŒ…è£¹ TodoForm å’Œ TodoListã€‚

> **`@/App.tsx`**

```tsx
import { TodoProvider } from "@/context/TodoContext";
import TodoForm from "@/components/TodoForm";
import TodoList from "@/components/TodoList";

export default function App() {
  return (
    <TodoProvider>
      <div className="max-w-lg mx-auto mt-10 p-5 bg-white shadow-lg rounded-md">
        <h1 className="text-2xl font-bold text-center mb-4">Todo List</h1>
        <TodoForm />
        <TodoList />
      </div>
    </TodoProvider>
  );
}
```

### è¿è¡Œæ•ˆæœ

è¿™æ ·ï¼Œæˆ‘ä»¬çš„ **TodoList** åº”ç”¨å°±å®Œæˆäº†ï¼å…·å¤‡ï¼š

âœ… ä½¿ç”¨ useReducer è¿›è¡ŒçŠ¶æ€ç®¡ç†

âœ… é€šè¿‡ Context å…±äº« todos çŠ¶æ€

âœ… æ”¯æŒä»»åŠ¡æ·»åŠ ã€å®Œæˆåˆ‡æ¢ã€åˆ é™¤

ğŸ–¼ï¸ æœ€ç»ˆ UIå±•ç¤ºå¦‚ä¸‹ï¼š

![](./imgs/todolist_context_and_reducer.gif)

- ç‚¹å‡»ä»»åŠ¡å¯åˆ‡æ¢å®ŒæˆçŠ¶æ€ï¼ˆä¼šåŠ åˆ é™¤çº¿ï¼‰ã€‚
- ç‚¹å‡»åˆ é™¤æŒ‰é’®å¯ç§»é™¤ä»»åŠ¡ã€‚

## ç»“è®º

- useReducer é€‚åˆç®¡ç† **å¤æ‚çŠ¶æ€**ï¼Œå¯ä»¥æ›¿ä»£ useState å¤„ç†æ›´æ¸…æ™°çš„çŠ¶æ€æ›´æ–°é€»è¾‘ã€‚
- Context é¿å…äº† props drillingï¼Œè®©å¤šä¸ªç»„ä»¶å¯ä»¥è®¿é—®å…¨å±€çŠ¶æ€ã€‚
- ç»“åˆ Reducer + Contextï¼Œå¯ä»¥æ„å»ºä¸€ä¸ª **å¯æ‰©å±•çš„å…¨å±€çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ**ã€‚
